
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>「３三将棋」アプリリリースしました</title>

    <meta name="author" content="happyclam">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
      <script src="/assets/themes/twitter/js/excanvas.min.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link rel="shortcut icon" href="/images/favicon.ico">
    <!-- Le fav and touch icons -->
  <!-- Update these with your own images

    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@SappierBoy">
  <meta name="twitter:creator" content="@SappierBoy">
  
  <meta name="twitter:title" content="「３三将棋」アプリリリースしました">
  
  
  <meta name="twitter:url" content="http://happyclam.github.io/project/2018-01-01/33shogiapp">
  
  
  <meta name="twitter:description" content="初心者ほど簡単と思い込んで負ける。ベテランでも初見で全パターン勝てる人はいないでしょう">
  
  
  <meta name="twitter:image:src" content="http://happyclam.github.io/images/33shogi_logo.png">
  

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script language="JavaScript">
$(document).ready( function () {
    $("a[href^='http']:not([href*='" + location.hostname + "'])").attr('target', '_blank');
})
</script>
<script src="/assets/themes/twitter/js/jquery.min.js"></script>
<script src="/assets/themes/twitter/js/jquery.flot.min.js"></script>
<script src="/assets/themes/twitter/js/flotr2.min.js" type="text/javascript"></script>
<script src="/assets/themes/twitter/js/jquery.flot.selection.js" type="text/javascript" ></script>
<script src="/assets/themes/twitter/js/jekyll-search.js" type="text/javascript"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-1752720-7', 'happyclam.github.io');
      ga('send', 'pageview');
    </script>
<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  jax: ["input/TeX", "output/HTML-CSS"],
  tex2jax: {
    inlineMath: [ ['$', '$'] ],
    displayMath: [ ['$$', '$$']],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  messageStyle: "none",
  "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
});
</script>
<script src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>
  </head>

  <body>
    <div style="text-align: center;">
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- トップバナー -->
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-1238485061299241"
     data-ad-slot="7366457015"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
    </div>
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-narrow">
          <a class="brand" href="/">自己満足プログラミング</a>
          <ul class="nav">
            
            
            


  
    
      
      	
      	<li><a href="/archive">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages">Pages</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/profile">About</a></li>
      	
      
    
  
    
      
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags">Tags</a></li>
      	
      
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">
      <div class="row-fluid">
        <div class="span3">
        <a href="https://twitter.com/share" class="twitter-share-button"{count} data-via="SappierBoy">Tweet</a>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
        </div>
        <div class="span9"
             <!-- Html Elements for Search -->
             <div id="search-container" align="right">
               <input type="text" id="search-input" placeholder="search...">
               <ul id="results-container"></ul>
             </div>
             <div class="results"></div>
        </div>
      </div>
<script type="text/javascript">
  SimpleJekyllSearch.init({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('results-container'),
    json: '/search.json',
    searchResultTemplate: '<li><a href="{url}" title="{category}:{title}">{title}</a></li>',
    noResultsText: 'No results found',
    limit: 15,
    fuzzy: false,
  })
</script>
      <div class="content">
        
<div class="page-header">
  <h1>「３三将棋」アプリリリースしました </h1>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="date">
      <span>01 January 2018</span>
    </div>
    <div class="content">
      <p><a href="https://play.google.com/store/apps/details?id=shogi33.io.github.happyclam"><img src="/images/ja_badge_web_generic.png" alt="３三将棋" title="３三将棋" width="155" height="60" /></a></p>

<h3 id="３三将棋について">「３三将棋」について</h3>
<p>　以前にも<a href="/programming/2016-07-23/33shogi">「３三将棋」に関する記事</a>を書きましたが、実際に作ってみました。最初はゲーム開始時の初期盤面をユーザーが自由に編集出来るようなものにしようと考えていたのですが、そこまで開発コストをかけても実際に自分で初期盤面を試行錯誤しながら作って遊んでみようと思うユーザーがそれほどいるとは思えなかったので、とりあえず１５パターンの初期盤面を用意しました。今後パターンを増やしていくつもりです。</p>

<h3 id="ルール">ルール</h3>
<ul>
  <li>駒の動きは将棋と同じです。</li>
  <li>打ち歩詰め、二歩は禁止です。</li>
  <li>同一局面が４回現れると千日手でゲーム終了としています。</li>
  <li>行き場の無い駒は打てません（桂馬を二段目に打ったり、先手が歩を一段目に打ったり）</li>
  <li>先手は一段目、後手は三段目に駒を移動すると成ることが出来ます。</li>
</ul>

<h3 id="対局画面">対局画面</h3>

<div style="width:320px; margin: 0 auto;">
  <p><img src="/images/33shogi_battle.png" alt="対戦画面" title="対戦画面" /></p>
</div>
<p><span>ＡＩ同士の対戦の時だけ局面の評価値を表示するようにしています。左上の数値は手数です。</span></p>

<h3 id="閲覧画面">閲覧画面</h3>

<div style="width:320px; margin: 0 auto;">
  <p><img src="/images/33shogi_view.png" alt="閲覧画面" title="閲覧画面" /></p>
</div>
<p><span>対局が終了するか、対局を中断すると閲覧画面に切り替わって、初手からの手順を確認することが出来ます。</span></p>

<h3 id="メニュー">メニュー</h3>
<ul>
  <li>先手・後手</li>
</ul>

<p><span>ＡＩ同士の対戦時はどちらかが勝ちを読みきった時点で対局が終了します。なぜ対局が終了したか疑問に感じた場合は、同じ手順でＡＩと対戦してみてください、対人戦の時は詰みまで指すようにしていますので疑問が解消すると思います。</span></p>
<div style="width:320px; margin: 0 auto;">
  <p><img src="/images/33shogi_player.png" alt="Menu - 先手・後手" title="Menu - 先手・後手" /></p>
</div>

<ul>
  <li>ＡＩレベル</li>
</ul>

<p><span>駒に重みを設定してその合計値で局面を評価する評価関数を使い先読みを行う、よくある思考ルーチン（MIN-MAX法＋αβ法による全件探索）です。JavaScript製ということもあり、<del>非常に遅いのであまり深く読めません。</del>今後、候補手を事前に絞るなどして速度アップをしていく予定です。</span></p>

<div style="width:320px; margin: 0 auto;">
  <p><img src="/images/33shogi_ailevel.png" alt="Menu - ＡＩレベル" title="Menu - ＡＩレベル" /></p>
</div>

<p>長考モード：<br />
　Version0.9.3.0から長考モードが使えます。長考モードは４手読みで候補手を上位５手までに絞って、その５手に関して９手読みをするという仕様になっています。思考時間はリリース当初から改善していますが、古い機種では遅くて使用に堪えないかもしれません。</p>

<table>
  <thead>
    <tr>
      <th>Version</th>
      <th>ＡＩレベル（普通）</th>
      <th>ＡＩレベル（長考）</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0.9.1.2</td>
      <td><img src="/images/v0912-ordinal.gif" alt="Version0.9.1.2レベル普通" title="Version0.9.1.2 ＡＩレベル（普通）" /> 経過時間：30532ミリ秒</td>
      <td><img src="/images/v0912-tyokoh.gif" alt="Version0.9.1.2レベル長考" title="Version0.9.1.2 ＡＩレベル（長考）" /> 経過時間：153052ミリ秒</td>
    </tr>
    <tr>
      <td>0.9.4.6</td>
      <td><img src="/images/v0946-ordinal.gif" alt="Version0.9.4.6レベル普通" title="Version0.9.4.6 ＡＩレベル（普通）" /> 経過時間：29258ミリ秒</td>
      <td><img src="/images/v0946-tyokoh.gif" alt="Version0.9.4.6レベル長考" title="Version0.9.4.6 ＡＩレベル（長考）" /> 経過時間：87109ミリ秒</td>
    </tr>
  </tbody>
</table>

<p>長考モードにランダム選択を導入（Version0.9.7.0）：<br />
　長考モードは最初に４手読みをした結果から候補手を５手に絞っているので、その候補手を絞る段階で最善手が候補手から漏れてしまうこともあります。特に４手読みの結果上位５位、６位、７位の３手の評価値が全く同じであっても常に６位、７位の手は捨てられるのがもったいないので、評価値が同じだった場合はランダムに指し手を選ぶようにしました。あくまでも４手読み時の評価値が同じだった場合だけなので、指し手に大きな変化はありませんが長考モードに関しては常に同じ手を指すとは限らなくなりました。</p>

<hr />

<p>駒の重み：</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">駒の種類 \ 重み</th>
      <th style="text-align: right">　表（不成）　　</th>
      <th style="text-align: right">　裏（成り駒）　</th>
      <th style="text-align: right">持ち駒</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">玉（王）</td>
      <td style="text-align: right">9999</td>
      <td style="text-align: right">(9999)</td>
      <td style="text-align: right">(9999)</td>
    </tr>
    <tr>
      <td style="text-align: left">飛　</td>
      <td style="text-align: right">85</td>
      <td style="text-align: right">110</td>
      <td style="text-align: right">75</td>
    </tr>
    <tr>
      <td style="text-align: left">角　</td>
      <td style="text-align: right">75</td>
      <td style="text-align: right">100</td>
      <td style="text-align: right">65</td>
    </tr>
    <tr>
      <td style="text-align: left">金　</td>
      <td style="text-align: right">50</td>
      <td style="text-align: right">(50)</td>
      <td style="text-align: right">45</td>
    </tr>
    <tr>
      <td style="text-align: left">銀　</td>
      <td style="text-align: right">45</td>
      <td style="text-align: right">50</td>
      <td style="text-align: right">40</td>
    </tr>
    <tr>
      <td style="text-align: left">桂　</td>
      <td style="text-align: right">30</td>
      <td style="text-align: right">50</td>
      <td style="text-align: right">25</td>
    </tr>
    <tr>
      <td style="text-align: left">香　</td>
      <td style="text-align: right">25</td>
      <td style="text-align: right">50</td>
      <td style="text-align: right">20</td>
    </tr>
    <tr>
      <td style="text-align: left">歩　</td>
      <td style="text-align: right">10</td>
      <td style="text-align: right">50</td>
      <td style="text-align: right">7</td>
    </tr>
  </tbody>
</table>

<p><span>※対局中に大駒が成れるのに成らないケースがしばしば見られると思いますが、上記表の重みを考慮して、どうせ相手に取られるから成らない（低い重みのまま）でおこうとＡＩが判断するためです。</span></p>

<ul>
  <li>初期配置</li>
</ul>

<p><span>作ってみて感じたのですが、３三将棋の場合適当に駒を配置すると将棋の上級者が見るとすぐに勝敗が明白な局面になっていたりして、面白い勝負になりそうな初期配置を探すのが一番難しいかもしれません。とりあえず勝負が楽しめそうな配置で尚且ついろんな種類の駒を使うことを考えて「９マス将棋」なども参考にしながら１５種類の局面を用意しました。今後、追加していく予定です。</span></p>

<div style="width:320px; margin: 0 auto;">
  <p><img src="/images/33shogi_placement.png" alt="Menu - 初期配置" title="Menu - 初期配置" /></p>
</div>

<h3 id="開発資料">開発資料</h3>

<ul>
  <li>クラス図</li>
</ul>

<div style="width:480px; margin: 0 auto;">

  <p><a href="/images/shogi33class.png"><img src="/images/shogi33class.png" alt="クラス図" title="クラス図" /></a></p>

</div>

<ul>
  <li>
    <p>テストツール<br />
　mocha + chai でテストケースを書きました。CoffeeScript+mocha+chai=CaffeineJSと誰かが言ってましたが、まさに依存性のあるカフェインのように癖になりそうなぐらい作りやすかったです。いずれgithubでソースもテストスクリプトも公開する予定です。その時はこの記事を更新します。</p>
  </li>
  <li>
    <p>コンソール版</p>
  </li>
</ul>

<div style="width:480px; margin: 0 auto;">

  <p><a href="/images/shogi33cui.png"><img src="/images/shogi33cui.png" alt="CUI版" title="CUI版" /></a></p>

</div>

<p>　最初は作り易さもあってコンソール画面でも遊べるCUI版（Gameクラス、Boardクラス）から作っていたのですが、将棋の指し手は複数の駒が動ける可能性がある時に「１一銀右」とか「３二銀引く成る」とか「３一金直ぐ」とかいろんなケースが発生するので、それをコンソール画面でコマンドラインのパラメータとして入力させる処理が非常に面倒になります。だから一通りコンソールでも遊べるようになったところで細かいところは未対応のまま放置してGUI版の開発に移行しました。GUIなら駒をタッチ（クリック）するだけなのでUI（ユーザーインターフェース）が作り易くなるからです。それでもコンソールで作っていたBoardクラスは変更を加える必要がなくそのまま継承してBoardGUIクラスを作るだけで済むのはオブジェクト指向プログラミングの面目躍如と言ったところです。</p>

<hr />


    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
     
    	<li><a href="/categories.html#project-ref">
    		project <span>15</span>
    	</a></li>
    
  


    </ul>
    

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
     
    	<li><a href="/tags.html#coffeescript-ref">coffeescript <span>16</span></a></li>
     
    	<li><a href="/tags.html#cordova-ref">cordova <span>15</span></a></li>
     
    	<li><a href="/tags.html#android-ref">android <span>25</span></a></li>
     
    	<li><a href="/tags.html#javascript-ref">javascript <span>24</span></a></li>
     
    	<li><a href="/tags.html#shogi-ref">shogi <span>6</span></a></li>
    
  



    </ul>
    

    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/programming/2017-08-12/hybrid_csp" title="ハイブリッドアプリのセキュリティ">&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next"><a href="/software/2018-01-27/utifudume" title="打ち歩詰めについて">Next &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'happyclam'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
</div>


      </div>
      <hr>
      <footer>
        <p>&copy; 2018 happyclam
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div>

    
  </body>
</html>

