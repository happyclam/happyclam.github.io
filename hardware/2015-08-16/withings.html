<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">
  <meta name="author" content="happyclam">
  <meta name="description"
    content="Withings Activité購入 Apple Watchにもほとんど興味が湧かなかった自分にとっては… Reinventing the wheel.">
  <title> Withings Activité購入 - 自己満足プログラミング </title>

  <!-- Global Site Tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-1752720-7"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-1752720-7');
  </script>

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@SappierBoy">
  <meta name="twitter:creator" content="@SappierBoy">
  
  <meta name="twitter:title" content="Withings Activité購入">
  
  
  <meta name="twitter:url" content="/hardware/2015-08-16/withings">
  
  
  <meta name="twitter:description" content="Reinventing the wheel.">
  
  
  <meta name="twitter:image:src" content="https://happyclam.github.io/images/activite_setup_thumb.png">
  

  <link rel="canonical" href="https://happyclam.github.io/hardware/2015-08-16/withings" />
  <!-- stylesheets -->
  <link media="all" href="//netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
  <link media="all" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
  <link media="all" rel="stylesheet" href="/assets/css/site.css">

</head>


<body>
  <header>
  <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a id="site-title" class="navbar-brand" href="/">
          <img class="pull-left img-responsive" src="">
          <span class="name-holder">自己満足プログラミング</span>
        </a>
      </div>

      <div class="collapse navbar-collapse" id="navbar">

        <ul id="main-menu" class="nav navbar-nav navbar-right">

          
            <li><a href="/">
              <i class="fa fa-home"></i> Home</a>
            </li>
          
            <li><a href="/categories/">
              <i class="fa fa-sitemap"></i> Categories</a>
            </li>
          
            <li><a href="/tags/">
              <i class="fa fa-tag"></i> Tags</a>
            </li>
          
            <li><a href="/about/">
              <i class="fa fa-info-circle"></i> About</a>
            </li>
          
            <li><a href="/policy/">
              <i class="fa fa-check"></i> Policy</a>
            </li>
          

        </ul>
      </div>
      <!-- /.navbar-collapse -->
    </div>
    <!-- /.container-fluid -->
  </nav>
</header>

  <!-- <script src="https://unpkg.com/simple-jekyll-search@1.5.0/dest/simple-jekyll-search.min.js"></script> -->
  <script src="/assets/js/simple-jekyll-search.min.js"></script>
  <div style="text-align: center;">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-9018029357773039",
          enable_page_level_ads: true
      });
    </script>
  </div>
  <div class="blog-header">
    <div class="row-fluid">
      <div class="span3">
        <a href="https://twitter.com/share" class="twitter-share-button"{count} data-via="SappierBoy">Tweet</a>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
      </div>
      <div class="span9">
        <!-- Html Elements for Search -->
        <div id="search-container" align="right">
          <input type="text" id="search-input" placeholder="search...">
          <ul class="searchresult" id="results-container"></ul>
        </div>
        <div class="results"></div>
      </div>
    </div>
<script type="text/javascript">
  SimpleJekyllSearch.init({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('results-container'),
    json: '/search.json',
    searchResultTemplate: '<li><a href="{url}" title="{category}:{title}">{title}</a></li>',
    noResultsText: 'No results found',
    limit: 15,
    fuzzy: false,
  })
</script>
  <script src="/assets/js/jquery.min.js"></script>
  </div>
  <div class="container">
  <div class="row">
    <div class="col-xs-12 col-sm-12 col-md-offset-1 col-md-10 col-lg-offset-2 col-lg-8">
      <div class="page">

        <header class="page-header">
          <h2 class="page-title"><a href="/hardware/2015-08-16/withings">Withings Activité購入</a></h2>
          <div class="post-metadata">
            <div> <i class="fa fa-calendar"></i>
              <time>
                Sunday, August 16, 2015
              </time>
            </div>
            <div> <i class="fa fa-tag"></i>
                
                  <span class="label label-tag">android</span>
                
                  <span class="label label-tag">iphone</span>
                
                  <span class="label label-tag">hardware</span>
                
                  <span class="label label-tag">software</span>
                
                  <span class="label label-tag">withings</span>
                
            </div>
          </div>

        </header>

        <article class="page-content">
          <h3 id="普通の腕時計を買うつもりがスマートウォッチになったわけ">普通の腕時計を買うつもりが、スマートウォッチになったわけ</h3>
<p>　もう１０年以上前から腕時計をする習慣が無くなっていたのですが、携帯電話からスマホに変わってからは胸ポケットに入れられないスマホを鞄から取り出すのが面倒なため腕時計をする機会が多くなっていました。でも今はロードバイク用に買ったアウトドア用のソーラー電波時計しか無いので、一つビジネスにも使えるようなものを買ってみようかと思って<a href="https://www.facebook.com/powerwatch.fan/posts/840855109296593">「予算１０万円台までで購入できる　最強スポーツウオッチ選手権」</a>と銘打った時計雑誌を購入しました。<br />
　雑誌の中ではいろいろ欲しくなる時計は紹介されていたのですが、小さく紹介されていた「Withings Activité」のデザインが気に入ってネットで調べてみるとスマートウォッチというカテゴリーに分類される時計のようです。Apple Watchにもほとんど興味が湧かなかった自分にとっては、すでに世の中にいろいろなスマートウォッチと呼ばれる時計が出回っていることを知って驚きでした。<br />
　そして、</p>

<ul>
  <li>サイレントアラーム（音ではなく振動で目覚まし）を体験したい</li>
  <li>せっかく身に付けるものが増えるなら万歩計の機能も欲しい</li>
  <li>ちょうど体重計を買い換えようと思っていたので、<a href="https://www.amazon.co.jp/【日本正規代理店品】-Withings-ネットワーク対応-Bluetooth-70046001/dp/B00V35HEIC/ref=pd_cp_23_4?ie=UTF8&amp;refRID=1ZPPMCN7P96YPJKSNHAP">Withing製品</a>で揃えよう</li>
</ul>

<p>　というビジネス時計を買うという当初の目的に無かった余計な欲が出てきて、スマホと連携して遊べそうな「Withings Activité」が欲しくなってきました。昔ロードバイクを初めて購入した時に<a href="https://www.amazon.co.jp/Holux-M-241-HOLUX-ワイヤレスGPSロガー/dp/B00C85RH8S">HOLUXのGPSロガー</a>を購入しロードバイクで彼方此方走った記録を後からニヤニヤしながら地図上で記録をなぞっていくのを楽しんでいた時期がありましたが、それに近いものがあるような気がします。自転車乗るのも好きだけど、後からGPSデータを眺めるのも好き。腕時計も好きだけど、付加された遊び機能も好き、みたいな。それに何と言っても「Withings Activité」のデザインやサファイアガラスを使っている点などは時計としての魅力もたっぷりで、スマートウォッチの機能に飽きたとしても長く使っていけそうだと思ったことが購入を決めた大きな理由です（電池を自分で交換できる点もいい）。<br />
　ちなみにGPSロガーはすぐに飽きて使わなくなったのですが、初めて買ったロードバイクは今でもお気に入りで乗り続けています。</p>

<div style="width:160px; margin: 0 auto;">

  <p><a href="/images/activite_setup.png" target="_blank"><img src="/images/activite_setup.png" alt="セットアップ完了" width="160" height="194" title="セットアップ完了" /></a></p>

</div>

<p>　それにしても購入を決めた当初は、自分のように時計を物色していてこの機種を購入するに至った人は珍しいんじゃないかと思っていたのですが、その後もスマートウォッチの情報をネットで漁っているとApple Watchのような如何にも今までの腕時計とは異質のものではなく、見た目は本格的な腕時計のままスマホとの連携機能を持つスタイルのスマートウォッチのほうが主流になる可能性があることを知りました<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup>。時計雑誌で紹介されていたスマートウォッチはこの機種だけだったので、浮いている感じを受けましたが、今後は普通の時計雑誌でスマートウォッチが紹介される機会が増えてくるのかもしれません。<br />
　セットアップは<a href="https://uxlayman.hatenablog.com/entry/2015/04/28/073100">こちらのサイト</a>を参考にしました。</p>

<div style="width:160px; margin: 0 auto;">

  <p><a href="/images/activite_sleeping.png" target="_blank"><img src="/images/activite_sleeping.png" alt="日毎の睡眠パターン" width="160" height="284" title="日毎の睡眠パターン" /></a></p>

</div>

<p>　上のグラフのように浅い眠りと深い眠りを判別出来るようです。寝起きに「あ〜よく寝た」と感じた時は濃い青のグラフの帯が大きかったので結構正確かもしれません。それと当たり前かもしれませんが朝方トイレに起きた履歴もちゃんと残っていて、いつか自分の記憶にない記録が残っていたりしないかと密かに期待しています（夢遊病か!?）。</p>

<h3 id="web-apiを使ってみる">Web APIを使ってみる</h3>
<p>　APIが公開されていたので少し触ってみました。<a href="https://blog.hopkins.io/2013/07/25/withings-api/">Withings API Quickstart Guide</a>と銘打ったサイトの通りwithings用のgemを使えばすぐに自分が登録したデータを取得することが出来ましたが、最新のAPIに対応しているか分からなかったし使い方もよくわからないし、アクセストークンを取得した後は<a href="https://oauth.withings.com/api">WithingsのAPIドキュメント</a>を見ながら自分でパラメータをセットしていろんなデータの取得を試してみたかったので、特別なgemを使用せずにjsonデータを取得するスクリプトを書いてみました。<br />
　このスクリプトを実行するにはTwitterアプリを作る時なんかと同様に<a href="https://oauth.withings.com/en/partner/add">Withingsにアプリを登録</a>してAPI Key、API Secretを取得する必要があります。そしてWithings API のページの<a href="https://oauth.withings.com/api">FIRST STEP</a>に従って操作し、OAuth認証完了後userid、oauth_token、oauth_token_secretの値を取得してスクリプトにセットしておく必要があります。</p>

<pre><code class="language-Ruby">#sleep.rb
require 'pp'
require 'openssl'
require 'time'
require 'json'
require 'net/http'
require 'cgi'
require 'base64'

BASE_URI='https://wbsapi.withings.net'
WITHINGS_OAUTH_CONSUMER_KEY='xxxxx'
WITHINGS_OAUTH_CONSUMER_SECRET='yyyyy'

user_id = 1234567
oauth_token = "aiueo"
oauth_token_secret = "iroha"

params = {:action =&gt; :get, :userid =&gt; 1234567}
#params = {:action =&gt; :getworkouts, :userid =&gt; 1234567}
#params = {:action =&gt; :getsummary, :userid =&gt; 1234567}
#params = {:action =&gt; :getactivity, :userid =&gt; 1234567}
#params = {:action =&gt; :getbyuserid, :userid =&gt; 1234567}

url = BASE_URI + '/v2/sleep'
#url = BASE_URI + '/v2/measure'
#url = BASE_URI + '/user'
#url = BASE_URI + '/v2/user'

params.merge!({
                :oauth_consumer_key =&gt; WITHINGS_OAUTH_CONSUMER_KEY,
                :startdate =&gt; Time.parse("2015-08-07 12:00:00").to_i,
                :enddate =&gt; Time.parse("2015-08-08 12:00:00").to_i,
#                :startdateymd =&gt; '2015-08-09',
#                :enddateymd =&gt; '2015-08-09',
#                :startdateymd =&gt; Time.parse("2015-08-03 12:00:00").to_i,
#                :enddateymd =&gt; Time.parse("2015-08-09 12:00:00").to_i,
#                :lastupdate =&gt; Time.parse("2015-08-08 12:00:00").to_i,
                :oauth_nonce =&gt; rand(10 ** 30).to_s(16),
                :oauth_signature_method =&gt; 'HMAC-SHA1',
                :oauth_timestamp =&gt; Time.now.to_i,
                :oauth_version =&gt; '1.0',
                :oauth_token =&gt; oauth_token
              })
params = params.to_a.map() do |item|
  [item.first.to_s, CGI.escape(item.last.to_s)]
end.sort
param_string = params.map() {|key, value| "#{key}=#{value}"}.join('&amp;')
base_string = ['GET', CGI.escape(url), CGI.escape(param_string)].join('&amp;')
secret = [WITHINGS_OAUTH_CONSUMER_SECRET, oauth_token_secret].join('&amp;')
digest = OpenSSL::HMAC.digest('sha1', secret, base_string)
signature = Base64.encode64(digest).chomp.gsub( /\n/, '' )
uri_string = url + '?' + param_string + '&amp;oauth_signature=' + CGI.escape(signature)
#p uri_string

Net::HTTP.version_1_2
uri = URI.parse(uri_string)
json = Net::HTTP.get(uri)
result = JSON.parse(json)
pp result
</code></pre>

<p>　要するにリクエスト毎に変わるOAuth1.0の署名（oauth_signature）の生成を自動化するためのスクリプトです。<a href="https://blog.hopkins.io/2013/07/25/withings-api/">gem のソースコード</a>と<a href="https://syncer.jp/how-to-make-signature-of-oauth-1">このサイト</a>を参考にしました。RailsでTwitterのAPI使う時はgemが勝手にやってくれるので今までこの作業を自前でやったことはなかったため、サーバーからのエラーが無くなるまで結構手間取りました。サーバーがステータスコード「342 : The signature (using Oauth) is invalid」を返してくるわけですが、必ずしも署名の作成の仕方が悪いわけではないようです<sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote" rel="footnote">2</a></sup>。サーバー側でもう少しパラメータのチェックを優先して、それに沿ったエラーを返して欲しいところですがどうなのでしょう。</p>

<div style="width:320px; margin: 0 auto;">

  <p><a href="/images/activite_screenshot.png" target="_blank"><img src="/images/activite_screenshot.png" alt="スクリプト実行結果" width="320" height="358" title="スクリプト実行結果" /></a></p>

</div>

<p>　とにかくこれで準備はできたので後はアイデアだけ。気が向けばこのWithings APIを使ったアプリを作ってみようと思ってます。</p>

<div>
    <script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- display01 -->
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9018029357773039" data-ad-slot="3925247388" data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

<hr />

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p><a href="https://www.dream-seed.com/weblog/archives/2015/02/55372/">複数のスイス時計メーカーがスマートウォッチを発表</a>、<a href="https://weekly.ascii.jp/elem/000/000/328/328470/">腕時計好きもグッとくる絶品スマートウォッチ特選編</a>、<a href="https://matome.naver.jp/odai/2142691305853056801">グッチも！？有名ブランドが続々発売するスマートウォッチ市場が熱い！！</a> <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:2" role="doc-endnote">
      <p>例として上記スクリプトのstartdateパラメータをセットしている行で.to_iを削除すると{“status” =&gt; 342}が返ってきます。 <a href="#fnref:2" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

        </article>
      </div>
    </div>
  </div>
</div>


  

<footer class="footer">
  <div class="container">
    <div class="row">
      <div class="col-lg-offset-3 col-lg-6">
        <div class="row">
          <div class="col-xs-12 text-center">
            <small>&copy; rifyll theme, 2014</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</footer>


  <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script> -->
  <!-- <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script> -->
  <script src="/assets/js/bootstrap.min.js"></script>

  <!--<script src="/assets/js/prism.js"></script> -->
  <script src="/assets/js/site.js"></script>
</body>

</html>
