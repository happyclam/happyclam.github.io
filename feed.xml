<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>自己満足プログラミング</title>
    <description>Reinventing the wheel.</description>
    <link>https://happyclam.github.io/</link>
    <atom:link href="https://happyclam.github.io/feed.xml" rel="self" type="application/rss+xml" />
    <pubDate>Fri, 23 Jul 2021 09:08:23 +0900</pubDate>
    <lastBuildDate>Fri, 23 Jul 2021 09:08:23 +0900</lastBuildDate>
    <generator>Jekyll v3.9.1</generator>
    
      <item>
        <title>FlutterアプリのNull Safety対応</title>
        <description>&lt;p&gt;&lt;a href=&quot;https://taimienphi.vn/download-mancala-nuts-90337&quot;&gt;&lt;img src=&quot;/images/tmp2.png&quot; alt=&quot;マンカラアプリ&quot; title=&quot;マンカラ ナッツ&quot; width=&quot;155&quot; height=&quot;60&quot; /&gt;&lt;/a&gt;
&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;&lt;img src=&quot;/images/ja_badge_web_generic.png&quot; alt=&quot;マンカラアプリ&quot; title=&quot;マンカラ ナッツ&quot; width=&quot;155&quot; height=&quot;60&quot; /&gt;&lt;/a&gt;
&lt;a href=&quot;https://www.amazon.co.jp/happyclam-マンカラ-ナッツ/dp/B08D8QVVQY/ref=sr_1_2&quot;&gt;&lt;img src=&quot;/images/amazon-appstore-badge-jp-white.png&quot; alt=&quot;マンカラアプリ&quot; title=&quot;マンカラ ナッツ&quot; width=&quot;155&quot; height=&quot;60&quot; /&gt;&lt;/a&gt;
&lt;br /&gt;&lt;a href=&quot;https://taimienphi.vn&quot; title=&quot;download&quot;&gt;taimienphi.vn&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;はっきり言って面倒臭い&quot;&gt;はっきり言って面倒臭い&lt;/h3&gt;
&lt;p&gt;　プログラミングの際にオブジェクトを代入する変数を&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;null&lt;/code&gt;で初期化して、その変数が&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;null&lt;/code&gt;かどうかで条件分岐する、なんてコードをよく書いていたので、また面倒なことが増えたって気がしますが、実行時のNull Pointer Exceptionを避ける意味はあるのでしょう。はっきり言ってこういう仕組みは普段テストを書く習慣が無い人のためにあるんじゃないの？って気もしますが、世の流れには逆らえずFlutter製の&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;アプリ（マンカラナッツ）&lt;/a&gt;でも対応することにしました。&lt;/p&gt;

&lt;h3 id=&quot;パッケージの依存状況を調べる&quot;&gt;パッケージの依存状況を調べる&lt;/h3&gt;
&lt;p&gt;　&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;flutter pub outdated --mode=null-safety&lt;/code&gt;と打てば、使用しているパッケージがNull Safety対応済みかどうか分かります。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ flutter pub outdated --mode=null-safety
Showing dependencies that are currently not opted in to null-safety.
[✗] indicates versions without null safety support.
[✓] indicates versions opting in to null safety.

Package Name               Current  Upgradable  Resolvable  Latest

direct dependencies:
flutter_google_ad_manager  ✗0.11.1  ✗0.11.1     ✗0.11.1     ✗0.11.1

dev_dependencies: all support null safety.
You are already using the newest resolvable versions listed in the 'Resolvable' column.
Newer versions, listed in 'Latest', may not be mutually compatible.

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　以前にも少し作業したので、&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;マンカラナッツ&lt;/a&gt;の場合はNull Safetyに対応していないのは&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;flutter_google_ad_manager&lt;/code&gt;だけです。というかこのパッケージ（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;flutter_google_ad_manager&lt;/code&gt;）が対応されるのを待っていた状態でした。対応作業する前は&lt;a href=&quot;/software/2020-10-01/flutter_plugin&quot;&gt;自分で作ったパッケージ（karah_think.so）&lt;/a&gt;もこのリストに表示されていたのですが、既に修正したので、今回は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;flutter_google_ad_manager&lt;/code&gt;の代わりに&lt;a href=&quot;https://pub.dev/packages/admob_flutter/versions/2.0.0-nullsafety.1&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admob_flutter&lt;/code&gt;&lt;/a&gt;を使うことで対応しました。作業内容は&lt;a href=&quot;https://pub.dev/packages/admob_flutter/versions/2.0.0-nullsafety.1/example&quot;&gt;使用例&lt;/a&gt;に書かれているので簡単でした。&lt;/p&gt;

&lt;h3 id=&quot;コードの修正&quot;&gt;コードの修正&lt;/h3&gt;
&lt;p&gt;　以前にNull Safety対応作業した時には既にFlutter2.0だったのですが、今回&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Flutter upgrade&lt;/code&gt;してから作業するといくつか追加の作業が必要でした。以前&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;flutter_google_ad_manager&lt;/code&gt;部分をコメントにしてビルドした時には既に&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Sound Null Safety&lt;/code&gt;と表示されていたのですが、Flutter自体が完全にNull Safetyになっていなかったのでしょうか？今回AndroidStudioのバージョンアップ（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;4.2.2&lt;/code&gt;）もしたので、それも関係あるのかも知れませんがよく分かりません。&lt;/p&gt;

&lt;p&gt;　今回の環境は以下の通りです。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ flutter --version
Flutter 2.2.3 • channel stable • https://github.com/flutter/flutter
Framework • revision f4abaa0735 (8 days ago) • 2021-07-01 12:46:11 -0700
Engine • revision 241c87ad80
Tools • Dart 2.13.4
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;修正例&quot;&gt;修正例&lt;/h3&gt;
&lt;p&gt;　修正前&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  GlobalKey _keyBoard = GlobalKey();
  RenderBox _box;

    if (_box == null)
      WidgetsBinding.instance.addPostFrameCallback((_afterLayout){
        setState(() {
          _box = _keyBoard.currentContext.findRenderObject();
        });
      });

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　修正後&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  final GlobalKey _keyBoard = GlobalKey();
  late RenderBox _box;

    WidgetsBinding.instance!.addPostFrameCallback((_) {
      setState(() {
        _box = _keyBoard.currentContext!.findRenderObject() as RenderBox;
      });
    });
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　遅延初期化のための&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;late&lt;/code&gt;キーワードが使えるようになったのはDart2.12からだそうです。また、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;as&lt;/code&gt;を使って明確に型を指定しないとビルド出来なくなっていました。C++のように型にうるさくなっていくのでしょう。&lt;/p&gt;

&lt;h3 id=&quot;修正後&quot;&gt;修正後&lt;/h3&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ flutter pub outdated --mode=null-safety
Showing dependencies that are currently not opted in to null-safety.
[✗] indicates versions without null safety support.
[✓] indicates versions opting in to null safety.

All your dependencies declare support for null-safety.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　AdMob用のパッケージを&lt;a href=&quot;https://pub.dev/packages/admob_flutter/versions/2.0.0-nullsafety.1&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admob_flutter&lt;/code&gt;&lt;/a&gt;に変えたことで、Null Safety非対応のプラグインはなくなりました。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ flutter build apk --release

💪 Building with sound null safety 💪

Picked up _JAVA_OPTIONS: -Djava.net.preferIPv6Addresses=true
Running Gradle task 'assembleRelease'...
Running Gradle task 'assembleRelease'... Done                     121.0s
✓  Built build/app/outputs/flutter-apk/app-release.apk (60.1MB).

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　ビルド時に:muscle:絵文字が出て、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Sound Null Safety&lt;/code&gt;と表示されます。&lt;br /&gt;
　目出度く&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;マンカラナッツ&lt;/a&gt;はVersion1.2.2から&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Null Safety&lt;/code&gt;になりました。&lt;/p&gt;

&lt;div&gt;
    &lt;script async=&quot;&quot; src=&quot;https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js&quot;&gt;&lt;/script&gt;
    &lt;!-- display01 --&gt;
    &lt;ins class=&quot;adsbygoogle&quot; style=&quot;display:block&quot; data-ad-client=&quot;ca-pub-9018029357773039&quot; data-ad-slot=&quot;3925247388&quot; data-ad-format=&quot;auto&quot; data-full-width-responsive=&quot;true&quot;&gt;&lt;/ins&gt;
    &lt;script&gt;
    (adsbygoogle = window.adsbygoogle || []).push({});
    &lt;/script&gt;
&lt;/div&gt;

&lt;hr /&gt;

</description>
        <pubDate>Sat, 10 Jul 2021 00:00:00 +0900</pubDate>
        <link>https://happyclam.github.io/software/2021-07-10/null_safety</link>
        <guid isPermaLink="true">https://happyclam.github.io/software/2021-07-10/null_safety</guid>
        
        <category>mancala</category>
        
        <category>dart</category>
        
        <category>android</category>
        
        <category>flutter</category>
        
        
        <category>software</category>
        
      </item>
    
      <item>
        <title>HerokuのDBを削除＆再構築</title>
        <description>&lt;h3 id=&quot;herokuの無料枠&quot;&gt;Herokuの無料枠&lt;/h3&gt;
&lt;p&gt;　Herokuから&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;「[Warning] Approaching row limit for hobby-dev database on Heroku app kwl-books」&lt;/code&gt;というタイトルのメールが届きました。「データベースには7,322行が含まれています。Hobby-devプランでは、最大10,000行まで許容されています。サービスの中断を避けるためには、データベースをベーシック（$9/月）以上のプランに移行してください」。とのこと。&lt;br /&gt;
　&lt;a href=&quot;https://kwl-books.herokuapp.com&quot;&gt;このサイト（「楽天Kobo電子書籍新着チェッカー」）&lt;/a&gt;では、&lt;a href=&quot;/project/2016-03-30/koboAPI&quot;&gt;以前の記事&lt;/a&gt;に書いたように、電子書籍の新着データをDBに保存して表示しているのですが、そのデータが溜まって制限に届きそうだという警告なので対処することにしました。&lt;/p&gt;

&lt;h3 id=&quot;deleteだけではダメ&quot;&gt;DELETEだけではダメ？&lt;/h3&gt;
&lt;p&gt;　&lt;a href=&quot;https://kwl-books.herokuapp.com&quot;&gt;「楽天Kobo電子書籍新着チェッカー」&lt;/a&gt;は、SQLのDELETE文を走らせて古い日付のレコードはその都度削除してデータを溜め込まないようにしているつもりなので容量の心配をせずに運用出来ると思っていました。だからメールを受け取った時は、データを物理削除（TRUNCATE）しなければダメってことだろうとすぐに思い当たったのですが、DBごと削除して再構築する方が簡単そうなのでそうすることにしました。&lt;br /&gt;
　&lt;a href=&quot;https://kwl-books.herokuapp.com&quot;&gt;「楽天Kobo電子書籍新着チェッカー」&lt;/a&gt;では、設定で必要なのは環境変数だけで、全てのデータをWebAPIで取得して保存しているので、予め必要なマスターデータと呼ぶものがありません。と言うことでDB毎削除しても問題ありません。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ heroku addons:add pgbackups --app kwl-books
 ›   Warning: heroku update available from 7.52.0 to 7.54.1.
Creating pgbackups on ⬢ kwl-books... !
 ▸    Couldn't find either the add-on service or the add-on plan of &quot;pgbackups&quot;.

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　念の為バックアップしようとしたのですが、無料枠（Free Dynos）では使えないようです:sweat_smile:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ heroku pg:reset DATABASE --confirm kwl-books
 ›   Warning: heroku update available from 7.52.0 to 7.54.1.
Resetting postgresql-opaque-46906... done
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　呆気なく削除完了&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ heroku pg:info --app kwl-books
 ›   Warning: heroku update available from 7.52.0 to 7.54.1.
=== DATABASE_URL
Plan:                  Hobby-dev
Status:                Available
Connections:           0/20
PG Version:            11.12
Created:               2016-03-28 10:18 UTC
Data Size:             7.8 MB
Tables:                0
Rows:                  0/10000 (In compliance)
Fork/Follow:           Unsupported
Rollback:              Unsupported
Continuous Protection: Off
Add-on:                postgresql-opaque-46906

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Rows&lt;/code&gt;が&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0&lt;/code&gt;になってます。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ heroku run rake db:migrate:reset
 ›   Warning: heroku update available from 7.52.0 to 7.54.1.
Running rake db:migrate:reset on ⬢ kwl-books... up, run.9942 (Free)
The PGconn, PGresult, and PGError constants are deprecated, and will be
removed as of version 1.0.
:
:省略
:
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/kwl-books-screen.png&quot;&gt;&lt;img src=&quot;/images/kwl-books-screen.png&quot; alt=&quot;動作確認&quot; width=&quot;480&quot; height=&quot;691&quot; title=&quot;動作確認&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;　動作確認。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ heroku pg:info --app kwl-books
 ›   Warning: heroku update available from 7.52.0 to 7.54.1.
=== DATABASE_URL
Plan:                  Hobby-dev
Status:                Available
Connections:           1/20
PG Version:            11.12
Created:               2016-03-28 10:18 UTC
Data Size:             8.2 MB
Tables:                3
Rows:                  53/10000 (In compliance)
Fork/Follow:           Unsupported
Rollback:              Unsupported
Continuous Protection: Off
Add-on:                postgresql-opaque-46906

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;　&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Rows&lt;/code&gt;が&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;53&lt;/code&gt;になりました。&lt;/p&gt;

&lt;p&gt;　勢いで作業をしてしまって結局TRUNCATEしていたらどうだったのか分からないのですが、少なくともSQL文でDELETEするだけでは、ダメ（Herokuの最大容量制限の対象としてカウントされたままになる）なのだと思います。&lt;/p&gt;

&lt;h3 id=&quot;paasplatform-as-a-serviceでの運用&quot;&gt;PaaS(Platform as a Service)での運用&lt;/h3&gt;
&lt;p&gt;　それにしてもHerokuからの通知は、普段安心しきっているところに唐突に来るので嫌なものですが、これはオンプレミスやVPSでの運用より安心し切っている反動のような気がします。Rails＋Herokuを業務で使った場合の運用コストは詳しくありませんが、開発に専念出来る点は非常に楽だと思います。&lt;br /&gt;
　以前&lt;a href=&quot;https://github.com/happyclam/tictactoe-cf/wiki&quot;&gt;HerokuでNode.jsとMongoDBを使って運用していたアプリ&lt;/a&gt;があったのですが、突然Herokuから「MongoDBアドオンを削除します（The mLab MongoDB add-on will be removed from all Heroku apps on November 10, 2020. ） 」と通知が来て、取り急ぎやむなくアプリを非公開にした（どうせユーザーも殆どいなかったし）ことがあったのですが、ちゃんと調べれば代替手段はあったようで、今検索してみると&lt;a href=&quot;https://qiita.com/nobu17/items/ca9ae3d60dc837ca0de0&quot;&gt;こんな記事&lt;/a&gt;がありました。&lt;br /&gt;
　対応はそれなりに面倒そうですが、そもそもMongoDBアドオンが使えなくなったのはHerokuの都合ではないので仕方がないって感じですね。&lt;/p&gt;

&lt;h3 id=&quot;追記2021-07-22&quot;&gt;追記（2021-07-22）&lt;/h3&gt;
&lt;p&gt;　二週間ぐらい経ったある日また同じような文面の警告メールをHerokuから受け取りました。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ heroku pg:info --app kwl-books
=== DATABASE_URL
Plan:                  Hobby-dev
Status:                Available
Connections:           1/20
PG Version:            11.12
Created:               2016-03-28 10:18 UTC
Data Size:             21.6 MB
Tables:                3
Rows:                  7440/10000 (In compliance, close to row limit)
Fork/Follow:           Unsupported
Rollback:              Unsupported
Continuous Protection: Off
Add-on:                postgresql-opaque-46906
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Rows: 7440/10000&lt;/code&gt;となっていて、消したはずのレコードが復活しているようです？？？&lt;br /&gt;
　何が起きたのかよく分かりませんが、もう一度&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;heroku pg:reset DATABASE --confirm kwl-books&lt;/code&gt;と&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;heroku run rake db:migrate:reset&lt;/code&gt;を実行した後、&lt;a href=&quot;https://devcenter.heroku.com/ja/articles/managing-vacuum-on-heroku-postgres&quot;&gt;「Heroku Postgres での VACUUM の管理」&lt;/a&gt;に書かれている通り&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;VACUUM&lt;/code&gt;してみました。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$heroku pg:bloat DATABASE_URL --app kwl-books
:
:省略
:
$heroku pg:vacuum_stats DATABASE_URL --app kwl-books
$heroku pg:psql
kwl-books::DATABASE=&amp;gt; VACUUM;
WARNING:  skipping &quot;pg_authid&quot; --- only superuser can vacuum it
WARNING:  skipping &quot;pg_subscription&quot; --- only superuser can vacuum it
WARNING:  skipping &quot;pg_database&quot; --- only superuser can vacuum it
WARNING:  skipping &quot;pg_db_role_setting&quot; --- only superuser can vacuum it
WARNING:  skipping &quot;pg_tablespace&quot; --- only superuser can vacuum it
WARNING:  skipping &quot;pg_pltemplate&quot; --- only superuser can vacuum it
WARNING:  skipping &quot;pg_auth_members&quot; --- only superuser can vacuum it
WARNING:  skipping &quot;pg_shdepend&quot; --- only superuser can vacuum it
WARNING:  skipping &quot;pg_shdescription&quot; --- only superuser can vacuum it
WARNING:  skipping &quot;pg_replication_origin&quot; --- only superuser can vacuum it
WARNING:  skipping &quot;pg_shseclabel&quot; --- only superuser can vacuum it
VACUUM
kwl-books::DATABASE=&amp;gt; VACUUM genres;
VACUUM
kwl-books::DATABASE=&amp;gt; VACUUM books;
VACUUM
kwl-books::DATABASE=&amp;gt; exit

$ heroku pg:info --app kwl-books
=== DATABASE_URL
Plan:                  Hobby-dev
Status:                Available
Connections:           1/20
PG Version:            11.12
Created:               2016-03-28 10:18 UTC
Data Size:             8.4 MB
Tables:                3
Rows:                  64/10000 (In compliance)
Fork/Follow:           Unsupported
Rollback:              Unsupported
Continuous Protection: Off
Add-on:                postgresql-opaque-46906

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　動作確認後&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Rows: 64/10000&lt;/code&gt;となっていて、&lt;a href=&quot;https://kwl-books.herokuapp.com&quot;&gt;サイト&lt;/a&gt;も問題なく動作しているようです。&lt;br /&gt;
　消したはずのデータがなぜ復活したのか分かりませんし、データの中身までチェックした訳ではないのですが、今度は大丈夫だろうと思います。&lt;/p&gt;

&lt;div&gt;
    &lt;script async=&quot;&quot; src=&quot;https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js&quot;&gt;&lt;/script&gt;
    &lt;!-- display01 --&gt;
    &lt;ins class=&quot;adsbygoogle&quot; style=&quot;display:block&quot; data-ad-client=&quot;ca-pub-9018029357773039&quot; data-ad-slot=&quot;3925247388&quot; data-ad-format=&quot;auto&quot; data-full-width-responsive=&quot;true&quot;&gt;&lt;/ins&gt;
    &lt;script&gt;
    (adsbygoogle = window.adsbygoogle || []).push({});
    &lt;/script&gt;
&lt;/div&gt;

&lt;hr /&gt;

</description>
        <pubDate>Wed, 30 Jun 2021 00:00:00 +0900</pubDate>
        <link>https://happyclam.github.io/programming/2021-06-30/heroku_delete</link>
        <guid isPermaLink="true">https://happyclam.github.io/programming/2021-06-30/heroku_delete</guid>
        
        <category>rails</category>
        
        <category>heroku</category>
        
        <category>MongoDB</category>
        
        <category>node</category>
        
        <category>javascript</category>
        
        
        <category>programming</category>
        
      </item>
    
      <item>
        <title>ページエクスペリエンス向上</title>
        <description>&lt;h3 id=&quot;特に対策していなかったコンテンツの表示速度&quot;&gt;特に対策していなかったコンテンツの表示速度&lt;/h3&gt;
&lt;p&gt;　&lt;a href=&quot;https://ring-and-link.co.jp/dream2000/user/notice/seo/4817&quot;&gt;この記事&lt;/a&gt;によると2021年5月からgoogleの検索ランキングに&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ページエクスペリエンス&lt;/code&gt;という指標が導入されたようです。自分のサイトはJekyll製の静的サイトなので今までは表示速度については特に対策はしていませんでしたが、自分のサイトも以下のように５月５日を境に多くのページが「改善が必要なURL」としてGoogle様から指摘されるようになりました。&lt;/p&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/google_ux.png&quot;&gt;&lt;img src=&quot;/images/google_ux.png&quot; alt=&quot;ウェブに関する主な指標&quot; width=&quot;480&quot; height=&quot;359&quot; title=&quot;ウェブに関する主な指標&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/google_experience.png&quot;&gt;&lt;img src=&quot;/images/google_experience.png&quot; alt=&quot;モバイルでのページエクスペリエンス&quot; width=&quot;480&quot; height=&quot;614&quot; title=&quot;モバイルでのページエクスペリエンス&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/google_signal.png&quot;&gt;&lt;img src=&quot;/images/google_signal.png&quot; alt=&quot;モバイルでの指標&quot; width=&quot;480&quot; height=&quot;416&quot; title=&quot;モバイルでの指標&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;　
&lt;span id=&quot;back&quot;&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;　今までもいろいろgoogle様からの指摘に対応してきました。「テキストが小さすぎて読めません」、「クリック可能な要素同士が近すぎます」、「コンテンツの幅が画面の幅を超えています」などなど、その度にCSSを弄って対策を施してきました。そして、４月まではSearch Console&lt;sup id=&quot;fnref:1&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;内で&lt;strong&gt;「サイトに優れたページ エクスペリエンスの URL が 100% 件あります」&lt;/strong&gt;と表示されていて気分を良くしていました。でも、５月になって急に上の画像のように表示が変わって、「またか」って感じです。どこまでもgoogle様に振り回される状況は変わらないようです:weary:&lt;br /&gt;
　でも、今までから気にはなっていたことがあったので、コンテンツ表示速度改善に取り組んでみました。&lt;br /&gt;
　あと、問題があるのはモバイルユーザビリティであって、今のところPC環境では特に問題は無さそうです。&lt;/p&gt;

&lt;h3 id=&quot;今までから気になっていたこと&quot;&gt;今までから気になっていたこと&lt;/h3&gt;
&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;http://jekyllbootstrap.com/&quot;&gt;Jekyll Bootstrap&lt;/a&gt;の多機能なテーマを使用していること&lt;br /&gt;
&lt;a href=&quot;http://jekyllbootstrap.com/&quot;&gt;ここにあるJekyllBootstrap&lt;/a&gt;のテンプレートを使えば、サイトのテーマ（Theme,テンプレート）を簡単に差し替えることが出来るようになっていて、機能も豊富でコメント機能も付いていたりしますが、自分のサイトでは今までコメントをしてくれた人はいませんので無駄な機能でした。&lt;br /&gt;
　また、テーマを差し替えることが出来ると言っても気に入ったものがなく、結局今まで一度もテーマを変更することはありませんでした。現在は&lt;a href=&quot;https://github.com/jekyllbootstrap&quot;&gt;テーマの種類&lt;/a&gt;も追加・更新はされていないようです。&lt;/li&gt;
  &lt;li&gt;大き目の画像を使用していること&lt;br /&gt;
ほとんどの記事で画像を使う時は、小さく表示してクリックすると原寸表示（拡大表示）出来るような作りにしているので元々の画像サイズが大き目であることが気にはなっていました。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;　ということで、1.に関してはJekyllのテンプレートをもっと軽いものに変更、2.に関してはimgタグを使う時はサイズ指定するように変更してみました。&lt;/p&gt;

&lt;h3 id=&quot;修正前のpagespeed-insightsの結果&quot;&gt;修正前の&lt;a href=&quot;https://developers.google.com/speed/pagespeed/insights/?hl=ja&quot;&gt;PageSpeed Insights&lt;/a&gt;の結果&lt;/h3&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/pagespeed01.png&quot;&gt;&lt;img src=&quot;/images/pagespeed01.png&quot; alt=&quot;修正前の測定結果&quot; width=&quot;480&quot; height=&quot;296&quot; title=&quot;修正前の測定結果&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;　&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;２５&lt;/code&gt;というのは結構酷い状態かも知れません。&lt;/p&gt;

&lt;h3 id=&quot;imgタグにサイズ指定&quot;&gt;imgタグにサイズ指定&lt;/h3&gt;
&lt;p&gt;　今までこう書いていたのを&lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;img src=&quot;/images/results_3beans.png&quot; alt=&quot;豆３つ&quot; title=&quot;豆３つ&quot; /&amp;gt;&lt;/code&gt;&lt;br /&gt;
　このようにサイズの記述を追加しただけです。&lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;img src=&quot;/images/results_3beans.png&quot; alt=&quot;豆３つ&quot; width=&quot;480&quot; height=&quot;270&quot; title=&quot;豆３つ&quot; /&amp;gt;&lt;/code&gt;&lt;/p&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/pagespeed02.png&quot;&gt;&lt;img src=&quot;/images/pagespeed02.png&quot; alt=&quot;imgタグにサイズ指定&quot; width=&quot;480&quot; height=&quot;306&quot; title=&quot;imgタグにサイズ指定&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;　画像の実際の表示サイズは親要素で拡大・縮小表示するケースが多いと思いますが、imgタグで画像を読み込む時に縦横比をブラウザに教えてあげることが大事らしいです。対策した結果、若干改善しました。対象の記事はスクショを撮り忘れて、上の画像のURLは画像を使っていないのですが、だいたいこれぐらいの数値の改善がありました。&lt;br /&gt;
　imgタグのサイズ指定は昔は必須だったのがレスポンシブな時代にはサイズ指定しないようになって来たけど、ブラウザにレイアウトシフトを避ける機能が実装されてきて、今は速度アップのためにサイズ指定する方が良いという流れがあるようです。&lt;br /&gt;
　画像に関してはフォーマットも色々あるのでもっと突き詰める余地がありそうです。&lt;/p&gt;

&lt;h3 id=&quot;jekyllテンプレートを交換&quot;&gt;Jekyllテンプレートを交換&lt;/h3&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/pagespeed03.png&quot;&gt;&lt;img src=&quot;/images/pagespeed03.png&quot; alt=&quot;Jekyllテンプレートを交換&quot; width=&quot;480&quot; height=&quot;288&quot; title=&quot;Jekyllテンプレートを交換&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;　今までの無駄な機能が多いテンプレートから、&lt;a href=&quot;http://jekyllthemes.org&quot;&gt;Jekyll Themesというサイト&lt;/a&gt;で探して、&lt;a href=&quot;https://github.com/itsrifat/rifyll&quot;&gt;シンプルなJekyllテンプレート&lt;/a&gt;に交換してカスタマイズしました。&lt;/p&gt;

&lt;h3 id=&quot;改善後の状態&quot;&gt;改善後の状態&lt;/h3&gt;
&lt;p&gt;　ページによってまちまちですが、&lt;a href=&quot;https://developers.google.com/speed/pagespeed/insights/?hl=ja&quot;&gt;PageSpeed Insights&lt;/a&gt;で確認すると上記の改善後も多くの指摘事項があります。&lt;/p&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/speedinsights.png&quot;&gt;&lt;img src=&quot;/images/speedinsights.png&quot; alt=&quot;PageSpeed Insightsの指摘事項&quot; width=&quot;480&quot; height=&quot;181&quot; title=&quot;Pagespeed Insightsの指摘事項&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;　&lt;a href=&quot;https://developers.google.com/speed/pagespeed/insights/?hl=ja&quot;&gt;PageSpeed Insights&lt;/a&gt;を使えばページ毎の問題点を指摘してくれるのですが、やはり一番の問題は画像サイズにあるページが多いようです。モバイルユーザーに焦点を当てて、これからは大きな画像は使わないようにしようかと思ってます。&lt;/p&gt;

&lt;h3 id=&quot;pc並の数値にするのは大変そう&quot;&gt;PC並の数値にするのは大変そう&lt;/h3&gt;
&lt;p&gt;　ちなみに対象を「パソコン」にすると以下の数値です。&lt;/p&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/pagespeed05.png&quot;&gt;&lt;img src=&quot;/images/pagespeed05.png&quot; alt=&quot;パソコンの結果&quot; width=&quot;480&quot; height=&quot;291&quot; title=&quot;パソコンの結果&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;　&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;９９！&lt;/code&gt;だからこそ今まではSearch Console内で「サイトに優れたページ エクスペリエンスの URL が 100% 件あります」（←googleによる変な日本語）という評価だったわけです。&lt;/p&gt;

&lt;p&gt;　&lt;a href=&quot;https://developers.google.com/speed/pagespeed/insights/?hl=ja&quot;&gt;PageSpeed Insights&lt;/a&gt;の指摘の中に「JavaScriptの削減」という項目があったので、試しにadsenseとanalyticsのjsコードを除去すると、数値を&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;８１&lt;/code&gt;まで上げることが出来ましたが、これでは意味がないので他の改善方法を探る必要がありそうですが、自前のWebサーバーで運用しているわけではなく、&lt;a href=&quot;https://github.com/happyclam/happyclam.github.io&quot;&gt;github&lt;/a&gt;に静的ファイルを置いているだけなので方法は限られそうです。&lt;/p&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/pagespeed04.png&quot;&gt;&lt;img src=&quot;/images/pagespeed04.png&quot; alt=&quot;adsenseとanalyticsのjsコードを除去&quot; width=&quot;480&quot; height=&quot;291&quot; title=&quot;adsenseとanalyticsのjsコードを除去&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;　&lt;a href=&quot;https://www.suzukikenichi.com/blog/page-experience-ranking-is-coming-to-desktop/&quot;&gt;この記事&lt;/a&gt;によるとページエクスペリエンスのランキングはPC検索についても今後適用していくようです。&lt;/p&gt;

&lt;h3 id=&quot;三日後の状況&quot;&gt;三日後の状況&lt;/h3&gt;
&lt;p&gt;　サイトを修正して三日後に確認すると、とりあえず「改善が必要」なURLは０になって、「優れたページエクスペリエンス」の割合も増加傾向にあるようです。&lt;/p&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/google_ux_new.png&quot;&gt;&lt;img src=&quot;/images/google_ux_new.png&quot; alt=&quot;ウェブに関する主な指標&quot; width=&quot;480&quot; height=&quot;359&quot; title=&quot;ウェブに関する主な指標&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/google_experience_new.png&quot;&gt;&lt;img src=&quot;/images/google_experience_new.png&quot; alt=&quot;モバイルでのページエクスペリエンス&quot; width=&quot;480&quot; height=&quot;359&quot; title=&quot;モバイルでのページエクスペリエンス&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/google_signal_new.png&quot;&gt;&lt;img src=&quot;/images/google_signal_new.png&quot; alt=&quot;モバイルでの指標&quot; width=&quot;480&quot; height=&quot;359&quot; title=&quot;モバイルでの指標&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;h3 id=&quot;五日後の状況&quot;&gt;五日後の状況&lt;/h3&gt;
&lt;p&gt;　画像ファイルを縮小したり全ての記事を見直してモバイル対応を意識した変更をした結果「良好なURL」が以前より増えたようです。&lt;/p&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/google_ux_5.png&quot;&gt;&lt;img src=&quot;/images/google_ux_5.png&quot; alt=&quot;ウェブに関する主な指標&quot; width=&quot;480&quot; height=&quot;450&quot; title=&quot;ウェブに関する主な指標&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/google_experience_5.png&quot;&gt;&lt;img src=&quot;/images/google_experience_5.png&quot; alt=&quot;モバイルでのページエクスペリエンス&quot; width=&quot;480&quot; height=&quot;630&quot; title=&quot;モバイルでのページエクスペリエンス&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;h3 id=&quot;十日後の状況&quot;&gt;十日後の状況&lt;/h3&gt;
&lt;p&gt;　96.7%まで戻りました。とりあえずこの辺りで良しとします。&lt;/p&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/google_experience_6.png&quot;&gt;&lt;img src=&quot;/images/google_experience_6.png&quot; alt=&quot;モバイルでのページエクスペリエンス&quot; width=&quot;480&quot; height=&quot;641&quot; title=&quot;モバイルでのページエクスペリエンス&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;div&gt;
    &lt;script async=&quot;&quot; src=&quot;https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js&quot;&gt;&lt;/script&gt;
    &lt;!-- display01 --&gt;
    &lt;ins class=&quot;adsbygoogle&quot; style=&quot;display:block&quot; data-ad-client=&quot;ca-pub-9018029357773039&quot; data-ad-slot=&quot;3925247388&quot; data-ad-format=&quot;auto&quot; data-full-width-responsive=&quot;true&quot;&gt;&lt;/ins&gt;
    &lt;script&gt;
    (adsbygoogle = window.adsbygoogle || []).push({});
    &lt;/script&gt;
&lt;/div&gt;

&lt;hr /&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;Google Search Console通称「サチコ」というらしいです。&lt;a href=&quot;#back&quot;&gt;戻る&lt;/a&gt; &lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</description>
        <pubDate>Thu, 03 Jun 2021 00:00:00 +0900</pubDate>
        <link>https://happyclam.github.io/miscellaneous/2021-06-03/pagespeed</link>
        <guid isPermaLink="true">https://happyclam.github.io/miscellaneous/2021-06-03/pagespeed</guid>
        
        <category>jekyll</category>
        
        <category>google</category>
        
        
        <category>miscellaneous</category>
        
      </item>
    
      <item>
        <title>マンカラは後手でも勝てるか？</title>
        <description>&lt;h3 id=&quot;自分のアプリと他のアプリを手動で対戦させてみた&quot;&gt;自分のアプリと他のアプリを手動で対戦させてみた&lt;/h3&gt;
&lt;p&gt;　&lt;a href=&quot;/software/2020-06-07/mancala&quot;&gt;以前の記事&lt;/a&gt;で６×２列のマンカラが先手必勝なのか後手必勝なのかを自作プログラムで調べましたが、時間がかかり過ぎるので結論が得られないままでした。そこで自分のアプリと他の強いアプリを対戦させてみて、その結果から石の数（豆の数）毎に先手必勝なのか後手必勝なのかを推測してみようと思います。&lt;br /&gt;
　google playに公開されているマンカラアプリの中で、マンカラカラハ（classicルール&lt;sup id=&quot;fnref:1&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;）で遊ぶことが出来て、初期配置の石の数を３個から７個まで選択出来るアプリを３つ選んで、先手・後手の対戦結果から推測します。どのアプリと比較したかは別に公開しても構わないと思うのですが、もしかしたら作者に歓迎されない可能性もあるので使用したアプリ名は一応伏せておきます。また比較する時はアプリの強さ設定で全て&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;最強&lt;/code&gt;に設定して比較しています。&lt;/p&gt;

&lt;h3 id=&quot;対戦成績&quot;&gt;対戦成績&lt;/h3&gt;
&lt;p&gt;　&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;自分のアプリ&lt;/a&gt;は対戦結果を先手・後手別に記録出来る様にしているの&lt;sup id=&quot;fnref:2&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:2&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;で、そのスクリーンショットを以下に並べます。&lt;br /&gt;
※画像クリックで拡大表示&lt;/p&gt;

&lt;h4 id=&quot;-豆３つの対戦成績&quot;&gt;* 豆３つの対戦成績&lt;/h4&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/results_3beans.png&quot;&gt;&lt;img src=&quot;/images/results_3beans.png&quot; alt=&quot;豆３つ&quot; width=&quot;480&quot; height=&quot;270&quot; title=&quot;豆３つ&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;h4 id=&quot;-豆４つの対戦成績&quot;&gt;* 豆４つの対戦成績&lt;/h4&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/results_4beans.png&quot;&gt;&lt;img src=&quot;/images/results_4beans.png&quot; alt=&quot;豆４つ&quot; width=&quot;480&quot; height=&quot;270&quot; title=&quot;豆４つ&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;h4 id=&quot;-豆５つの対戦成績&quot;&gt;* 豆５つの対戦成績&lt;/h4&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/results_5beans.png&quot;&gt;&lt;img src=&quot;/images/results_5beans.png&quot; alt=&quot;豆５つ&quot; width=&quot;480&quot; height=&quot;270&quot; title=&quot;豆５つ&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;h4 id=&quot;-豆６つの対戦成績&quot;&gt;* 豆６つの対戦成績&lt;/h4&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/results_6beans.png&quot;&gt;&lt;img src=&quot;/images/results_6beans.png&quot; alt=&quot;豆６つ&quot; width=&quot;480&quot; height=&quot;270&quot; title=&quot;豆６つ&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;h4 id=&quot;-豆７つの対戦成績&quot;&gt;* 豆７つの対戦成績&lt;/h4&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/results_7beans.png&quot;&gt;&lt;img src=&quot;/images/results_7beans.png&quot; alt=&quot;豆７つ&quot; width=&quot;480&quot; height=&quot;270&quot; title=&quot;豆７つ&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;　対戦成績表の見方ですが、&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;マンカラナッツ&lt;/a&gt;では&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;やばい&lt;/code&gt;モード以外では初手をランダムに決めるようにしていて、勝負に拘っていないので、アプリが勝てるのかどうかを判断する場合は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;やばい&lt;/code&gt;モード以外は見る必要がありません。勝ちの欄の数字はＡＩ対戦で人間側が勝った数字、つまり比較対象となっているアプリが勝ったということです。また比較するために選んだアプリが初手をランダムに決めているものもあるので、一回だけの対戦ではなく何回か対戦させました。&lt;br /&gt;
　注目すべきは黄色い丸で囲んだ部分の数字です。&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;後手で勝つことが出来るか&lt;/code&gt;です。豆の数が３、４、５、７の時は後手の勝ち星が全て&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0&lt;/code&gt;で、比較対象のアプリが後手の場合は、何度やっても&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;自分のアプリ&lt;/a&gt;に勝てません。&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;自分のアプリ&lt;/a&gt;が数あるマンカラアプリの中で最強だと主張しているのではなく、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;マンカラカラハというゲームはお互いが最善を尽くせば先手必勝&lt;/code&gt;なのではないか？ということです。負けの欄の数字（比較対象のアプリが負けた数字＝&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;自分のアプリ&lt;/a&gt;が勝った数字）を見ると、勝ちの欄の数字より大きいので勝率は良い方だと思いますが、先に言ったように比較対象のアプリは初手をランダムに決めている（＝勝負に拘ってない）ものもあるので一概には言えません。マンカラでは初手で悪手を選択するとそれだけで勝てなくなるような気がします。&lt;br /&gt;
　また豆の数が６の時は先手でも後手でも勝ったり負けたりなので、どちらとも言えませんが双方が最善を尽くしたら引分けなのかもしれません。上の対戦成績結果以外で試していた時も引分けになる頻度が結構高かったです。&lt;/p&gt;

&lt;h3 id=&quot;結論&quot;&gt;結論&lt;/h3&gt;
&lt;p&gt;　豆の数１の時と２の時は&lt;a href=&quot;/software/2020-06-07/mancala&quot;&gt;以前の記事&lt;/a&gt;で結論が出ていると思っているので、以下のように推測します。&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;豆の数&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;１&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;２&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;３&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;４&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;５&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;６&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;７&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;カラハClassic&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;引分け？&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;　強さの比較に使用したアプリも&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;自分のアプリ&lt;/a&gt;もおそらく似たような評価関数と、MIN-MAX法及びαβ法を使った先読み探索で指し手を決めていると思うので、この推測が絶対正しいとは言えません。先読みの手数に制限があるからです。&lt;br /&gt;
　今将棋や囲碁で流行っている機械学習（Deep Learning等）によるＡＩだと違う指し手を選んで全てのマンカラアプリに後手でも勝つなんてことがないとは言い切れませんが、マンカラは将棋や囲碁に較べたら変化の幅が狭いので、将棋や囲碁のように劇的な強さの向上はないでしょう。でも誰か試している人はいないのでしょうか？機械学習を使ったらどうなるか、ちょっと興味あります。&lt;br /&gt;
　機械学習（強化学習）を使った&lt;a href=&quot;https://play.google.com/store/apps/details?id=tictactoe_evo.io.github.happyclam&quot;&gt;三目並べアプリ&lt;/a&gt;では、結局MIN-MAX法を使ったものと同じ結果（双方が最善を尽くせば常に引分け）になるので、マンカラの場合も結局同じ結果が得られるだけかもしれません。&lt;/p&gt;

&lt;div&gt;
    &lt;script async=&quot;&quot; src=&quot;https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js&quot;&gt;&lt;/script&gt;
    &lt;!-- display01 --&gt;
    &lt;ins class=&quot;adsbygoogle&quot; style=&quot;display:block&quot; data-ad-client=&quot;ca-pub-9018029357773039&quot; data-ad-slot=&quot;3925247388&quot; data-ad-format=&quot;auto&quot; data-full-width-responsive=&quot;true&quot;&gt;&lt;/ins&gt;
    &lt;script&gt;
    (adsbygoogle = window.adsbygoogle || []).push({});
    &lt;/script&gt;
&lt;/div&gt;

&lt;hr /&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;カラハのclassicルールについては&lt;a href=&quot;/software/2020-08-09/mancala_easy&quot;&gt;以前の記事&lt;/a&gt;を見て下さい。 &lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;先手・後手別の対戦結果を自分が知りたかったのでこの機能を付けました。 &lt;a href=&quot;#fnref:2&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</description>
        <pubDate>Fri, 22 Jan 2021 00:00:00 +0900</pubDate>
        <link>https://happyclam.github.io/software/2021-01-22/mancala_evaluate02</link>
        <guid isPermaLink="true">https://happyclam.github.io/software/2021-01-22/mancala_evaluate02</guid>
        
        <category>dart</category>
        
        <category>android</category>
        
        <category>flutter</category>
        
        <category>c++</category>
        
        <category>mancala</category>
        
        
        <category>software</category>
        
      </item>
    
      <item>
        <title>詰将棋ならぬ詰マンカラ</title>
        <description>&lt;h3 id=&quot;マンカラも将棋も二人零和有限確定完全情報ゲーム&quot;&gt;マンカラも将棋も二人零和有限確定完全情報ゲーム&lt;/h3&gt;
&lt;p&gt;　&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;「マンカラ ナッツ」&lt;/a&gt;の評価関数は&lt;a href=&quot;/software/2020-08-10/mancalanuts&quot;&gt;アプリの説明ページ&lt;/a&gt;にも書いていますが、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;先手の貯蔵所に溜まった豆の数 - 後手の貯蔵所に溜まった豆の数&lt;/code&gt;を返すようになっています。これは局面の形勢判断をするというよりズバリどっちが勝ちかを判断するための単純な評価関数で、将棋で言えば詰将棋専用の評価関数&lt;sup id=&quot;fnref:1&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;のようなものです。将棋でよく駒得とか駒の働きとかの局面の特徴を捉えて形勢判断をしますが、マンカラの形勢判断をどうすればいいのか、いいアイデアが浮かばなかったので単純な豆の数の差だけを評価する評価関数を使っています。&lt;br /&gt;
　マンカラは将棋ほど変化が膨大ではなく、ゲーム終了までの手数も短いので、いきなり初手から詰み（勝ち）を読みに行くような評価関数を使ってるわけですが、今のところこれで良いかな？と思ってます&lt;sup id=&quot;fnref:2&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:2&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;。&lt;/p&gt;

&lt;h4 id=&quot;マンカラの棋譜&quot;&gt;マンカラの棋譜？&lt;/h4&gt;
&lt;p&gt;　マンカラは棋譜の記述方法が決まっていない？と思うので、指し手の位置を示すために以下の表を使います。&lt;/p&gt;

&lt;div style=&quot;float:left; margin: 0px 0px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;br /&gt;後手のストア&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;13&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;12&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;11&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;10&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;&amp;nbsp;9&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;&amp;nbsp;8&lt;/td&gt;    
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;7&lt;br /&gt;先手のストア&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;&amp;nbsp;1&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;&amp;nbsp;2&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;&amp;nbsp;3&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;&amp;nbsp;4&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;&amp;nbsp;5&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;&amp;nbsp;6&lt;/td&gt;        
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br clear=&quot;all&quot; /&gt;&lt;/p&gt;

&lt;p&gt;　０が後手のストア、７が先手のストア、１〜６で先手のポケット、８〜１３で後手のポケットを示します。&lt;/p&gt;

&lt;h3 id=&quot;詰めマンカラ詰めカラハ&quot;&gt;詰めマンカラ（詰めカラハ）&lt;/h3&gt;
&lt;h4 id=&quot;問題１&quot;&gt;問題１&lt;/h4&gt;
&lt;p&gt;　まずは簡単な問題から。&lt;br /&gt;
　下の図で先手（下側）は何番のポケットを選ぶのが最善でしょうか？&lt;/p&gt;

&lt;p&gt;&lt;span&gt;※クリックで拡大&lt;/span&gt;&lt;/p&gt;
&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/ai_lose07.png&quot;&gt;&lt;img src=&quot;/images/ai_lose07.png&quot; alt=&quot;詰み07&quot; width=&quot;480&quot; height=&quot;240&quot; title=&quot;詰み07&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;　マンカラに慣れている人だと&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;4&lt;/code&gt;と&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;5&lt;/code&gt;の豆は動かさずに済ませられるならと思い、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt;か&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2&lt;/code&gt;か&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3&lt;/code&gt;がいいんじゃないかと見当が付くのではないでしょうか？順に見ていきます。&lt;/p&gt;
&lt;h5 id=&quot;1を選んでみると&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt;を選んでみると&lt;/h5&gt;
&lt;p&gt;　ＡＩは&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;13&lt;/code&gt;-&amp;gt;ピッタリ-&amp;gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;12&lt;/code&gt;と進めて以下の局面になります。&lt;/p&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/ai_001.png&quot;&gt;&lt;img src=&quot;/images/ai_001.png&quot; alt=&quot;詰めマンカラ&quot; width=&quot;480&quot; height=&quot;270&quot; title=&quot;詰めマンカラ&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;　こうなると次に先手（下側）は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2&lt;/code&gt;を選んでも&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3&lt;/code&gt;を選んでも、いずれ豆を溜め込んでいる&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;4&lt;/code&gt;や&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;5&lt;/code&gt;のポケットを選ばざるを得なくなり、勝負が紛れます。というより逆転して後手が有利になります。この後、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2&lt;/code&gt;を選べばＡＩは&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;11&lt;/code&gt;、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3&lt;/code&gt;を選んでもＡＩは&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;11&lt;/code&gt;（横取り２つ）で形勢逆転です。&lt;/p&gt;

&lt;h5 id=&quot;2を選んでみると&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2&lt;/code&gt;を選んでみると&lt;/h5&gt;
&lt;p&gt;　ＡＩは&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;13&lt;/code&gt;-&amp;gt;ピッタリ-&amp;gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;12&lt;/code&gt;-&amp;gt;横取り（２つ）となって以下の局面になります。&lt;/p&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/ai_002.png&quot;&gt;&lt;img src=&quot;/images/ai_002.png&quot; alt=&quot;詰めマンカラ&quot; width=&quot;480&quot; height=&quot;270&quot; title=&quot;詰めマンカラ&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;　この場合も次に先手（下側）は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3&lt;/code&gt;を選んでも&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;6&lt;/code&gt;を選んでも、パスは出来ないので豆を溜め込んでいる&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;4&lt;/code&gt;や&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;5&lt;/code&gt;のポケットを選ばざるを得なくなり後手が有利になります。&lt;/p&gt;

&lt;h5 id=&quot;3を選んでみると&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3&lt;/code&gt;を選んでみると&lt;/h5&gt;
&lt;p&gt;　ＡＩは&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;13&lt;/code&gt;-&amp;gt;ピッタリ-&amp;gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;12&lt;/code&gt;-&amp;gt;横取り（２つ）となって以下の局面になります。&lt;/p&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/ai_003.png&quot;&gt;&lt;img src=&quot;/images/ai_003.png&quot; alt=&quot;詰めマンカラ&quot; width=&quot;480&quot; height=&quot;270&quot; title=&quot;詰めマンカラ&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;　こうなれば次に先手（下側）が&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2&lt;/code&gt;を選べば、相手の&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;11&lt;/code&gt;のポケットの豆を横取りしてゲーム終了。先手の勝ちになります。&lt;br /&gt;
　先手が&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3&lt;/code&gt;を選んだ後、もしＡＩが&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;13&lt;/code&gt;を選ばずに&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;12&lt;/code&gt;や&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;11&lt;/code&gt;を選んだとしても、先手は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;4&lt;/code&gt;や&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;5&lt;/code&gt;のポケットを選ばずに&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt;〜&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3&lt;/code&gt;のポケットを選ぶだけで後手は自陣の豆が無くなっていきゲーム終了、先手の勝ちになります。&lt;br /&gt;
　念のため確認すると&lt;br /&gt;
　ＡＩが&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;13&lt;/code&gt;でなく&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;11&lt;/code&gt;を選んだ場合&lt;/p&gt;
&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/ai_004.png&quot;&gt;&lt;img src=&quot;/images/ai_004.png&quot; alt=&quot;詰めマンカラ&quot; width=&quot;480&quot; height=&quot;270&quot; title=&quot;詰めマンカラ&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;　先手は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt;を選んでも&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2&lt;/code&gt;を選んでも後手はピッタリ（連続して着手出来る）が仇となり、自陣の豆が無くなります。&lt;br /&gt;
　ＡＩが&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;13&lt;/code&gt;でなく&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;12&lt;/code&gt;を選んだ場合&lt;/p&gt;
&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/ai_005.png&quot;&gt;&lt;img src=&quot;/images/ai_005.png&quot; alt=&quot;詰めマンカラ&quot; width=&quot;480&quot; height=&quot;270&quot; title=&quot;詰めマンカラ&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;　先手が&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2&lt;/code&gt;を選べば&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;11&lt;/code&gt;の豆を横取りして、次にＡＩは自陣の豆が無くなります。&lt;br /&gt;
　ということで&lt;strong&gt;問題１の正解は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3&lt;/code&gt;です&lt;/strong&gt;。&lt;/p&gt;

&lt;h3 id=&quot;長手数問題&quot;&gt;長手数問題&lt;/h3&gt;
&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/ai_lose01.png&quot;&gt;&lt;img src=&quot;/images/ai_lose01.png&quot; alt=&quot;詰めマンカラ01&quot; width=&quot;480&quot; height=&quot;240&quot; title=&quot;詰めマンカラ01&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;　上の画面から先手が&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3&lt;/code&gt;-&amp;gt;ピッタリ-&amp;gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;6&lt;/code&gt;-&amp;gt;ピッタリ-&amp;gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt;と進むと以下の局面になります。&lt;/p&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/ai_lose02.png&quot;&gt;&lt;img src=&quot;/images/ai_lose02.png&quot; alt=&quot;詰めマンカラ02&quot; width=&quot;480&quot; height=&quot;240&quot; title=&quot;詰めマンカラ02&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;　この段階でＡＩの形勢Emojiが:tired_face:になりました。ＡＩは負けを覚悟したようです。負けを覚悟しながらもＡＩは&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;13&lt;/code&gt;を選びました。&lt;br /&gt;
　&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;13&lt;/code&gt;-&amp;gt;ピッタリ-&amp;gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;12&lt;/code&gt;と進んだ局面が以下です。&lt;/p&gt;

&lt;h4 id=&quot;問題２&quot;&gt;問題２&lt;/h4&gt;
&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/ai_lose03.png&quot;&gt;&lt;img src=&quot;/images/ai_lose03.png&quot; alt=&quot;詰めマンカラ03&quot; width=&quot;480&quot; height=&quot;240&quot; title=&quot;詰めマンカラ03&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;　この局面で何番のポケットが先手の最善手でしょう？&lt;/p&gt;

&lt;h5 id=&quot;1を選んでみると-1&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt;を選んでみると&lt;/h5&gt;
&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/ai_win01.png&quot;&gt;&lt;img src=&quot;/images/ai_win01.png&quot; alt=&quot;ＡＩ勝ち01&quot; width=&quot;480&quot; height=&quot;240&quot; title=&quot;ＡＩ勝ち01&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;　上図のようになりＡＩの形勢Emojiが:frowning:に変わりました。これは詰みを逃したことを意味します。&lt;br /&gt;
　&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2&lt;/code&gt;のポケットが５個になり、次にピッタリを狙って一見得しそうですが、ＡＩが次に
　&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;13&lt;/code&gt;-&amp;gt;ピッタリ-&amp;gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;10&lt;/code&gt;と進めて以下の局面になって、ピッタリが防がれてしまいます。&lt;/p&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/ai_win02.png&quot;&gt;&lt;img src=&quot;/images/ai_win02.png&quot; alt=&quot;ＡＩ勝ち02&quot; width=&quot;480&quot; height=&quot;240&quot; title=&quot;ＡＩ勝ち02&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;　この後はどう変化しても&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;4&lt;/code&gt;と&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;5&lt;/code&gt;のポケットに溜め込んでいる豆を吐き出すことになり、逆転してＡＩが有利になります。&lt;/p&gt;

&lt;h5 id=&quot;2を選んでみると-1&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2&lt;/code&gt;を選んでみると&lt;/h5&gt;
&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/ai_lose04.png&quot;&gt;&lt;img src=&quot;/images/ai_lose04.png&quot; alt=&quot;詰み04&quot; width=&quot;480&quot; height=&quot;240&quot; title=&quot;詰み04&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;　上図のようになりＡＩの形勢Emojiも:tired_face:のままです。ＡＩが次に
　&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;13&lt;/code&gt;-&amp;gt;ピッタリ-&amp;gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;10&lt;/code&gt;と進めて以下の局面になりますが、&lt;/p&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/ai_lose07.png&quot;&gt;&lt;img src=&quot;/images/ai_lose07.png&quot; alt=&quot;詰み07&quot; width=&quot;480&quot; height=&quot;240&quot; title=&quot;詰み07&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;　この後は先手（下側）が&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3&lt;/code&gt;のポケットを選べば、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt;の豆は取られてしまいますが、先手が勝ちます。&lt;br /&gt;
　気付いた人がいるかも知れませんが、この局面は&lt;strong&gt;問題１&lt;/strong&gt;の局面と同じです。&lt;/p&gt;

&lt;h5 id=&quot;3を選んでみると-1&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3&lt;/code&gt;を選んでみると&lt;/h5&gt;
&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/ai_lose05.png&quot;&gt;&lt;img src=&quot;/images/ai_lose05.png&quot; alt=&quot;詰み05&quot; width=&quot;480&quot; height=&quot;270&quot; title=&quot;詰み05&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;　上図のようになりＡＩの形勢Emojiも:tired_face:のままです。ＡＩが次に
　&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;13&lt;/code&gt;-&amp;gt;ピッタリ-&amp;gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;10&lt;/code&gt;と進めて以下の局面になりますが、&lt;/p&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/ai_lose06.png&quot;&gt;&lt;img src=&quot;/images/ai_lose06.png&quot; alt=&quot;詰み06&quot; width=&quot;480&quot; height=&quot;270&quot; title=&quot;詰み06&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;　先手（下側）は今度は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt;のポケットを選んで&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;11&lt;/code&gt;の豆を横取り、&lt;br /&gt;
　後手が&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;13&lt;/code&gt;-&amp;gt;ピッタリ-&amp;gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;12&lt;/code&gt;で以下の画面。&lt;/p&gt;
&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/ai_lose08.png&quot;&gt;&lt;img src=&quot;/images/ai_lose08.png&quot; alt=&quot;詰み08&quot; width=&quot;480&quot; height=&quot;270&quot; title=&quot;詰み08&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;　この局面を新たな３手詰問題としてもいいかも知れません。相手陣に豆は一つしか残っていないのですが、間違えると勝負が紛れます。先手はどこを選んでも相手陣に豆が渡ってしまう状態になっています。こういう時、自分に勝ちがあることに気づかず着手する人が結構多いのでは無いでしょうか？また、少し慣れた人だと、「&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;4&lt;/code&gt;を選べば相手の&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;13&lt;/code&gt;の豆を横取り出来るぞ」なんて読んでしまう人がいるかも知れません。&lt;br /&gt;
　でも正解は相手陣に無駄に豆を供給しない手、一番豆の少ない&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2&lt;/code&gt;が好手です。&lt;/p&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/ai_lose09.png&quot;&gt;&lt;img src=&quot;/images/ai_lose09.png&quot; alt=&quot;詰み09&quot; width=&quot;480&quot; height=&quot;270&quot; title=&quot;詰み09&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;　こうなると先手の&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;5&lt;/code&gt;の９個の豆は横取りされてしまうのですが、先手には&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3&lt;/code&gt;に一個残っている（一手パスするような手が残っている）のでＡＩが&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;8&lt;/code&gt;を選んでも&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;13&lt;/code&gt;を選んでも自陣に豆が無くなり先手の勝ちになります。&lt;br /&gt;
　ということで&lt;strong&gt;問題２の正解は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3&lt;/code&gt;か&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2&lt;/code&gt;です&lt;/strong&gt;。&lt;br /&gt;
　正解が二つあるということで詰将棋で言えば余詰めがあるようなものなので、詰マンカラの例としては良くないのかも知れません。&lt;/p&gt;

&lt;p&gt;　ＡＩは&lt;strong&gt;問題２&lt;/strong&gt;の局面の前から既に&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;アプリ&lt;/a&gt;の形勢Emojiが:tired_face:に変わっていて、詰みを読み切っていたわけです。人間が読み切るのは大変かもしれませんが、形勢Emojiが:tired_face:に変わったら詰み（勝ち）があるということなので、マンカラを詰将棋を解く気持ちで楽しんでみるのも面白いと思います。&lt;/p&gt;

&lt;h3 id=&quot;ボードゲームは必勝法追求より楽しんだ者勝ち&quot;&gt;ボードゲームは必勝法追求より楽しんだ者勝ち&lt;/h3&gt;
&lt;p&gt;　&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;アプリ&lt;/a&gt;をリリースしてからは、テストも兼ねてgoogle play内のマンカラアプリをいろいろダウンロードして試しに遊んでみました。必ずしもダウンロード数が多いアプリが強いわけではなく、強さとユーザーの評価とはあまり関係ないようです。宣伝にどれだけ金かけているかの違いだと思いますが、強いソフトが商売として成功するとは限らない点は将棋アプリについても言えることでしょう。&lt;br /&gt;
　ただ、強いアプリはどれもだいたい似たような指し手になるようで、何度も対戦していると勝ちパターンも分かってきて楽しめなくなります。将棋ほど変化が多くないので仕方がないのかも知れません。そこで&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;「マンカラ ナッツ」&lt;/a&gt;では、最強の&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;やばい&lt;/code&gt;モード以外の&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;強い&lt;/code&gt;、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;弱い&lt;/code&gt;モードでは初手を評価値とは関係なく乱数で選ぶようにしています&lt;sup id=&quot;fnref:3&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:3&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;。初手を乱数に変えるだけで全てのパターンに対応するのは難しく、勝ったり負けたりゲームを楽しめると思います。自分は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;やばい&lt;/code&gt;モードでは先手の時の勝ちパターンが分かってきたのですが、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;強い&lt;/code&gt;モードでは先手でも勝てない時が多いのでいつも&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;強い&lt;/code&gt;モードで遊んでます。&lt;/p&gt;

&lt;div&gt;
    &lt;script async=&quot;&quot; src=&quot;https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js&quot;&gt;&lt;/script&gt;
    &lt;!-- display01 --&gt;
    &lt;ins class=&quot;adsbygoogle&quot; style=&quot;display:block&quot; data-ad-client=&quot;ca-pub-9018029357773039&quot; data-ad-slot=&quot;3925247388&quot; data-ad-format=&quot;auto&quot; data-full-width-responsive=&quot;true&quot;&gt;&lt;/ins&gt;
    &lt;script&gt;
    (adsbygoogle = window.adsbygoogle || []).push({});
    &lt;/script&gt;
&lt;/div&gt;

&lt;hr /&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;詰将棋専用の評価関数と書きましたが、実際にそういう専用の評価関数が使われているソフトが存在するかは知りません。ただ全局面を完全に読み切れるのであれば本将棋でもこういう単純な評価関数で十分なわけです。将棋の場合完全には読み切れないので、形勢判断のためにいろいろな特徴量（駒得、玉の固さ等を数値化）を使って評価する必要が出てくるのですが、その形勢判断の精度が高い評価関数であれば、詰将棋用とか形勢判断用とか分けなくて済みます。 &lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;マンカラで形勢判断するとしたら、自陣にある種子（豆）の数とか、横取りされ易さ（対称の位置にある相手のポケットが空かどうか）とかを数値化するのでしょうか？よく分かりません。 &lt;a href=&quot;#fnref:2&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:3&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;全てのモードで評価値が同じ場合は乱数で着手を選ぶようになっていますが、初手に関しては評価値が低い手を敢えて選ばせているという意味です。 &lt;a href=&quot;#fnref:3&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</description>
        <pubDate>Sat, 21 Nov 2020 00:00:00 +0900</pubDate>
        <link>https://happyclam.github.io/software/2020-11-21/mancala_evaluate01</link>
        <guid isPermaLink="true">https://happyclam.github.io/software/2020-11-21/mancala_evaluate01</guid>
        
        <category>dart</category>
        
        <category>android</category>
        
        <category>flutter</category>
        
        <category>c++</category>
        
        <category>mancala</category>
        
        
        <category>software</category>
        
      </item>
    
      <item>
        <title>C++でFlutterアプリのライブラリ作成</title>
        <description>&lt;h3 id=&quot;その簡単さに驚く&quot;&gt;その簡単さに驚く&lt;/h3&gt;
&lt;p&gt;　&lt;a href=&quot;/software/2020-09-19/js_dart_cpp&quot;&gt;前回の記事&lt;/a&gt;で作ったC++製のプログラムをアプリで利用しない手は無いと思いちょっと調べてみたら非常に簡単に作れそうなのでやってみました。自分の場合は取り敢えずandroid版しか考えていないので、&lt;a href=&quot;https://flutter.dev/docs/development/platform-integration/c-interop&quot;&gt;公式サイト&lt;/a&gt;に書かれている僅かな手順を踏めば、ライブラリ（Plugin）とそのテストをするためのExampleプロジェクトが出来上がります。&lt;/p&gt;

&lt;h3 id=&quot;情報が少なめ&quot;&gt;情報が少なめ&lt;/h3&gt;
&lt;p&gt;　Flutter,Pluginで検索するとPluginを公開する前提で書かれている記事が多くて、自分のアプリ用のライブラリとして使うケースについては情報が少ないような気がします。Java（あるいはKotlin）やSwiftを経由してC++のライブラリを使う方法なんかもあるようですが、C++だけで済ませたかった自分には参考になる記事は少なかったです。&lt;br /&gt;
　&lt;a href=&quot;https://flutter.dev/docs/development/platform-integration/c-interop&quot;&gt;前述の公式サイトの記事&lt;/a&gt;で&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Dart:ffi&lt;/code&gt;を使えばint型のデータだけなら簡単にやり取りできるのは分かったのですが、intだけじゃ大変だなと思っていたところ、&lt;a href=&quot;https://www.google.co.jp/search?sxsrf=ALeKk0278rFY7cQTrFc34ZLGoL92Ncc_3w%3A1601382825947&amp;amp;source=hp&amp;amp;ei=qSlzX7TPNsuNoASIrIagBw&amp;amp;q=Flutter%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%A7dart%3Affi%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B&amp;amp;oq=Flutter%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%A7dart%3Affi%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B&amp;amp;gs_lcp=CgZwc3ktYWIQAzoICAAQsQMQgwE6BwgAELEDEAQ6BggAEAQQAzoECAAQBDoFCAAQsQM6AggAOggIABAFEAQQHjoGCAAQBRAeOgUIABDNAlCBF1j5c2D9dGgGcAB4AIABdIgB5x2SAQUyMy4xNpgBAKABAaoBB2d3cy13aXo&amp;amp;sclient=psy-ab&amp;amp;ved=0ahUKEwj0x_Lzr47sAhXLBogKHQiWAXQQ4dUDCAw&amp;amp;uact=5&quot;&gt;「Flutterプラグインでdart:ffiを使ってみる」というPDFファイル&lt;/a&gt;を読んでポインタ経由なら他のデータでもやり取り出来そうなことが分かって、やってみる気になりました。Dart:ffiだけで不足している機能は&lt;a href=&quot;https://pub.dev/packages/ffi&quot;&gt;ffiパッケージ&lt;/a&gt;として公開されているものを使います。&lt;/p&gt;

&lt;h3 id=&quot;ライブラリplugin用のプロジェクト作成&quot;&gt;ライブラリ（Plugin）用のプロジェクト作成&lt;/h3&gt;
&lt;p&gt;　iosでの利用も考えている人は違ってくると思います。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;flutter create --org io.github.happyclam --template=plugin --platforms=android karah_think
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　プロジェクトを作成したら&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;flutter build apk&lt;/code&gt;で一度ビルドした後、android/下のCMakeList.txtの編集&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# CMakeList.txt
cmake_minimum_required(VERSION 3.4.1)  # for example
set(CMAKE_CXX_FLAGS &quot;-O2 -std=c++11 -Wall&quot;)
add_library( karah_think

             # Sets the library as a shared library.
             SHARED

             # Provides a relative path to your source file(s).
             ../android/Classes/karah_think.cpp )

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　android/下にClassesという名のディレクトリを作成（何でもいい）して、C++のソースは全てそこに入れました。/android/Classes/karah_think.cppがアプリから呼び出される関数（エクスポート関数）が書かれているファイルです。&lt;a href=&quot;/software/2020-09-19/js_dart_cpp&quot;&gt;前回の記事&lt;/a&gt;でも書いたコンパイルオプションもこのファイル（CMakeList.txt）で定義します。&lt;br /&gt;
　これだけでライブラリ開発環境が出来て、karah_thinkプロジェクト内に自動作成されたExampleプロジェクトをAndroid Studioで読み込めばライブラリの開発＆テストが出来ます。Exampleプロジェクトをビルドすればライブラリ（libkarah_think.so）もビルドされます。&lt;br /&gt;
　ここまでは上記の公式サイトに書かれている内容です。&lt;/p&gt;

&lt;h3 id=&quot;作ったライブラリpluginをアプリのプロジェクトで使う&quot;&gt;作ったライブラリ（Plugin）をアプリのプロジェクトで使う&lt;/h3&gt;
&lt;p&gt;　ライブラリの中身はマンカラで使う要素１４個の固定長配列、手番（先手・後手）、読みの深さを渡して最善手を返して貰うラッパー関数を書くだけなのですぐに実装出来ました。でも、この出来上がったライブラリをどうやって元々存在するマンカラアプリのプロジェクトから使うのか分からなかったのですが、Flutterで公開されているパッケージを使う時と同じように、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pubspec.yaml&lt;/code&gt;に依存関係を記述するだけでした。&lt;br /&gt;
　マンカラアプリのプロジェクトの&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pubspec.yaml&lt;/code&gt;内の依存関係に、ライブラリのプロジェクトが存在するローカルのPathを追記します。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#pubspec.yaml
dependencies:
  flutter:
    sdk: flutter
  karah_think:
    path: &quot;../karah_think/&quot;
  ffi: ^0.1.3

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　マンカラアプリプロジェクト（mancala）とC++ライプラリプロジェクト（karah_think）とライブラリ動作確認用プロジェクト（example）の関係は以下のようになっています。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;├── mancala
│   ├── pubspec.yaml
├── karah_think
│   ├── example

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　ライブラリを使う側のマンカラアプリプロジェクトの&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lib/main.dart&lt;/code&gt;の宣言部分はこんな感じです。&lt;br /&gt;
　引数は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;評価値と指し手を受け取るための配列&lt;/code&gt;、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;マンカラの盤面情報を渡す配列&lt;/code&gt;、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;手番（先手・後手）&lt;/code&gt;、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;読みの深さ&lt;/code&gt;になってます。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#mancala/lib/main.dart
import 'dart:typed_data';
import 'dart:ffi'; // For FFI
import 'dart:io'; // For Platform.isX
import 'package:ffi/ffi.dart';
final DynamicLibrary karahThinkLib = Platform.isAndroid
    ? DynamicLibrary.open(&quot;libkarah_think.so&quot;)
    : DynamicLibrary.process();

final int Function(Pointer&amp;lt;Int32&amp;gt; pResult, Pointer&amp;lt;Int32&amp;gt; board, int turn, int depth) karahThink =
karahThinkLib
    .lookup&amp;lt;NativeFunction&amp;lt;Int32 Function(Pointer&amp;lt;Int32&amp;gt;, Pointer&amp;lt;Int32&amp;gt;, Int32, Int32)&amp;gt;&amp;gt;(&quot;karah_think&quot;)
    .asFunction();

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　ライブラリ（libkarah_think.so）のエクスポート関数を呼び出す部分&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#mancala/lib/main.dart
  List _cppThink(List board, int turn, int depth){
    final pBoard32 = allocate&amp;lt;Int32&amp;gt;(count: board.length);
    Pointer&amp;lt;Int32&amp;gt; pResult32 = allocate&amp;lt;Int32&amp;gt;(count: 2);
    for (var i = 0; i &amp;lt; board.length; i++){
      pBoard32[i] = board[i];
    }
    int ret = karahThink(pResult32, pBoard32, turn, depth);
    Int32List list = pResult32.asTypedList(2);
    List result = List.from(list);
    free(pBoard32);
    free(pResult32);
    return result;
  }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　ライブラリのエクスポート関数&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/* karah_think/android/Classes/karah_think.cpp */
#include &amp;lt;stdint.h&amp;gt;
#include &amp;lt;iostream&amp;gt;
#include &amp;lt;array&amp;gt;
#include &amp;lt;map&amp;gt;
#include &quot;./const.cpp&quot;
#include &quot;./player.cpp&quot;

extern &quot;C&quot; __attribute__((visibility(&quot;default&quot;))) __attribute__((used))
int32_t karah_think(int32_t* pResult, int32_t* pBoard, int32_t turn, int32_t depth) {
  int32_t ret = 0;
  std::array&amp;lt;int, DENTS&amp;gt; board{0,0,0,0,0,0,0,0,0,0,0,0,0,0};
  std::array&amp;lt;int, 2&amp;gt; result{0, 0};
  for(int i = 0; i &amp;lt; DENTS; i++){
    board[i] = pBoard[i];
  }
  Player *pFirst = new Player(FIRST);
  Player *pSecond = new Player(SECOND);
  if (turn == FIRST){
    result = pFirst-&amp;gt;think(board, pSecond, depth, FIRST_WIN);
  } else {
    result = pSecond-&amp;gt;think(board, pFirst, depth, SECOND_WIN);
  }
  ret = result[0];
  pResult[0] = result[0];
  pResult[1] = result[1];
  delete pFirst;
  delete pSecond;
  return ret;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　C++側はSTLを使っているので型に合わせた変数に代入し直して利用します。&lt;/p&gt;

&lt;h3 id=&quot;効果は歴然&quot;&gt;効果は歴然&lt;/h3&gt;
&lt;p&gt;　今まではマンカラアプリのAIのレベルを「やばい」にすると一手毎に待たされていたのですが、C++製ライブラリを使ったものは他のAIレベルと同じぐらいのレスポンスになりました。&lt;br /&gt;
　Windows用のライブラリと違って、様々なCPUに合わせたAndroid端末毎のDLLが簡単なGUI操作（中で活躍してるのはgradleですが）でビルド出来るのはすごいです。&lt;br /&gt;
　将棋関連アプリも早くこの形でリリースしたいところですが、マンカラのように一つの固定長配列を渡すだけでは済まないので、いろいろ試してみないと分からないことが多く道のりは遠いです。&lt;/p&gt;

&lt;div&gt;
    &lt;script async=&quot;&quot; src=&quot;https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js&quot;&gt;&lt;/script&gt;
    &lt;!-- display01 --&gt;
    &lt;ins class=&quot;adsbygoogle&quot; style=&quot;display:block&quot; data-ad-client=&quot;ca-pub-9018029357773039&quot; data-ad-slot=&quot;3925247388&quot; data-ad-format=&quot;auto&quot; data-full-width-responsive=&quot;true&quot;&gt;&lt;/ins&gt;
    &lt;script&gt;
    (adsbygoogle = window.adsbygoogle || []).push({});
    &lt;/script&gt;
&lt;/div&gt;

&lt;hr /&gt;

</description>
        <pubDate>Thu, 01 Oct 2020 00:00:00 +0900</pubDate>
        <link>https://happyclam.github.io/software/2020-10-01/flutter_plugin</link>
        <guid isPermaLink="true">https://happyclam.github.io/software/2020-10-01/flutter_plugin</guid>
        
        <category>dart</category>
        
        <category>android</category>
        
        <category>flutter</category>
        
        <category>c++</category>
        
        
        <category>software</category>
        
      </item>
    
      <item>
        <title>Dartは遅いけど、FlutterでGUIは有り</title>
        <description>&lt;h3 id=&quot;dartに絶望flutterでguiは有り&quot;&gt;Dartに絶望FlutterでGUIは有り&lt;/h3&gt;
&lt;p&gt;　Qiitaのどなたかの記事でDartはJavaScriptより実行速度が倍程速いと書かれているのを見かけて、期待しながら今リリースしているCoffeeScript（JavaScript）製の&lt;a href=&quot;https://play.google.com/store/apps/details?id=shogi55.io.github.happyclam&quot;&gt;５五将棋アプリ&lt;/a&gt;のGUI以外の部分をDartで書き直して比較したのですが、テストの結果からDartの方が遅いことが分かりました。Flutter(Dart)で&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;マンカラアプリ&lt;/a&gt;を作ってみてGUIの作り易さに感動した&lt;sup id=&quot;fnref:1&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;だけに非常に失望しました。&lt;br /&gt;
　&lt;a href=&quot;https://play.google.com/store/apps/details?id=shogi55.io.github.happyclam&quot;&gt;今のアプリ&lt;/a&gt;よりも実行速度が遅いのならFlutterで将棋関連のアプリを作り直す意味がないので、どうしようかと思い、&lt;a href=&quot;/software/2020-06-07/mancala&quot;&gt;以前の記事&lt;/a&gt;で書いたマンカラアプリなら行数も少ないのでとりあえずこれを題材にTypeScriptとC++で書き直して比較してみました。&lt;/p&gt;

&lt;h3 id=&quot;比較の元となるdartの実行結果&quot;&gt;比較の元となるDartの実行結果&lt;/h3&gt;
&lt;p&gt;　６×２列のマンカラカラハの先読みプログラムの実行結果です。何をやっているかは&lt;a href=&quot;/software/2020-06-07/mancala&quot;&gt;以前の記事&lt;/a&gt;を参照してください。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ dart mancala.dart
[0, 2, 2, 2, 2, 2, 2, 0, 2, 2, 2, 2, 2, 2]
=== result = 1, 5, i = 1
=== result = 0, 5, i = 2
=== result = 3, 5, i = 3
=== result = 4, 5, i = 4
=== result = 5, 5, i = 5
=== result = 4, 5, i = 6
=== result = 5, 5, i = 7
=== result = 4, 5, i = 8
=== result = 4, 5, i = 9
=== result = 4, 5, i = 10
=== result = 3, 5, i = 11
=== result = 5, 5, i = 12
=== result = 4, 5, i = 13
=== result = 5, 5, i = 14
=== result = 6, 5, i = 15
=== result = 2, 6, i = 16
=== result = 3, 6, i = 17
=== result = 999, 5, i = 18
4040941
[999, 5]

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　１８手で先手必勝を読み切るまでに4040秒（１時間強）&lt;/p&gt;

&lt;h3 id=&quot;まずはtypescript&quot;&gt;まずはTypeScript&lt;/h3&gt;
&lt;p&gt;　好きなCoffeeScriptはマイナーになってしまったので、Dartの存在を知る前から今の将棋関連アプリをいずれTypeScriptに書き換えるべきかなと思っていたのでまずはこれで試しました。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ts-node mancala.ts
[ 0, 2, 2, 2, 2, 2, 2, 0, 2, 2, 2, 2, 2, 2 ]
result = [ 1, 5, [length]: 2 ], i = 1
result = [ 0, 5, [length]: 2 ], i = 2
result = [ 3, 5, [length]: 2 ], i = 3
result = [ 4, 5, [length]: 2 ], i = 4
result = [ 5, 5, [length]: 2 ], i = 5
result = [ 4, 5, [length]: 2 ], i = 6
result = [ 5, 5, [length]: 2 ], i = 7
result = [ 4, 5, [length]: 2 ], i = 8
result = [ 4, 5, [length]: 2 ], i = 9
result = [ 4, 5, [length]: 2 ], i = 10
result = [ 3, 5, [length]: 2 ], i = 11
result = [ 5, 5, [length]: 2 ], i = 12
result = [ 4, 5, [length]: 2 ], i = 13
result = [ 5, 5, [length]: 2 ], i = 14
result = [ 6, 5, [length]: 2 ], i = 15
result = [ 2, 6, [length]: 2 ], i = 16
result = [ 3, 6, [length]: 2 ], i = 17
result = [ 999, 5, [length]: 2 ], i = 18
ms = 2862324
[ 999, 5 ]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　同じ結果を得るまでに2862秒（１時間弱）で、やはりDartよりJSの方が速いようです。将棋の場合これ以上に明確な差がありました。&lt;/p&gt;

&lt;h3 id=&quot;cはやはり最強&quot;&gt;C++はやはり最強&lt;/h3&gt;
&lt;p&gt;　苦労してC++で将棋関連アプリを書き直しても、そのままではスマホアプリに出来ないので今までは避けていました。でもFlutterでGUI部分を作って思考部分だけC++で作ればいいんじゃないかなんて考えて試してみました&lt;sup id=&quot;fnref:2&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:2&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;。&lt;br /&gt;
　C言語を使うのが久しぶりでよく調べずに一度間違った記事をアップしてしまったのですが、以下がC++の結果です&lt;sup id=&quot;fnref:3&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:3&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ g++ mancala.cpp -O2 -o mancala.out
$ ./mancala.out
0,2,2,2,2,2,2,0,2,2,2,2,2,2,
=== result = 1, 5, i = 1
=== result = 0, 5, i = 2
=== result = 3, 5, i = 3
=== result = 4, 5, i = 4
=== result = 5, 5, i = 5
=== result = 4, 5, i = 6
=== result = 5, 5, i = 7
=== result = 4, 5, i = 8
=== result = 4, 5, i = 9
=== result = 4, 5, i = 10
=== result = 3, 5, i = 11
=== result = 5, 5, i = 12
=== result = 4, 5, i = 13
=== result = 5, 5, i = 14
=== result = 6, 5, i = 15
=== result = 2, 6, i = 16
=== result = 3, 6, i = 17
=== result = 999, 5, i = 18
700673.273000[ms]
999, 5
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　結果は、700秒（約１１分）!!やはり最強でした。&lt;/p&gt;

&lt;p&gt;　プログラムを他の言語に移植すると言っても同じオブジェクト指向言語であればほとんどコードは一対一に書き換え可能で、写経に近いものがあります&lt;sup id=&quot;fnref:4&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:4&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;。元々のDartのプログラムにはまだまだ改良の余地があると思いますが、拙いコードであってもバグがあったとしても、今回比較した３つのプログラムは行数も少なく同じ処理をしていますので、拙いコードもバグも同じまま、実行時間だけを比較していると言えると思います&lt;sup id=&quot;fnref:5&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:5&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;5&lt;/a&gt;&lt;/sup&gt;。実行結果も同じです。&lt;/p&gt;

&lt;h3 id=&quot;マンカラの必勝法は&quot;&gt;マンカラの必勝法は？&lt;/h3&gt;
&lt;p&gt;　今回、マンカラの先読みプログラムをC++に移植したのは、以前の&lt;a href=&quot;/software/2020-06-07/mancala&quot;&gt;マンカラの記事&lt;/a&gt;、&lt;a href=&quot;/software/2020-08-09/mancala_easy&quot;&gt;続編&lt;/a&gt;の課題である、マンカラカラハ（６×２列で種子４つ）の必勝法を見つける目論見も兼ねていたのですが、C++版で実行時間が短縮されたと言っても、この程度では必勝法を見つけることが出来るかどうかは分かりません。１時間掛かった作業が１０分で可能になったと言っても、もし読み切るのに１年以上掛かる作業だとしたら、やはり数ヶ月以上掛かることには変わりませんから。&lt;/p&gt;

&lt;div&gt;
    &lt;script async=&quot;&quot; src=&quot;https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js&quot;&gt;&lt;/script&gt;
    &lt;!-- display01 --&gt;
    &lt;ins class=&quot;adsbygoogle&quot; style=&quot;display:block&quot; data-ad-client=&quot;ca-pub-9018029357773039&quot; data-ad-slot=&quot;3925247388&quot; data-ad-format=&quot;auto&quot; data-full-width-responsive=&quot;true&quot;&gt;&lt;/ins&gt;
    &lt;script&gt;
    (adsbygoogle = window.adsbygoogle || []).push({});
    &lt;/script&gt;
&lt;/div&gt;

&lt;hr /&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;アニメーションなんてほとんど経験ないのにネットでググりながら進めたら簡単に作れました。 &lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;昔、GUIはVisualBasicで作って内部処理はVisualC++で作る（DLL）なんて仕事をよくしていました。 &lt;a href=&quot;#fnref:2&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:3&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;コンパイルオプション(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-O&lt;/code&gt;、または&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-O2&lt;/code&gt;)を付加することで末尾最適化してくれるそうです。そう言えば昔はスタックサイズやらいろいろコンパイルオプションを付けなければ上手くいかなかった記憶があります。自分がC言語から遠ざかっている間にコンパイラも進化しているようです。 &lt;a href=&quot;#fnref:3&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:4&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;プログラムの行数もほぼ同じ、コードもほぼ一対一で書式だけが違う感じで、C++だけクラス変数の初期化部分が少し違う程度です。 &lt;a href=&quot;#fnref:4&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:5&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;実際に微妙なバグがあったので出力内容は現在では違う内容になってます。&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;アプリ&lt;/a&gt;の方は修正済みです。 &lt;a href=&quot;#fnref:5&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</description>
        <pubDate>Sat, 19 Sep 2020 00:00:00 +0900</pubDate>
        <link>https://happyclam.github.io/software/2020-09-19/js_dart_cpp</link>
        <guid isPermaLink="true">https://happyclam.github.io/software/2020-09-19/js_dart_cpp</guid>
        
        <category>dart</category>
        
        <category>android</category>
        
        <category>flutter</category>
        
        <category>typescript</category>
        
        <category>c++</category>
        
        
        <category>software</category>
        
      </item>
    
      <item>
        <title>マンカラアプリについて</title>
        <description>&lt;p&gt;&lt;a href=&quot;https://taimienphi.vn/download-mancala-nuts-90337&quot;&gt;&lt;img src=&quot;/images/tmp2.png&quot; alt=&quot;マンカラアプリ&quot; title=&quot;マンカラ ナッツ&quot; width=&quot;155&quot; height=&quot;60&quot; /&gt;&lt;/a&gt;
&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;&lt;img src=&quot;/images/ja_badge_web_generic.png&quot; alt=&quot;マンカラアプリ&quot; title=&quot;マンカラ ナッツ&quot; width=&quot;155&quot; height=&quot;60&quot; /&gt;&lt;/a&gt;
&lt;a href=&quot;https://www.amazon.co.jp/happyclam-マンカラ-ナッツ/dp/B08D8QVVQY/ref=sr_1_2&quot;&gt;&lt;img src=&quot;/images/amazon-appstore-badge-jp-white.png&quot; alt=&quot;マンカラアプリ&quot; title=&quot;マンカラ ナッツ&quot; width=&quot;155&quot; height=&quot;60&quot; /&gt;&lt;/a&gt;
&lt;br /&gt;&lt;a href=&quot;https://taimienphi.vn&quot; title=&quot;download&quot;&gt;taimienphi.vn&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;マンカラ-ナッツについて&quot;&gt;「マンカラ ナッツ」について&lt;/h3&gt;
&lt;p&gt;　対人戦の途中でＡＩ対戦に切り替えたり、ＡＩ対戦の途中で対人戦に切り替えたりして、マンカラの特定の局面での最善手の研究にも使えるように配慮したマンカラアプリです。&lt;br /&gt;
　Version1.1.6で豆の数を３個〜７個から選べるようにしました。また、対戦成績を先手番・後手番別に保存するようにしました。豆の数によって先手有利・後手有利の違いがあります。&lt;br /&gt;
　勝ちパターンを覚えてしまうとゲームを楽しめないので、Version1.1.9から&lt;strong&gt;ランダム配置機能&lt;/strong&gt;を追加しました。&lt;/p&gt;

&lt;h3 id=&quot;ルール&quot;&gt;ルール&lt;/h3&gt;
&lt;p&gt;　数あるマンカラのルールの中で、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;カラハ（Karah）&lt;/code&gt;と呼ばれるルールを採用しています。&lt;br /&gt;
　上下２列に並んだ６つのポケットに豆が入っていて、上がAI、下があなたです。丸い６つのポケットからどれかを選んで豆を取り出し、反時計回りに豆を一つずつポケットに撒いていきます。どちらかの６つのポケットが全て空になったらゲーム終了し、右側の四角い自分の貯蔵所に残った豆の数で勝ち負けを判定します。&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;相手の貯蔵所には豆を撒きません。&lt;/li&gt;
  &lt;li&gt;豆を撒き終わったポケットが自分の貯蔵所の場合、もう一度ポケットを選んで豆を撒くことが出来ます（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ピッタリ&lt;/code&gt;）。&lt;/li&gt;
  &lt;li&gt;自分の空のポケットで豆を撒き終わった時にその対称に位置する相手のポケットに豆が存在する場合、その豆を&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;横取り&lt;/code&gt;（Capture）して自分の貯蔵所に加えることが出来ます。&lt;/li&gt;
  &lt;li&gt;ゲーム終了時にポケットに残った豆は全て自分の貯蔵所に加えます。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;　同じ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;カラハ（Karah）&lt;/code&gt;と称するルールでも細かな違いがあるケースが存在しますが、&lt;a href=&quot;https://www.nintendo.co.jp/switch/as7ta/&quot;&gt;Nintendo Switchの世界のアソビ大全51&lt;/a&gt;に収録されているマンカラと同じルールにしています。&lt;/p&gt;

&lt;h3 id=&quot;機能&quot;&gt;機能&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;ＡＩ対戦（レベルは３段階）&lt;/li&gt;
  &lt;li&gt;対人対戦&lt;/li&gt;
  &lt;li&gt;待った機能&lt;/li&gt;
  &lt;li&gt;豆選択（コーヒー、ピスタチオ、アーモンド）機能&lt;/li&gt;
  &lt;li&gt;豆の数選択機能（３個〜７個）&lt;/li&gt;
  &lt;li&gt;先手後手別、対戦成績保存機能（ゲーム途中で設定を変更しり、「待った」した場合は対戦成績には記録されません）&lt;/li&gt;
  &lt;li&gt;多言語対応、日&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ja&lt;/code&gt;, 英&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;en&lt;/code&gt;, 越&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vi&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;AI対戦時の形勢判断Emoji表示機能&lt;/li&gt;
  &lt;li&gt;ランダム配置機能&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;ａｉ対戦&quot;&gt;ＡＩ対戦&lt;/h3&gt;
&lt;div style=&quot;width:320px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/mancala_screen1.png&quot;&gt;&lt;img src=&quot;/images/mancala_screen1.png&quot; alt=&quot;ＡＩ対戦画面&quot; width=&quot;320&quot; height=&quot;180&quot; title=&quot;ＡＩ対戦画面&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;新規ゲーム(New Game)&lt;/code&gt;ボタンで新規対局開始されます。&lt;/li&gt;
  &lt;li&gt;ＡＩの対戦途中に強さ設定を変更すると、そのゲーム結果は対戦成績に記録されません。&lt;/li&gt;
  &lt;li&gt;ＡＩ対戦の場合は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;戻す(Undo)&lt;/code&gt;ボタンで一つ前の人間の手番まで戻ります。ＡＩが連続で複数回着手していた場合も複数手分のＡＩの指し手を飛ばして、一つ前の人間の手番の局面に戻ります。&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;戻す(Undo)&lt;/code&gt;ボタンを使用すると対戦成績には記録されません。&lt;/li&gt;
  &lt;li&gt;AIの静的評価関数は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;先手の貯蔵所に溜まった豆の数 - 後手の貯蔵所に溜まった豆の数&lt;/code&gt;で、MIN-MAX法（+ αβ法）を使って先読みを行い指し手を決めます。
    &lt;ul&gt;
      &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;弱い(Easy)&lt;/code&gt; = ３手読み&lt;/li&gt;
      &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;強い(Hard)&lt;/code&gt; = ８手読み&lt;/li&gt;
      &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;やばい(Expert)&lt;/code&gt; = １１手読み&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;形勢emoji表示&quot;&gt;形勢Emoji表示&lt;/h4&gt;
&lt;div style=&quot;width:320px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/mancala_screen5.png&quot;&gt;&lt;img src=&quot;/images/mancala_screen5.png&quot; alt=&quot;ＡＩ形勢Emoji&quot; width=&quot;320&quot; height=&quot;180&quot; title=&quot;ＡＩ形勢Emoji&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;　&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AI対戦(One Player)&lt;/code&gt;時に画面右上に形勢判断用のEmojiを表示します。&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Emoji&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;文字コード&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;意味&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;:laughing:&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;U+1F923&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ＡＩが勝ちを確信。逆転は難しいでしょう。&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;:grin:&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;U+1F601&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ＡＩが優勢を意識。&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;:neutral_face:&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;U+1F610&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ＡＩは互角と判断。&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;:frowning:&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;U+1F641&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ＡＩは劣勢を意識。&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;:tired_face:&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;U+1F62B&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ＡＩが負けを覚悟。但し、勝負はあなたの着手しだいです&lt;sup id=&quot;fnref:1&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;。&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;※このページのEmojiは実際のAndroid端末で表示されるEmojiとは若干表示が異なるケースがあります。&lt;/p&gt;

&lt;h3 id=&quot;対人対戦&quot;&gt;対人対戦&lt;/h3&gt;
&lt;div style=&quot;width:320px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/mancala_screen2.png&quot;&gt;&lt;img src=&quot;/images/mancala_screen2.png&quot; alt=&quot;対人対戦画面&quot; width=&quot;320&quot; height=&quot;180&quot; title=&quot;対人対戦画面&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;新規ゲーム(Play)&lt;/code&gt;ボタンでゲーム開始、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;中止(Stop)&lt;/code&gt;ボタンでゲームを中断します。&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;先手&lt;/code&gt;が画面下側、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;後手&lt;/code&gt;が画面上側です。&lt;/li&gt;
  &lt;li&gt;ゲーム途中でＡＩ対戦に戻すことも出来ます。途中からＡＩ対戦に切り替えても、勝敗は対戦成績には記録されません。&lt;/li&gt;
  &lt;li&gt;対人対戦の場合は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;戻す(Undo)&lt;/code&gt;ボタンで一手ずつ前の局面に戻ります。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;設定画面&quot;&gt;設定画面&lt;/h3&gt;
&lt;div style=&quot;width:320px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/mancala_screen3.png&quot;&gt;&lt;img src=&quot;/images/mancala_screen3.png&quot; alt=&quot;設定画面&quot; width=&quot;320&quot; height=&quot;160&quot; title=&quot;設定画面&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;ゲームに使用する豆は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;コーヒー(Coffee)&lt;/code&gt;、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ピスタチオ(Pistachio)&lt;/code&gt;、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;アーモンド(Almond)&lt;/code&gt;の３種類から選べます。&lt;/li&gt;
  &lt;li&gt;初期の豆の数は３個〜７個の５種類から選べます（Version1.1.6以降）。&lt;/li&gt;
  &lt;li&gt;ＡＩの強さレベルは&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;弱い(Easy)&lt;/code&gt;、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;強い(Hard)&lt;/code&gt;、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;やばい(Expert)&lt;/code&gt;の３種類から選べます。&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AI対戦(One Player)&lt;/code&gt;を選ぶとＡＩ対戦、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;二人対戦(Two Players)&lt;/code&gt;を選ぶと対人戦が可能です。&lt;/li&gt;
  &lt;li&gt;ＡＩ対戦途中で設定内容を変更した場合そのＡＩ対戦の結果は対戦成績に保存されません。&lt;/li&gt;
  &lt;li&gt;同じパターンの指し手を避けるため、ＡＩのレベル&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;弱い(Easy)&lt;/code&gt;と&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;強い(Hard)&lt;/code&gt;では、初手はランダムに選ぶようにしています。&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;やばい(Expert)&lt;/code&gt;はガチで指し手を決めます&lt;sup id=&quot;fnref:2&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:2&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;。&lt;/li&gt;
  &lt;li&gt;全てのＡＩのレベルで、同じ評価値の場合はランダムに指し手を選択するようにしていますので、同じ局面で常に同じ指し手を選ぶとは限りません&lt;sup id=&quot;fnref:3&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:3&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;。&lt;/li&gt;
  &lt;li&gt;ＡＩ対戦時に&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;先手&lt;/code&gt;か&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;後手&lt;/code&gt;かを選べます。この設定は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;二人対戦(Two Players)&lt;/code&gt;時には意味はありません。&lt;/li&gt;
  &lt;li&gt;対戦を重ねると同じパターンで決着し、ゲームを楽しめなくなるのを防ぐため&lt;strong&gt;ランダム配置機能&lt;/strong&gt;追加しました（Version1.1.9以降）。設定画面で「ランダム」を選ぶと豆の初期配置が先手・後手同じでランダムな配置になります&lt;sup id=&quot;fnref:4&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:4&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;ゲーム成績画面&quot;&gt;ゲーム成績画面&lt;/h3&gt;
&lt;div style=&quot;width:320px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/mancala_screen4.png&quot;&gt;&lt;img src=&quot;/images/mancala_screen4.png&quot; alt=&quot;ＡＩ対戦成績画面&quot; width=&quot;320&quot; height=&quot;180&quot; title=&quot;ＡＩ対戦成績画面&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;ＡＩ対戦の対戦成績を閲覧出来ます（Version1.1.6から、対戦成績を先手・後手別に保存するようにしました）。&lt;br /&gt;
※旧バージョンから新バージョンにバージョンアップすると、旧バージョンには先手番後手番の情報が無いので、全て先手番の成績として移行します。&lt;/li&gt;
  &lt;li&gt;豆の数（３〜７）別に対戦成績が記録されます。表の左上の数字はゲーム開始時に配置されている豆の数です。&lt;/li&gt;
  &lt;li&gt;ゲーム成績を初期化する場合は、ゲームアイコンを長押しし、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;アプリ情報&lt;/code&gt;-&amp;gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ストレージとキャッシュ&lt;/code&gt;-&amp;gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ストレージを消去&lt;/code&gt;で初期化して下さい。全ての設定がゲームインストール時と同様に初期化されます。&lt;/li&gt;
&lt;/ul&gt;

&lt;div&gt;
    &lt;script async=&quot;&quot; src=&quot;https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js&quot;&gt;&lt;/script&gt;
    &lt;!-- display01 --&gt;
    &lt;ins class=&quot;adsbygoogle&quot; style=&quot;display:block&quot; data-ad-client=&quot;ca-pub-9018029357773039&quot; data-ad-slot=&quot;3925247388&quot; data-ad-format=&quot;auto&quot; data-full-width-responsive=&quot;true&quot;&gt;&lt;/ins&gt;
    &lt;script&gt;
    (adsbygoogle = window.adsbygoogle || []).push({});
    &lt;/script&gt;
&lt;/div&gt;

&lt;hr /&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;ＡＩのレベル毎の先読みの手数（３手、８手、１１手）以内に勝ちがある（将棋で言うと詰みがある）状態です。よく考えて着手してください。:tired_face:の絵文字が表示された後の着手でＡＩの表情が他のものに変わった場合、勝ち（詰み）を逃したことを意味します。 &lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;一時期&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;やばい(Expert)&lt;/code&gt;モードでも初手をランダムにしてリリースしていた時期がありましたが、マンカラの場合、初手に悪手を選ぶとその段階で回復不可能な程形勢を大きく損ねるようなので、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;やばい(Expert)&lt;/code&gt;の時だけは初手のランダム指し手を止めました。将棋やチェスなどと較べると初手から既に勝敗に大きく影響するようです。 &lt;a href=&quot;#fnref:2&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:3&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;戻す(Undo)&lt;/code&gt;ボタンで数手前の局面に戻してからAI対戦を再開しても、前回と同じ局面になるとは限りませんのでご注意ください。ゲーム途中で設定を&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;二人対戦(Two Players)&lt;/code&gt;に変更して、気になる局面を再現してから&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AI対戦(One Player)&lt;/code&gt;に切り替えることは可能です。 &lt;a href=&quot;#fnref:3&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:4&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;ランダムと言っても豆の数が０にはならないようにしています。また、豆の合計数は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;４&lt;/code&gt;を選んだ場合と同じ４×６×２＝４８個です。 &lt;a href=&quot;#fnref:4&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</description>
        <pubDate>Mon, 10 Aug 2020 00:00:00 +0900</pubDate>
        <link>https://happyclam.github.io/project/2020-08-10/mancalanuts</link>
        <guid isPermaLink="true">https://happyclam.github.io/project/2020-08-10/mancalanuts</guid>
        
        <category>flutter</category>
        
        <category>dart</category>
        
        <category>android</category>
        
        <category>mancala</category>
        
        
        <category>project</category>
        
      </item>
    
      <item>
        <title>マンカラの必勝手順の有無（続編）</title>
        <description>&lt;p&gt;&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;&lt;img src=&quot;/images/ja_badge_web_generic.png&quot; alt=&quot;マンカラアプリ&quot; title=&quot;マンカラ ナッツ&quot; width=&quot;155&quot; height=&quot;60&quot; /&gt;&lt;/a&gt;
&lt;a href=&quot;https://www.amazon.co.jp/happyclam-マンカラ-ナッツ/dp/B08D8QVVQY/ref=sr_1_2&quot;&gt;&lt;img src=&quot;/images/amazon-appstore-badge-jp-white.png&quot; alt=&quot;マンカラアプリ&quot; title=&quot;マンカラ ナッツ&quot; width=&quot;155&quot; height=&quot;60&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;結構アクセスがあったので続編&quot;&gt;結構アクセスがあったので続編&lt;/h3&gt;
&lt;p&gt;　&lt;a href=&quot;/software/2020-06-07/mancala&quot;&gt;前回の記事&lt;/a&gt;が意外に多くのアクセスがあった&lt;sup id=&quot;fnref:1&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;ので続編を書いてみます。おそらく&lt;a href=&quot;/software/2020-06-07/mancala&quot;&gt;前回の記事&lt;/a&gt;にアクセスした人はプログラムにはあまり関心はないけど、マンカラの攻略法・勝ち方・必勝手順を知りたくてアクセスした人が多いのだと思いますが、それを知るには&lt;a href=&quot;/software/2020-06-07/mancala&quot;&gt;前回の記事&lt;/a&gt;の最後に追記したように非常に時間がかかるので、いつかまとめて最も遊ばれていると思われる６×２列のカラハに関してだけ別の記事で書こうと思ってます。時間かけて先読みした結果、結局５０手読みでは結論出なかったという可能性もあります。&lt;br /&gt;
　今回はマンカライージーに関して、前回同様必勝手順の有無についての実験結果を書いてみます。マンカライージーのルールについては&lt;a href=&quot;https://hugkum.sho.jp/96590&quot;&gt;ここ&lt;/a&gt;にベーシックとカラハと比較して書かれています。相手のストアには石を撒かない点と自分のストアに溜まった石の数で勝敗を決める点でカラハと同じです。カラハと違うのは相手の石を横取り（Capture）するルールが無いことです。&lt;/p&gt;

&lt;h3 id=&quot;実験結果３２列イージー&quot;&gt;実験結果（３×２列イージー）&lt;/h3&gt;
&lt;p&gt;　石の数を１〜５個にして、５０手先読みしたそれぞれの結果です。&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;石の数&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;１&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;２&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;３&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;４&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;５&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;戻り値&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[0, 1]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[0, 3]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[999, 1]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[0, 1]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[0, 1]&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;読みの深さ&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;５０手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;５０手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;２５手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;５０手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;５０手&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;結論&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;引分け&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;引分け&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;引分け&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;引分け&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h4 id=&quot;検証&quot;&gt;検証&lt;/h4&gt;
&lt;p&gt;　相変わらず石３個でも２０手以上かかるので、遷移を書いて検証するのは大変です。そこでさらに計算量が少ない２×２列で検証することにしました。&lt;/p&gt;

&lt;hr /&gt;

&lt;div style=&quot;float:left; margin: 0px 0px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;br /&gt;(0)&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;2&lt;br /&gt;(5)&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;2&lt;br /&gt;(4)&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;br /&gt;(3)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;2&lt;br /&gt;(1)&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;2&lt;br /&gt;(2)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br clear=&quot;all&quot; /&gt;&lt;/p&gt;

&lt;p&gt;※( )内の数字は配列（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;board = [0,2,2,0,2,2]&lt;/code&gt;）の添字です。添字の&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0&lt;/code&gt;と&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3&lt;/code&gt;がストアになります。&lt;/p&gt;

&lt;h3 id=&quot;実験結果２２列イージー&quot;&gt;実験結果（２×２列イージー）&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;石の数&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;１&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;２&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;３&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;４&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;５&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;６&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;７&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;８&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;９&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;戻り値&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[0, 2]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[-999, 2]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[0, 1]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[0, 2]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[-999, 2]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[999, 2]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[999, 1]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[0, 1]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[-999, 2]&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;読みの深さ&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;５０手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;５手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;５０手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;５０手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;１８手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;２０手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;２１手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;５０手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;２５手&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;結論&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;引分け&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;後手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;引分け&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;引分け&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;後手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;引分け&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;後手必勝&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;　※連続で指し手を進めている場合一手と数えているケースがあるので手数はやや不正確です。&lt;/p&gt;

&lt;h4 id=&quot;検証１２２イージー&quot;&gt;検証１（２×２イージー）&lt;/h4&gt;
&lt;p&gt;　上の表を見て分かるように&lt;a href=&quot;/software/2020-06-07/mancala&quot;&gt;前回&lt;/a&gt;同様反復深化で調べると、２×２列で石の数が２個の場合５手読みで後手必勝となります。この手数なら短いので表を書いて確認出来そうです。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-Dart&quot;&gt;[0, 2, 2, 0, 2, 2]
=== result = 0, 2, i = 1
=== result = 1, 2, i = 2
=== result = 0, 2, i = 3
=== result = -999, 2, i = 4

[-999, 2]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;　先読みメソッドからの戻り値は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[-999, 2]&lt;/code&gt;となっていますが、先手は初手にどこを選んでも負けるけど最善手として&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2&lt;/code&gt;を選んだという意味です。&lt;br /&gt;
　まず、先手が&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt;を選んだ場合を見てみます。先手が&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt;を選んだら、自分のストアで撒き終わるのでもう一度先手の番となり、以下のように遷移します。&lt;/p&gt;

&lt;div style=&quot;width:500px; margin: 0 auto;&quot;&gt;
&lt;div style=&quot;float:left; margin: 0px 0px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;3&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;3&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;3&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;6&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br clear=&quot;all&quot; /&gt;&lt;/p&gt;

&lt;p&gt;　なんと後手の手番を迎えること無く、いきなり先手サイドの石が無くなってゲーム終了。イージーのルールの場合カラハと同じで、残った石は自分のストアに集めて数えるので、先手&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2&lt;/code&gt;対後手&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;6&lt;/code&gt;で後手の勝ちになります。&lt;br /&gt;
　だから先読みメソッドで先手の最善手として&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt;ではなく&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2&lt;/code&gt;を返してきたわけです。&lt;br /&gt;
　では先手が&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2&lt;/code&gt;を選んだ場合を見てみます。&lt;/p&gt;

&lt;div style=&quot;width:500px; margin: 0 auto;&quot;&gt;
&lt;div style=&quot;float:left; margin: 0px 0px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;3&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br clear=&quot;all&quot; /&gt;&lt;/p&gt;

&lt;p&gt;　上の局面で後手は２通りの手（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;4&lt;/code&gt;か&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;5&lt;/code&gt;）がありますが、この局面から後手の手番で先読みしてみると&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-Dart&quot;&gt;final List board = [0,2,0,1,3,2];
result = second.think(board, first, 50, SECOND_WIN);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;　&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;result = [-999, 4]&lt;/code&gt;となり&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;4&lt;/code&gt;を選べば後手が勝てると言ってます。&lt;br /&gt;
　後手が２手目に&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;4&lt;/code&gt;を選んだら以下のようになります。&lt;/p&gt;

&lt;div style=&quot;width:500px; margin: 0 auto;&quot;&gt;
&lt;div style=&quot;float:left; margin: 0px 0px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;3&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;3&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;3&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br clear=&quot;all&quot; /&gt;&lt;/p&gt;

&lt;p&gt;　次の先手は指し手が&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt;に限定されるので進めると以下のようになります。&lt;/p&gt;

&lt;div style=&quot;width:500px; margin: 0 auto;&quot;&gt;
&lt;div style=&quot;float:left; margin: 0px 0px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;3&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br clear=&quot;all&quot; /&gt;&lt;/p&gt;

&lt;p&gt;　この局面で後手の指し手は２通りありますが、ここまで来れば後手がもう一度&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;4&lt;/code&gt;を選べば勝てることが分かると思います。お互いが最善手を選ぶことが前提となっていますので、ここで後手が&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;4&lt;/code&gt;を選んだ場合を初手から省略せずに書くと以下のようになります。&lt;/p&gt;

&lt;div style=&quot;width:500px; margin: 0 auto;&quot;&gt;
&lt;div style=&quot;float:left; margin: 0px 0px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;3&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;3&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;3&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;3&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;4&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;4&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;3&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;5&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;3&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br clear=&quot;all&quot; /&gt;&lt;/p&gt;

&lt;p&gt;　通算５手読みで後手必勝の結論は正しいようです。&lt;br /&gt;
　ちなみに後手が２手目に&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;5&lt;/code&gt;を選んだ場合は、遷移は省略しますが先手が勝つ変化もあるようです。&lt;/p&gt;

&lt;h3 id=&quot;相変わらず派生ルールが多過ぎ&quot;&gt;相変わらず派生ルールが多過ぎ&lt;/h3&gt;
&lt;p&gt;　ここまで書いてからマンカライージーのルールについて、&lt;strong&gt;「終了時にポケットにある石は無効になります。どちらの数にも入れません」&lt;/strong&gt;と書かれている&lt;a href=&quot;https://genki-up.recreation.or.jp/top/mancala/rule&quot;&gt;サイト&lt;/a&gt;を見つけてしまいました。そう言えば&lt;a href=&quot;https://hugkum.sho.jp/96590&quot;&gt;上で紹介したサイト&lt;/a&gt;には、「基本はベーシックと同じ」と書かれているだけでゲーム終了時に残った石の扱いについては書かれていません。カラハと同じでいいだろうと勝手に判断してしまいました。折角コツコツと遷移表を書いたのが勿体ないので上の文はそのままにして、表だけ「終了時にポケットにある石は無効にする」ルールで更新しておきます。&lt;/p&gt;

&lt;h3 id=&quot;実験結果３２列イージー終了時にポケットにある石は無効にするルール&quot;&gt;実験結果（３×２列イージー、終了時にポケットにある石は無効にするルール）&lt;/h3&gt;
&lt;p&gt;（2020-10-28一部訂正）&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;石の数&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;１&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;２&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;３&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;４&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;５&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;戻り値&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[999, 1]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[-999, 3]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[999, 1]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[0, 1]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[0, 1]&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;読みの深さ&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;５手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;１６手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;２３手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;５０手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;５０手&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;結論&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;後手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;引分け&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;引分け&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;実験結果２２列イージー終了時にポケットにある石は無効にするルール&quot;&gt;実験結果（２×２列イージー、終了時にポケットにある石は無効にするルール）&lt;/h3&gt;
&lt;p&gt;（2020-10-28一部訂正）&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;石の数&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;１&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;２&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;３&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;４&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;５&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;６&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;７&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;８&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;９&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;戻り値&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[999, 2]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[999, 1]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[-999, 2]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[999, 1]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[-999, 2]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[999, 2]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[999, 1]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[999, 2]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[-999, 2]&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;読みの深さ&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;５手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;１手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;７手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;５手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;１４手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;１８手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;２１手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;２５手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;２４手&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;結論&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;後手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;後手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;後手必勝&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;　上の検証で説明していた２×２列で石が２個のケースも全く逆の結論になります。&lt;br /&gt;
　上の説明で書いた先読みメソッドの実行結果も以下のように変わります。戻り値は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[999, 1]&lt;/code&gt;で、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt;を選べば先手必勝と返してきます。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-Dart&quot;&gt;[0, 2, 2, 0, 2, 2]
=== result = 999, 1, i = 1

[999, 1]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;　「終了時にポケットにある石は無効にする」ルールだと、本文の検証を読んで貰えれば一手で先手必勝になることは分かると思います。ルールが変わると結果が真逆になるいい例として説明文も無駄にならなくてよかったです。&lt;/p&gt;

&lt;h3 id=&quot;カラハのルール&quot;&gt;カラハのルール&lt;/h3&gt;
&lt;p&gt;　マンカラカラハにもいろいろな派生ルールが存在するようで、ゲーム終了時に残った石は相手の物になるというルールも存在するようです。&lt;a href=&quot;https://play.google.com/store/apps/details?id=com.marcnadero.kahalagame&quot;&gt;このアプリ&lt;/a&gt;ではどちらのルールにするかオプションで選べるようになっていて、残った石は相手に取られるルールの方が&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;popular&lt;/code&gt;、自分の石になるルールが&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;classic&lt;/code&gt;となっています。残った石が相手のものになるルールの方が海外ではポピュラーなんでしょうか？&lt;br /&gt;
　任天堂のアソビ大全５１に収録されているマンカラは&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;classic&lt;/code&gt;ルールのようですが、日本ではこのルールがメジャーになると思われるので、今後マンカラに関する記事はアソビ大全５１のルールに絞ろうと思います。&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;アプリ&lt;/a&gt;も&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;classic&lt;/code&gt;ルールにしています。&lt;/p&gt;

&lt;div&gt;
    &lt;script async=&quot;&quot; src=&quot;https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js&quot;&gt;&lt;/script&gt;
    &lt;!-- display01 --&gt;
    &lt;ins class=&quot;adsbygoogle&quot; style=&quot;display:block&quot; data-ad-client=&quot;ca-pub-9018029357773039&quot; data-ad-slot=&quot;3925247388&quot; data-ad-format=&quot;auto&quot; data-full-width-responsive=&quot;true&quot;&gt;&lt;/ins&gt;
    &lt;script&gt;
    (adsbygoogle = window.adsbygoogle || []).push({});
    &lt;/script&gt;
&lt;/div&gt;

&lt;hr /&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;https://www.amazon.co.jp/HTML5-CoffeeScriptで作る最強の三目並べプログラム-MIN-MAX法からαβ法へ-happyclam-ebook/dp/B01D1IJ0S0/ref=sr_1_1?s=digital-text&amp;amp;ie=UTF8&amp;amp;qid=1473938717&amp;amp;Sr=1-1&amp;amp;keywords=三目並べ&quot;&gt;電子書籍&lt;/a&gt;を買っていただいた方も数人いたようです、有難うございます。 &lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</description>
        <pubDate>Sun, 09 Aug 2020 00:00:00 +0900</pubDate>
        <link>https://happyclam.github.io/software/2020-08-09/mancala_easy</link>
        <guid isPermaLink="true">https://happyclam.github.io/software/2020-08-09/mancala_easy</guid>
        
        <category>dart</category>
        
        <category>android</category>
        
        <category>flutter</category>
        
        <category>mancala</category>
        
        
        <category>software</category>
        
      </item>
    
      <item>
        <title>マンカラは先手必勝？後手必勝？</title>
        <description>&lt;p&gt;&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;&lt;img src=&quot;/images/ja_badge_web_generic.png&quot; alt=&quot;マンカラアプリ&quot; title=&quot;マンカラ ナッツ&quot; width=&quot;155&quot; height=&quot;60&quot; /&gt;&lt;/a&gt;
&lt;a href=&quot;https://www.amazon.co.jp/happyclam-マンカラ-ナッツ/dp/B08D8QVVQY/ref=sr_1_2&quot;&gt;&lt;img src=&quot;/images/amazon-appstore-badge-jp-white.png&quot; alt=&quot;マンカラアプリ&quot; title=&quot;マンカラ ナッツ&quot; width=&quot;155&quot; height=&quot;60&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;最古のボードゲームらしい&quot;&gt;最古のボードゲームらしい&lt;/h3&gt;
&lt;p&gt;　世界最古のボードゲームらしいのですが、存在自体知りませんでした。早速アプリをダウンロードして遊んでみたところ、何回か遊んでいるうちに勝つためのコツというのが少しずつ見えてきて楽しめましたが、それよりもこの単純なルールならすぐに人間に負けないＡＩが作れるんじゃないか？と思い試してみることにしました。&lt;/p&gt;

&lt;h3 id=&quot;派生のルールがいろいろあるらしい&quot;&gt;派生のルールがいろいろあるらしい&lt;/h3&gt;
&lt;p&gt;　&lt;a href=&quot;https://ja.wikipedia.org/wiki/マンカラ&quot;&gt;Wikipedia&lt;/a&gt;によるといろいろな遊び方があるようですが、たまたまダウンロードしたアプリは「ベーシック」と「カラハ」という２つのルールで遊べるもので、ベーシックをやってみてすごく単純なルールに興味を持ったのですが、最初にカラハのルールで遊んでいたら面倒そうなので自分でプログラムを作ってみようなんて思わなかったかも知れません&lt;sup id=&quot;fnref:1&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;。&lt;br /&gt;
　先手必勝か後手必勝かを調べる方法は、&lt;a href=&quot;/software/2014-09-23/tictactoe_arrange&quot;&gt;以前の記事&lt;/a&gt;で&lt;strong&gt;３手前に打った駒が消える特殊なルールの三目並べ&lt;/strong&gt;を例にして紹介したように、MIN-MAX法（+αβ法）で先読みの深さを徐々に深くしていって（反復深化）、お互い最善手を尽くしても先手が勝つ（先手必勝）のかあるいは後手が勝つ（後手必勝）のかを確認するやり方です。&lt;/p&gt;

&lt;h3 id=&quot;マンカラベーシックのルール&quot;&gt;マンカラベーシックのルール&lt;/h3&gt;
&lt;p&gt;　普通は６×２列×石４つで行うゲームですが、それだと先読みの際にまたスタックオーバーフローに見舞われるだろうと思い、取り敢えず３×２列で検証することにしました。下図は石が３つの場合です。&lt;/p&gt;

&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;4&quot; align=&quot;center&quot;&gt;後手のストア&lt;br /&gt;0↓&lt;/td&gt;
    &lt;td colspan=&quot;3&quot; align=&quot;center&quot;&gt;後手&lt;/td&gt;    
    &lt;td rowspan=&quot;4&quot; align=&quot;center&quot;&gt;先手のストア&lt;br /&gt;0↑&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;3&lt;br /&gt;←&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;3&lt;br /&gt;←&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;3&lt;br /&gt;←&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td colspan=&quot;3&quot; align=&quot;center&quot;&gt;先手&lt;/td&gt;    
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;3&lt;br /&gt;→&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;3&lt;br /&gt;→&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;3&lt;br /&gt;→&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br clear=&quot;all&quot; /&gt;&lt;/p&gt;

&lt;p&gt;　先手と後手が自分の穴のどれかを選んで全ての石を取り出し、矢印のように反時計回りに一つずつ石を撒いていく動作を先手後手交互に繰り返して、先に自分の穴の石が全てなくなれば勝ちです。自分か相手のストアで石を撒き終わった場合はもう一度自分の手番になります。&lt;/p&gt;

&lt;p&gt;　※&lt;a href=&quot;/software/2020-08-09/mancala_easy&quot;&gt;マンカライージーに関する記事&lt;/a&gt;も追加しました。&lt;/p&gt;

&lt;h3 id=&quot;dartで実装&quot;&gt;Dartで実装&lt;/h3&gt;
&lt;p&gt;　今リリースしている自分の将棋関連アプリの中で一番利用されている&lt;a href=&quot;https://play.google.com/store/apps/details?id=shogi55.io.github.happyclam&quot;&gt;５五将棋アプリ&lt;/a&gt;をFlutterで作り直そうかと思って、慣れるためにプログラミング言語はDartにしました。&lt;br /&gt;
　石の数は３つの場合&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;List board = [0,3,3,3,0,3,3,3];&lt;/code&gt;のようにリストを作ります。添字の&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0&lt;/code&gt;と&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;4&lt;/code&gt;がストアになります。カラハのルールだと相手のストアには石を撒かないそうですが、ベーシックのルールだと相手のストアにも石を撒くので、このリストをシーケンシャルに処理していけばいいだけなので処理が単純です。またカラハのように自分の空の穴で石を撒き終わった時に相手の石を取る（capture）ことが出来るというルールもありません。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-Dart&quot;&gt;void main() {
  final List board = [0,3,3,3,0,3,3,3];
  List result = new List();
  Player first = new Player(FIRST);
  Player second = new Player(SECOND);
  print(board);
  Stopwatch watch = new Stopwatch();
  watch.start();
  // result = first.think(board, second, 50, FIRST_WIN);
  // result = second.think(board, first, 50, SECOND_WIN);
  for (var i = 1; i &amp;lt; 50; i++){
    print(&quot;i = ${i}&quot;);
    result = first.think(board, second, i, FIRST_WIN);
    if (result[0] == FIRST_WIN || result[1] == SECOND_WIN){
      print(&quot;=== result = ${result[0]}, ${result[1]}, i = ${i}&quot;);
      break;
    }
  }
  print(watch.elapsedMilliseconds);
  print(result);

}

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;　一手読みから５０手読みまで反復深化で徐々に読みを深くしていって、先手勝ち（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;999&lt;/code&gt;）の評価値が返ってきたら先手必勝、後手勝ち（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-999&lt;/code&gt;）の評価値が返ってきたら後手必勝となります。この辺りの話は&lt;a href=&quot;/software/2014-09-23/tictactoe_arrange&quot;&gt;以前の記事&lt;/a&gt;を読んでみてください。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-Dart&quot;&gt;  //評価関数
  int evaluate(List board){
    int first = 0;
    int second = 0;
    first = board.getRange(FIRST_START, FIRST_GOAL).where((value) =&amp;gt; value == 0).length;
    second = board.getRange(SECOND_START, DENTS).where((value) =&amp;gt; value == 0).length;
    if (first == WIN_COUNT &amp;amp;&amp;amp; second == WIN_COUNT){
      print(&quot;=============== Error =============================&quot;);
      return DRAW;
    } else if (first == WIN_COUNT){
      return FIRST_WIN;
    } else if (second == WIN_COUNT){
      return SECOND_WIN;
    } else {
      return (first - second);
    }
  }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;　評価関数は先手勝ち（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;999&lt;/code&gt;）か後手勝ち（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-999&lt;/code&gt;）、それ以外は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;(先手の空になっている穴の数 - 後手の空になっている穴の数)&lt;/code&gt;にしていますが、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;return 0&lt;/code&gt;でもいいと思います。形勢判断の評価関数として&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;(先手の空になっている穴の数 - 後手の空になっている穴の数)&lt;/code&gt;というのはかなり雑ですが、読み切ってしまうことが目的なので適当で構いません。&lt;/p&gt;

&lt;h3 id=&quot;結果&quot;&gt;結果&lt;/h3&gt;
&lt;p&gt;　石の数を１〜９個にして、５０手先読みしたそれぞれの結果です。&lt;/p&gt;
&lt;h4 id=&quot;３２列ベーシック2020-10-28一部訂正&quot;&gt;３×２列（ベーシック）（2020-10-28一部訂正）&lt;/h4&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;石の数&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;１&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;２&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;３&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;４&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;５&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;６&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;７&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;８&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;９&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;戻り値&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[999, 1]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[999, 1]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[999, 1]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[999, 2]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[999, 1]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[999, 1]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[-999, 3]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[-999, 3]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[999, 3]&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;読みの深さ&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;４手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;２３手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;２３手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;３６手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;３３手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;４３手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;４８手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;-&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;-&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;結論&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;後手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;後手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;※先読み関数の外側のループで手数をカウントしてるため、手数は若干不正確です&lt;sup id=&quot;fnref:2&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:2&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;。&lt;/p&gt;

&lt;p&gt;　先読みメソッドの戻り値は（評価値,指し手）となっていて、評価値に最大値（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;999&lt;/code&gt;）が返ってきたら先手必勝、最小値（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-999&lt;/code&gt;）が返ってきたら後手必勝です。石の数４個の場合、先手が初手にリストの&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2&lt;/code&gt;の位置を選べば先手必勝であることを表しています。石の数７個の時は後手必勝となりました。指し手に&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3&lt;/code&gt;が返ってきているのは、取り敢えず最善手として&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3&lt;/code&gt;を選んだという意味で、深い意味はありません。先手は勝てないことが分かったけど取り敢えず最善手として&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3&lt;/code&gt;を選んだということです。&lt;/p&gt;

&lt;h3 id=&quot;検証１石が１個の時&quot;&gt;検証１（石が１個の時）&lt;/h3&gt;
&lt;p&gt;　取り敢えず石の数１個の時のケースを確認しましょう。先手が初手に&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt;の場所を選んで石を撒いた直後の状態は以下のようになります。&lt;/p&gt;

&lt;div style=&quot;float:left; margin: 0px 0px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br clear=&quot;all&quot; /&gt;&lt;/p&gt;

&lt;p&gt;　後手はこの次にどこを選んでも（以下の図は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;5&lt;/code&gt;を選んだ場合）、先手は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3&lt;/code&gt;を選べば自分のストアに石を撒き終わるので次も先手の番です。その結果、３手連続で着手することが出来るので以下のように遷移して先手が勝てます。&lt;/p&gt;

&lt;div style=&quot;width:500px; margin: 0 auto;&quot;&gt;
&lt;div style=&quot;float:left; margin: 0px 0px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;3&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br clear=&quot;all&quot; /&gt;&lt;/p&gt;

&lt;p&gt;　先手が一手指した後の状態から、後手の立場で先読みしてみます。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-Dart&quot;&gt;final List board = [0,0,2,1,0,1,1,1];
result = second.think(board, first, 50, SECOND_WIN);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;　戻り値は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[999, 7]&lt;/code&gt;となって後手は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;7&lt;/code&gt;を選ぶけど、先手必勝（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;999&lt;/code&gt;）の結論は変わりません。&lt;br /&gt;
　後手は２手目にどこを選んでも負けるのですが、２手目は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;7&lt;/code&gt;を選んだ方が上で紹介した評価関数に従って有利と判定されるので&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;7&lt;/code&gt;が最善手となります。初手からの遷移を省略せずに書くと以下のようになります。&lt;/p&gt;

&lt;div style=&quot;width:500px; margin: 0 auto;&quot;&gt;
&lt;div style=&quot;float:left; margin: 0px 0px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;3&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br clear=&quot;all&quot; /&gt;&lt;/p&gt;

&lt;p&gt;　都合７手で先手勝ちなのですが、最後に先手が連続で着手出来るので５手読みで先手必勝と分かります。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-Dart&quot;&gt;[0, 1, 1, 1, 0, 1, 1, 1]
i = 1
i = 2
i = 3
i = 4
=== result = 999, 1, i = 4
6
[999, 1]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;　main関数の出力も&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;i = 4&lt;/code&gt;（５手読み）で先手が勝つと表示されます。&lt;/p&gt;

&lt;h3 id=&quot;検証２石が４個の時&quot;&gt;検証２（石が４個の時）&lt;/h3&gt;
&lt;p&gt;　石の数が１の場合は簡単に検証できましたが、石の数が２個以上の場合は何十手もかかるので、目で追うだけで検証するのは大変です。簡単にみていきます。&lt;br /&gt;
　石の数が４個の場合は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2&lt;/code&gt;の位置を選べば３８手で先手必勝と表示されます。先手が&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2&lt;/code&gt;の位置を選んで石を撒いたら以下の状態になります。&lt;/p&gt;

&lt;div style=&quot;width:500px; margin: 0 auto;&quot;&gt;
&lt;div style=&quot;float:left; margin: 0px 0px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;4&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;4&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;4&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;4&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;4&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;4&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;4&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;5&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;5&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;4&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;5&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br clear=&quot;all&quot; /&gt;&lt;/p&gt;

&lt;p&gt;　この状態から後手の手番で先読みしてみましょう。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-Dart&quot;&gt;final List board = [0,4,0,5,1,5,5,4];
result = second.think(board, first, 50, SECOND_WIN);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;　戻り値は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[999, 7]&lt;/code&gt;となって先手必勝（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;999&lt;/code&gt;）の結論は変わりません。&lt;br /&gt;
　今度は初期状態から先手（下側）と後手（上側）の順番を入れ替えて、本来の後手（上側）から先読みしてみると&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-Dart&quot;&gt;final List board = [0,4,4,4,0,4,4,4];
result = second.think(board, first, 50, SECOND_WIN);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;　戻り値は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[-999, 6]&lt;/code&gt;となって&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2&lt;/code&gt;の対称の位置にある&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;6&lt;/code&gt;を選べば本来の後手（上側）が必勝と判定されます。上下対象の配置なので当然こうなるべきで、これも一応プログラムは正しく動いてそうです。&lt;/p&gt;

&lt;h3 id=&quot;６２ではどうなのか&quot;&gt;６×２ではどうなのか&lt;/h3&gt;
&lt;p&gt;　３×２列のマンカラでなく、通常の６×２列で石の数が４個のマンカラではどうなのか調べたいと思い、まず石１個でやってみました。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-Dart&quot;&gt;final List board = [0,1,1,1,1,1,1,0,1,1,1,1,1,1];
result = second.think(board, first, 50, SECOND_WIN);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;　結果は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[999, 1]&lt;/code&gt;となって先手が初手に&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt;の場所を選べば先手必勝のようです。&lt;br /&gt;
　ただ、石２個、３個、４個で試すと&lt;del&gt;循環する手順があるのか、&lt;/del&gt;丸一日動かしていても結果が返って来ませんでした。まだ原因がはっきり分かっていませんが、循環する手順があるとしてもそこに入り込む必要なく必勝手順を辿ることが出来たということなので、&lt;strong&gt;必勝の結論を返してきた分に関しては間違いない&lt;/strong&gt;と思います&lt;sup id=&quot;fnref:3&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:3&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;。バグがなければの話ですが…。&lt;br /&gt;
　ベーシックのルール特有のケースかもしれないので、先にカラハのルールを実装して試してみようかなどと考えていますが、いずれにしても読み切るには結構時間が掛かるので、三目並べのように絶対人間に負けないプログラムを作るのは思っていたほど簡単ではないようです。&lt;br /&gt;
　カラハのルールだと自分の空の穴で撒き終わった場合に相手の石を取ることが出来るというルールがあるので、ベーシックのルールより早くゲームを終わらせる必勝手順があるような気がしていますが、どうなるか分かりません。&lt;/p&gt;

&lt;h3 id=&quot;マンカラカラハの結果2020-06-17追記&quot;&gt;マンカラカラハの結果（2020-06-17追記）&lt;/h3&gt;
&lt;p&gt;　マンカラカラハのルールに対応したので結果を載せておきます。カラハでは自分の穴の石が無くなったら勝ちではなく、先手・後手どちらかの全ての穴が空になったらゲーム終了して残った石は自分のストアに戻し、その時点でのストアに溜まった石の数で勝敗を決めるので、評価関数は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;先手のストア内の石の数 - 後手のストア内の石の数&lt;/code&gt;です。マンカラベーシックのルールに較べて短手数での必勝手順が存在するのは、やはり相手の石を取ることが出来るルールによるものでしょう。&lt;/p&gt;

&lt;h4 id=&quot;３２列カラハ2020-10-28一部訂正&quot;&gt;３×２列（カラハ）（2020-10-28一部訂正）&lt;/h4&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;石の数&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;１&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;２&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;３&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;４&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;５&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;６&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;７&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;戻り値&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[0, 1]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[999, 2]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[999, 2]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[999, 1]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[999, 1]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[-999, 3]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[999, 3]&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;読みの深さ&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;５０手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;７手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;１７手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;２４手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;１７手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;１９手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;２３手&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;結論&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;引分け&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;後手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;検証３２カラハ&quot;&gt;検証（３×２カラハ）&lt;/h3&gt;
&lt;p&gt;　ベーシック同様簡単に検証してみます。&lt;br /&gt;
　例えば石１個の場合、以下のようにベーシックの例と同じようにゲームが進行したとします。&lt;/p&gt;

&lt;div style=&quot;width:500px; margin: 0 auto;&quot;&gt;
&lt;div style=&quot;float:left; margin: 0px 0px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 11px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 11px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 11px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 11px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 11px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 11px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 11px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 11px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 11px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 11px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 11px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 11px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;3&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 11px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 11px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;3&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;3&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br clear=&quot;all&quot; /&gt;&lt;/p&gt;

&lt;p&gt;　カラハのルールでも先手・後手どちらかの石が無くなればゲーム終了しますが、最後に残りの石を自分のストアに戻すことになりますので、先に先手の石が空になってもこの進行だと３対３の引き分けになり、当然ですがベーシックとは違う結果になります。&lt;br /&gt;
　次に石６個のケースを見てみると、戻り値は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[-999, 3]&lt;/code&gt;となっていますが、この場合ベーシックの時にも説明したように先手が&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3&lt;/code&gt;を選んだことには深い意味はありません。先手がどこを選んでも負ける（評価値&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-999&lt;/code&gt;）けど最善手として&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3&lt;/code&gt;を選んだというだけの話です。では後手の初手は何が最善手なのか見ていきます。&lt;br /&gt;
　石６個で先手が初手に&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt;を選んだ直後の状態は以下のようになります。&lt;/p&gt;

&lt;div style=&quot;width:500px; margin: 0 auto;&quot;&gt;
&lt;div style=&quot;float:left; margin: 0px 0px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;6&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;6&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;6&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;6&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;6&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;6&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 0px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;7&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;7&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;7&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;7&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;7&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br clear=&quot;all&quot; /&gt;&lt;/p&gt;

&lt;p&gt;　この状態から後手の手番で先読みすると&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-Dart&quot;&gt;final List board = [0,0,7,7,1,7,7,7];
result = second.think(board, first, 50, SECOND_WIN);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;　結果は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[-999, 5]&lt;/code&gt;となって後手は２手目に&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;5&lt;/code&gt;を選べば勝てると言っています。&lt;br /&gt;
　次に先手が&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2&lt;/code&gt;を選んだ場合を見てみましょう。&lt;strong&gt;カラハでは相手のストアには石を撒かないことが注意点です。&lt;/strong&gt;&lt;/p&gt;

&lt;div style=&quot;width:500px; margin: 0 auto;&quot;&gt;
&lt;div style=&quot;float:left; margin: 0px 0px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;6&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;6&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;6&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;6&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;6&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;6&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 0px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;7&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;7&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;7&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;7&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;7&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br clear=&quot;all&quot; /&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-Dart&quot;&gt;final List board = [0,7,0,7,1,7,7,7];
result = second.think(board, first, 50, SECOND_WIN);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;　結果は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[-999, 5]&lt;/code&gt;となって後手は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;5&lt;/code&gt;を選べば勝てると言っています。同様に先手が&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3&lt;/code&gt;を選んだ場合を見てみましょう。&lt;/p&gt;

&lt;div style=&quot;width:500px; margin: 0 auto;&quot;&gt;
&lt;div style=&quot;float:left; margin: 0px 0px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;6&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;6&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;6&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;6&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;6&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;6&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
&lt;span&gt;→&lt;/span&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 0px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;7&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;7&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;7&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;7&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;7&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br clear=&quot;all&quot; /&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-Dart&quot;&gt;final List board = [0,7,7,0,1,7,7,7];
result = second.think(board, first, 50, SECOND_WIN);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;　結果は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[-999, 6]&lt;/code&gt;となって後手は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;6&lt;/code&gt;を選べば勝てると言っています。先手が初手に&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt;,&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2&lt;/code&gt;,&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3&lt;/code&gt;のどれを選んでも後手必勝（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-999&lt;/code&gt;）の結論は変わっていないので一応プログラムとしては一貫した結果が返ってきています。&lt;br /&gt;
　あと、相手の石を取る（capture）ケースも自分なりに確認していますが、図を書くのに疲れたので検証はここまでにします。&lt;/p&gt;

&lt;h4 id=&quot;６２列カラハ2020-06-21追記&quot;&gt;６×２列（カラハ）（2020-06-21追記）&lt;/h4&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;石の数&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;１&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;２&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;３&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;４&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;５&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;６&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;７&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;戻り値&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[999, 6]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;[999, 5]&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;-&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;-&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;読みの深さ&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;１５手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;１９手&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;-&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;-&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;結論&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;先手必勝&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;？？？&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;？？？&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;　石の数を３個以上にするとベーシックの時と同じように先読みメソッドから返事が返って来ませんでした。&lt;del&gt;千日手になってしまっているのだと思いますが、深くは調べていません。同一局面が現れたら手を変えるようにして千日手を無理やり回避するようにプログラムを改変すると、それは勝ち負けどちらの結果になったとしても必然の手順ではないということになってしまうので、&lt;/del&gt; 実験は一旦ここで打ち切ろうと思います。&lt;br /&gt;
　（訂正）冷静に考えると石を撒きながら自分のストアを通過する度に動かせる石が減っていくので、千日手（循環手順）があるとは思えません。GUIでテスト中に何かバグが見つかるかもと期待していましたが、アプリのテスト中も今のところバグらしきものは見つけられません&lt;sup id=&quot;fnref:4&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:4&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;ので、局面が増えた時になぜ先読みメソッドがループ？に入るのか謎です。それとこの手の先読みプログラムをDartで作ったのは初めてなのですが、先読みの深さを1000とか10000とかにしてもスタックオーバーフローが発生しない理由がよく分からないのですが、そのことと何か関係があるのかも知れません。&lt;/p&gt;

&lt;h3 id=&quot;強いマンカラアプリ&quot;&gt;強いマンカラアプリ&lt;/h3&gt;
&lt;p&gt;　自分のプログラムを１０手読みに設定して日本製の２つのアプリと何回か対戦させたのですが、負けは経験していないので今のところバグは無いのではと思っています&lt;sup id=&quot;fnref:5&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:5&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;5&lt;/a&gt;&lt;/sup&gt;。数あるAndroidアプリの中で一番強いマンカラアプリがどれなのか知りませんが、全体的に強さを追求しているアプリは少ないのかも知れません。それと海外製のアプリもいくつか触ってみましたが、ルールが微妙に違っていたりする&lt;sup id=&quot;fnref:6&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:6&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;6&lt;/a&gt;&lt;/sup&gt;ので、強さを比較するためにはそれぞれのルールに対応しなければならず結構大変です。海外製のアプリと強さを比較するために今後ルールを変更するかも知れません。そうすると上記の表の結果も変わって来ると思います。いろいろ派生ルールがあると面倒です、しかも何回か対戦しないと気付かないような微妙な違いなので厄介です。&lt;br /&gt;
※一例を挙げると&lt;a href=&quot;https://play.google.com/store/apps/details?id=io.ccgames.mancala&quot;&gt;この海外製アプリ&lt;/a&gt;と対戦させて自分のプログラムが勝ち判定出した後に負けたのですが、&lt;a href=&quot;https://play.google.com/store/apps/details?id=io.ccgames.mancala&quot;&gt;このアプリ&lt;/a&gt;はカラハとは違って&lt;strong&gt;Oware&lt;/strong&gt;というルールになっているようです。違うルールで先読みしていたら負けるのも当然です。&lt;/p&gt;

&lt;h3 id=&quot;アプリ作ってみました2020-07-05追記&quot;&gt;アプリ作ってみました（2020-07-05追記）&lt;/h3&gt;
&lt;p&gt;　&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;マンカラアプリ&lt;/a&gt;を作ってみました。まだ機能は少ないですが、今後追加していくつもりです。&lt;br /&gt;
　せっかくFlutterで作ったのでiPhone版もリリースしたいところですが、開発者登録費用の年間約10,000円を回収できる目処が立てばリリースするかも知れません&lt;sup id=&quot;fnref:7&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:7&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;7&lt;/a&gt;&lt;/sup&gt;。&lt;/p&gt;

&lt;h3 id=&quot;計算量の問題だけだったみたい2020-08-01追記&quot;&gt;計算量の問題だけだったみたい（2020-08-01追記）&lt;/h3&gt;
&lt;p&gt;　本文中、「先読みメソッドから戻ってこない理由が分からない」とややこしいこと書いていますが、単に私が待ち切れなかっただけのようです。３×２列から６×２列に配列要素を増やすことで当然計算量は増えますが、それだけでなく石の数を増やすことでもかなりの計算量の増加があるようです。&lt;br /&gt;
　以下は６×２列のカラハで石の数を２にして、反復深化で先読みさせたFlutterのテストの実行結果です。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;00:02 +0: First thinking test2 depth = 1
result = [1, 5], depth = 1
00:02 +1: First thinking test2 depth = 2
result = [0, 5], depth = 2
00:02 +2: First thinking test2 depth = 3
result = [3, 5], depth = 3
00:02 +3: First thinking test2 depth = 4
result = [4, 5], depth = 4
00:02 +4: First thinking test2 depth = 5
result = [5, 5], depth = 5
00:02 +5: First thinking test2 depth = 6
result = [4, 5], depth = 6
00:02 +6: First thinking test2 depth = 7
result = [5, 5], depth = 7
00:02 +7: First thinking test2 depth = 8
result = [4, 5], depth = 8
00:02 +8: First thinking test2 depth = 9
result = [4, 5], depth = 9
00:03 +9: First thinking test2 depth = 10
result = [4, 5], depth = 10
00:04 +10: First thinking test2 depth = 11
result = [3, 5], depth = 11
00:08 +11: First thinking test2 depth = 12
result = [5, 5], depth = 12
00:17 +12: First thinking test2 depth = 13
result = [4, 5], depth = 13
00:46 +13: First thinking test2 depth = 14
result = [5, 5], depth = 14
01:47 +14: First thinking test2 depth = 15
result = [6, 5], depth = 15
05:41 +15: First thinking test2 depth = 16
result = [2, 6], depth = 16
16:16 +16: First thinking test2 depth = 17
result = [3, 6], depth = 17
41:56 +17: First thinking test2 depth = 18
result = [999, 5], depth = 18
92:59 +18: All tests passed!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　最後の行の１９手読みの実行時間は９２分５９秒ですが、反復深化で調べると１手読みからの累積時間が必要となる（同じ経路を何度も調べている）ので、手間を惜しんで以下のように一気に５０手読みをさせていました。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-Dart&quot;&gt;final List board = [0,2,2,2,2,2,2,0,2,2,2,2,2,2];
Stopwatch watch = new Stopwatch();
watch.start();
result = first.think(board, second, 50, FIRST_WIN);
print(watch.elapsedMilliseconds);
print(result);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;　この実行結果は以下のようになります。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-Dart&quot;&gt;4389283
[999, 5]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;　4389283ミリ秒＝約１時間１３分で反復深化で調べるより時間が短縮できます。&lt;br /&gt;
そこで手数は分からなくてもいいから、まず５０手以内に必勝手順が存在するかどうかを確認しようと思い、石３個の場合も以下のように一気に５０手読みで実行していました。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-Dart&quot;&gt;final List board = [0,3,3,3,3,3,3,0,3,3,3,3,3,3];
Stopwatch watch = new Stopwatch();
watch.start();
result = first.think(board, second, 50, FIRST_WIN);
print(watch.elapsedMilliseconds);
print(result);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;　そして、丸一日経ってもプログラムが終了しないので、おかしいなぁと悩んでた訳です。&lt;br /&gt;
　でも、このやり方だと石２個の時のように必勝の結論が得られればいいですが、その結論が得られない場合、計算量が指数関数的に増えて必要な時間も増えていきます。&lt;br /&gt;
　試しに石３個の場合にどれぐらいの時間が必要なのか確認してみたのが以下の結果です。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-Dart&quot;&gt;00:08 +0: First thinking test3 depth = 1
result = [5, 4], depth = 1
00:08 +1: First thinking test3 depth = 2
result = [4, 4], depth = 2
00:08 +2: First thinking test3 depth = 3
result = [1, 5], depth = 3
00:08 +3: First thinking test3 depth = 4
result = [3, 5], depth = 4
00:08 +4: First thinking test3 depth = 5
result = [1, 6], depth = 5
00:08 +5: First thinking test3 depth = 6
result = [3, 6], depth = 6
00:08 +6: First thinking test3 depth = 7
result = [3, 5], depth = 7
00:08 +7: First thinking test3 depth = 8
result = [2, 5], depth = 8
00:08 +8: First thinking test3 depth = 9
result = [2, 5], depth = 9
00:09 +9: First thinking test3 depth = 10
result = [4, 5], depth = 10
00:12 +10: First thinking test3 depth = 11
result = [3, 5], depth = 11
00:24 +11: First thinking test3 depth = 12
result = [2, 5], depth = 12
01:09 +12: First thinking test3 depth = 13
result = [3, 5], depth = 13
04:02 +13: First thinking test3 depth = 14
result = [3, 5], depth = 14
13:20 +14: First thinking test3 depth = 15
result = [4, 5], depth = 15
42:39 +15: First thinking test3 depth = 16
result = [4, 5], depth = 16
136:42 +16: First thinking test3 depth = 17
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;　最初の内は読みが深くなっても時間はそれほど変わりませんが、途中から一手読みが深くなる毎に２倍、３倍と増えていくのが分かります。１８手読みまでに必勝手順は見つからず、１８手読みの時に136分（約２時間強）以上かかっています。このペースで時間が増えていくと５０手読みだと数週間では済まないかも知れません。どおりで１日では終わらない訳です。５０手までに必勝手順が存在すれば数日で終了するかも知れませんがなんとも言えません。また、石４個だとさらに時間が必要になります。数ヶ月掛かるんじゃないでしょうか？&lt;br /&gt;
　ちなみに石１個だと「１５手で先手必勝」の結論が、実行時間わずか７秒で得られます。石１個→７秒、石２個→１時間強なら、石３個→「丸一日あれば十分かな」と考えたのが甘かったようです。&lt;br /&gt;
　実行環境は&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;CPU:&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Intel(R) Core(TM) i7-2600K CPU @ 3.40GHz&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Memory: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;12GB&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Dart: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Dart VM version: 2.8.4 (stable) (Unknown timestamp) on &quot;linux_x64&quot;&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;です。どうしようか思案中です。&lt;/p&gt;

&lt;p&gt;　※ TypeScriptとC++でも試してみました&lt;a href=&quot;/software/2020-09-19/js_dart_cpp&quot;&gt;「Dartは遅いけど、FlutterでGUIは有り」&lt;/a&gt;。
　※ 強いアプリを厳選して手動で対戦させて、先手必勝なのか後手必勝なのか推測してみました&lt;a href=&quot;/software/2021-01-22/mancala_evaluate02&quot;&gt;「マンカラは後手でも勝てるか？」&lt;/a&gt;。&lt;/p&gt;

&lt;h3 id=&quot;ソースファイル&quot;&gt;ソースファイル&lt;/h3&gt;
&lt;p&gt;　&lt;a href=&quot;/software/2014-09-23/tictactoe_arrange&quot;&gt;以前の記事&lt;/a&gt;の「３手前に打った駒が消える特殊なルールの三目並べ」のように&lt;a href=&quot;https://github.com/happyclam/tictactoe_ruby/tree/arrange&quot;&gt;github&lt;/a&gt;でソースを公開しようと思っていたのですが、google play内の日本製のマンカラアプリで遊んでみて、少し惜しくなったというのが本音です。アプリのアクティブユーザー数が1,000に達したらこの記事で使用しているソース（=アプリからGUI部分を除いたソース）を公開しようと思ってます。&lt;br /&gt;
　またMIN-MAX法やαβ法のアルゴリズムに興味のある方は、よろしければ&lt;a href=&quot;https://www.amazon.co.jp/HTML5-CoffeeScriptで作る最強の三目並べプログラム-MIN-MAX法からαβ法へ-happyclam-ebook/dp/B01D1IJ0S0/ref=sr_1_1?s=digital-text&amp;amp;ie=UTF8&amp;amp;qid=1473938717&amp;amp;Sr=1-1&amp;amp;keywords=三目並べ&quot;&gt;この本&lt;/a&gt;を買ってみてください。使用言語はCoffeeScript（JavaScript）ですが、本の中の相互再帰のやり方と今回の検証プログラムはほとんど同じやり方で、マンカラの場合は連続で指し手が続くケースがあるのでその部分だけif文（数行）が追加されている感じです。&lt;/p&gt;

&lt;div&gt;
    &lt;script async=&quot;&quot; src=&quot;https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js&quot;&gt;&lt;/script&gt;
    &lt;!-- display01 --&gt;
    &lt;ins class=&quot;adsbygoogle&quot; style=&quot;display:block&quot; data-ad-client=&quot;ca-pub-9018029357773039&quot; data-ad-slot=&quot;3925247388&quot; data-ad-format=&quot;auto&quot; data-full-width-responsive=&quot;true&quot;&gt;&lt;/ins&gt;
    &lt;script&gt;
    (adsbygoogle = window.adsbygoogle || []).push({});
    &lt;/script&gt;
&lt;/div&gt;

&lt;hr /&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;マンカラベーシックという呼び方が同じでも国や地域によってルールが違うようです。 &lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;先読み関数から手数を返せば正確になるのですが、今のところやってません。 &lt;a href=&quot;#fnref:2&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:3&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;この辺りの事情は&lt;a href=&quot;http://localhost:4000/software/2014-10-04/arrange_line&quot;&gt;以前の記事&lt;/a&gt;にも書きました。 &lt;a href=&quot;#fnref:3&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:4&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;アプリの設定をExpertにすると１０手読みですが、他のアプリと対戦させてみても結構強いです。絶対負けないプログラムにするにはこの記事の実験結果から考えて２０手以上の先読みが必要になると思われるので、アプリに実装するのは応答時間の問題で難しいと思います。海外製の強いアプリをいくつか見つけましたが、データ構造を小さくしたり、定跡データ化したり工夫しているのだと思います。やはり歴史が長い海外製の方がずっと先を行ってそうです。それかオープンソースの優秀なマンカラ用のライブラリが既にあるのかも知れません。 &lt;a href=&quot;#fnref:4&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:5&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;微妙なバグがありました。本文には影響ないのですが、表は数カ所2020-10-28に更新しています。どこが変わったかはgithubの履歴を見てください。&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;アプリ&lt;/a&gt;に関しては修正済みです。 &lt;a href=&quot;#fnref:5&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:6&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;自分のプログラムは先手の手番で全ての石が空になったらその時点でゲーム終了としていますが、先手番でゲームが終了したら、後手の指し手をもう一手進めてからゲームを終了するルールもあるようです。石を撒く回数を先手と後手で公平にするという意図でしょうか？ &lt;a href=&quot;#fnref:6&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:7&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;以前Cordovaで作成した機械学習型ＡＩアプリを&lt;a href=&quot;https://play.google.com/store/apps/details?id=tictactoe_evo.io.github.happyclam&quot;&gt;「進化する三目並べ」&lt;/a&gt;と題してiPhoneアプリとして公開していたのですが、売れなかったので１年間で止めてしまいました。 &lt;a href=&quot;#fnref:7&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</description>
        <pubDate>Sun, 07 Jun 2020 00:00:00 +0900</pubDate>
        <link>https://happyclam.github.io/software/2020-06-07/mancala</link>
        <guid isPermaLink="true">https://happyclam.github.io/software/2020-06-07/mancala</guid>
        
        <category>dart</category>
        
        <category>android</category>
        
        <category>flutter</category>
        
        
        <category>software</category>
        
      </item>
    
  </channel>
</rss>
