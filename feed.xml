<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>自己満足プログラミング</title>
    <description>Reinventing the wheel.</description>
    <link>https://happyclam.github.io/</link>
    <atom:link href="https://happyclam.github.io/feed.xml" rel="self" type="application/rss+xml" />
    <pubDate>Tue, 19 Mar 2024 09:25:42 +0900</pubDate>
    <lastBuildDate>Tue, 19 Mar 2024 09:25:42 +0900</lastBuildDate>
    <generator>Jekyll v3.9.4</generator>
    
      <item>
        <title>Fuji Stroll、さっそくカスタマイズ</title>
        <description>&lt;h3 id=&quot;予定通りブルホーンに&quot;&gt;予定通りブルホーンに&lt;/h3&gt;
&lt;p&gt;　&lt;a href=&quot;/miscellaneous/2024-03-10/stroll01&quot;&gt;前回の記事&lt;/a&gt;で固定ギアに初めて乗って転倒したことを書きましたが、家で自転車をよく見るとハンドルグリップが破けてハンドルバーが一部剥き出しになってました。いずれはブルホーンハンドルに交換するつもりだったのですが、丁度いい機会だから早速交換したのでその顛末を書きます。&lt;/p&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
&lt;div style=&quot;float:left; margin: 0px 0px 0px&quot;&gt;
&lt;a href=&quot;/images/palm.png&quot;&gt;&lt;img width=&quot;120&quot; height=&quot;160&quot; src=&quot;https://happyclam.github.io/images/palm.png&quot; alt=&quot;擦り傷&quot; title=&quot;擦り傷&quot; /&gt;&lt;/a&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 5px 0px&quot;&gt;
&lt;a href=&quot;/images/glove.png&quot;&gt;&lt;img width=&quot;120&quot; height=&quot;160&quot; src=&quot;https://happyclam.github.io/images/glove.png&quot; alt=&quot;血が滲んだグローブ&quot; title=&quot;血が滲んだグローブ&quot; /&gt;&lt;/a&gt;
&lt;/div&gt;
&lt;div&gt;
&lt;a href=&quot;/images/bargrip.png&quot;&gt;&lt;img width=&quot;120&quot; height=&quot;160&quot; src=&quot;https://happyclam.github.io/images/bargrip.png&quot; alt=&quot;破れたハンドルバーグリップ&quot; title=&quot;破れたハンドルバーグリップ&quot; /&gt;&lt;/a&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br clear=&quot;left&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;自転車購入時に付けたもの&quot;&gt;自転車購入時に付けたもの&lt;/h3&gt;
&lt;p&gt;　FujiのStrollはペダルはデフォルトで付属していますので、あとは購入時にRITEWAYのキックスタンドとFuji製の固定ギア(17T)を付けてもらいました。Strollはチェーンステイ部分に最初からキックスタンド取り付け用の穴があいているので、それを利用しない手はないですね。固定ギア（コグ）の方はネジ切り式ではないようで、Amazonとかでコグを買って自分で交換するようなことは出来ない？みたいです。ロード用のスプロケット外す工具なんかとも少し違う工具が要るみたいだし、自分でメンテする気はなくなりました。&lt;br /&gt;
　コグの歯数は15Tから18Tまで選べるようですが軽めの17Tにしました。スキッドポイントが多い点でも奇数の17Tが良いみたいですが、軽めのギアでどれぐらい坂道を登れるのか、どれぐらいの山に登ることが出来るのかに興味があったので軽めにしたのですが、街なかにある歩道橋を登ってみた感じでは、とても山を登るなんて無理だなぁって感想です。でも、いつかは試してみると思います:sweat_smile:&lt;/p&gt;

&lt;div style=&quot;width:320px; margin: 0 auto;&quot;&gt;

  &lt;p&gt;&lt;a href=&quot;/images/stroll_stand.png&quot;&gt;&lt;img src=&quot;https://happyclam.github.io/images/stroll_stand.png&quot; alt=&quot;RITEWAY キックスタンド&quot; width=&quot;240&quot; height=&quot;320&quot; title=&quot;キックスタンド&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;h3 id=&quot;フラットバーが嫌なわけではないけど&quot;&gt;フラットバーが嫌なわけではないけど&lt;/h3&gt;
&lt;p&gt;　購入時はStrollに元から付いているフラットバーハンドルもカッコイイと思っていたのですが、京都で購入して大阪までフリーギアのまま乗って帰ってきた（約30km）時に、なぜか手のひらが痛くなりました。昔IDIOM2をフラットバーで乗っていた時も手のひらが痛くなった記憶があるので、もしかしたら肩幅より広く手を広げて前傾になるのは手のひら（人差し指の付け根辺り）への負荷が大きくなるんじゃないか？なんて思ってます。上の写真の手のひらを負傷した時も、どこかに打ち付けて負傷したのではなく、グローブとハンドルグリップのブツブツとの摩擦で擦りむけたのだと思います。なので買ったばかりの自転車ですが、480mmという長いフラットバーは止めて交換することにしました。&lt;br /&gt;
　購入したのは&lt;a href=&quot;https://hb.afl.rakuten.co.jp/ichiba/3a3efda0.4effcd55.3a3efda1.db6e6e2e/_RTLink90217?pc=https%3A%2F%2Fitem.rakuten.co.jp%2Fspoke-seya%2Fpa-nitto-4582350836073%2F&amp;amp;link_type=hybrid_url&amp;amp;ut=eyJwYWdlIjoiaXRlbSIsInR5cGUiOiJoeWJyaWRfdXJsIiwic2l6ZSI6IjI0MHgyNDAiLCJuYW0iOjEsIm5hbXAiOiJyaWdodCIsImNvbSI6MSwiY29tcCI6ImRvd24iLCJwcmljZSI6MSwiYm9yIjoxLCJjb2wiOjEsImJidG4iOjEsInByb2QiOjAsImFtcCI6ZmFsc2V9&quot;&gt;NITTOのRB-006(380mm)&lt;/a&gt;ショートブルホーンハンドルで、シンプルでわずかに両肩下がりなのが気に入りました。ロードもミニベロも380mm使ってたし、幅広のハンドルより自分には合ってそうで、大阪市内まで出かけてトータル50km程乗りましたが手は痛くならず快適でした。&lt;/p&gt;

&lt;h3 id=&quot;ブルホーンはトラック競技が発祥&quot;&gt;ブルホーンはトラック競技が発祥&lt;/h3&gt;
&lt;p&gt;　諸説あるようですが、ブルホーンハンドルはトラック競技から生まれたそうです。トラック内で使用される自転車は、誰かが急ブレーキを掛けたりすると危険なのでブレーキは付いていませんが、ブルホーンハンドルも本来ブレーキを使わない人達が使いだしたそうです。&lt;br /&gt;
　私は&lt;a href=&quot;/miscellaneous/2020-05-16/bicycle01&quot;&gt;以前の記事&lt;/a&gt;でブルホーンハンドルの角の部分を握りながらフルブレーキ出来るようにIDIOM2をカスタムしたことを書きましたが、そういう使い方のほうが邪道だったわけですね。街乗りに使うのならこのStrollも角の部分にブレーキを移動した方が使いやすいかもしれません（ブレーキレバーの交換が必要）が、とりあえずピスト仕様で今のままハンドルバー部分に置いて使おうと思います。そしてなるべくブレーキを使わなくて済むぐらいピストバイクを乗りこなせるようになれるのが理想です。でも実際街なかでピストに乗っている人によると、スキッドはブレーキの代わりにはならないしブレーキも頻繁に使うそうなのであくまでも理想ですね。&lt;br /&gt;
　あと、ブルホーンバーの角の部分を握っていたほうがスキッドもやり易いそうなので、主に河川敷の自転車道などの安全なところで練習しようと思ってます。&lt;/p&gt;

&lt;h3 id=&quot;スレッドステムはハンドル交換が面倒&quot;&gt;スレッドステムはハンドル交換が面倒&lt;/h3&gt;
&lt;p&gt;　「スレッドステム ハンドル 通らない」とかで検索すると苦労話がいろいろ出てきますが、ロード系のアヘッドステムと違ってスレッドステムの場合はハンドル径が合っていても取り付けできないハンドルがあるようです。事前にそのことを知っていたのでカーブが少なくてシンプルなハンドルを選んだのですが、それでも初めてのスレッドステムのハンドル交換は手間取りました。&lt;br /&gt;
　まずハンドルの中心部までステムに差し込みます。中心部（クランプ径25.4φ）は太くなっているのでハンドルを押し込んでもステムの穴に入りません。下の写真のようにマイナスドライバーをステムの開口部に差し込みながら、梃子の原理を使ってグイッとステムの穴を広げてハンドルを回しながら押し込んでいきます。この時ハンドルをグリグリと左右に回すのではなく、回しやすい方向がある（たまたま？）と思いますので一方向にグルグルと回転させながら差し込むようにするとゆっくり入っていきました。ハンドル中心部にギザギザの滑り止めの溝が切ってありますが、この溝は一方向に引っかかるようになっている？みたいで、グルグルと同じ方向に回して押し込むのがコツみたいです。私は最初グリグリと回す方向を変えながら押し込んだせいで写真のようにNITTOのロゴの周りに細かな傷が付いてしまいました。&lt;/p&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
&lt;div style=&quot;float:left; margin: 0px 0px 0px&quot;&gt;
&lt;a href=&quot;/images/stem00.png&quot;&gt;&lt;img width=&quot;150&quot; height=&quot;120&quot; src=&quot;https://happyclam.github.io/images/stem00.png&quot; /&gt;&lt;/a&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 5px 0px&quot;&gt;
&lt;a href=&quot;/images/stem01.png&quot;&gt;&lt;img width=&quot;150&quot; height=&quot;120&quot; src=&quot;https://happyclam.github.io/images/stem01.png&quot; /&gt;&lt;/a&gt;
&lt;/div&gt;
&lt;div&gt;
&lt;a href=&quot;/images/stem02.png&quot;&gt;&lt;img width=&quot;150&quot; height=&quot;120&quot; src=&quot;https://happyclam.github.io/images/stem02.png&quot; /&gt;&lt;/a&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br clear=&quot;left&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;やはりストラップも付けてみる&quot;&gt;やはりストラップも付けてみる&lt;/h3&gt;
&lt;p&gt;　ストラップ付ける気はなかったのですが長い下りを走っている時に、ブレーキを使わずに足の力で減速（エンジンブレーキみたいなものですね）してみようと思い足を踏ん張ろうとするのですが、ペダルの力に負けて全然出来ません。そして、ペダルが回る力に負けて足からペダルが外れて、片足が宙に浮いたままペダルがグルグルと回る状態になります。ブレーキがあるので減速してまたペダルに足を乗せることは出来るのですが、片足しかペダルに乗っていない状態ってのは非常に不安定で、その状態の時に道路に段差でもあれば転倒するかもしれません。これは危険だなぁと感じたのでこれからはストラップでペダルに足を固定することにしました。トリックをするためだけではなく、ピストに乗るときはペダルに足を固定していた方が安全なのかもしれません。ペダルストラップ使えば減速もやり易くなるでしょうし、様子見ながら慣れていこうと思います。&lt;/p&gt;

&lt;div style=&quot;width:320px; margin: 0 auto;&quot;&gt;

  &lt;p&gt;&lt;a href=&quot;/images/strap.png&quot;&gt;&lt;img src=&quot;https://happyclam.github.io/images/strap.png&quot; alt=&quot;Wellgo W-8 ストラップ&quot; width=&quot;320&quot; height=&quot;240&quot; title=&quot;Wellgo W-8 ストラップ&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p&gt;　通販でペダルストラップ（&lt;a href=&quot;https://hb.afl.rakuten.co.jp/ichiba/3a9f3c76.2839d84a.3a9f3c77.bedae183/_RTLink90217?pc=https%3A%2F%2Fitem.rakuten.co.jp%2Fmcycle%2Ff4580131470645%2F&amp;amp;link_type=hybrid_url&amp;amp;ut=eyJwYWdlIjoiaXRlbSIsInR5cGUiOiJoeWJyaWRfdXJsIiwic2l6ZSI6IjI0MHgyNDAiLCJuYW0iOjEsIm5hbXAiOiJyaWdodCIsImNvbSI6MSwiY29tcCI6ImRvd24iLCJwcmljZSI6MSwiYm9yIjoxLCJjb2wiOjEsImJidG4iOjEsInByb2QiOjAsImFtcCI6ZmFsc2V9&quot;&gt;Wellgoの&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;W-8&lt;/code&gt;&lt;/a&gt;）を購入したのですが、Strollに付いていたペダル（Wellgoの&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C128DJ&lt;/code&gt;）には付けられないようです。ストラップを通す穴が片側にしかありませんし、その穴も小さすぎてストラップが通りません:cry:自転車購入時に店の人に確認したときは「ストラップ付けられます」と返事をもらってたのですが、普通のママチャリ自転車屋さんだったのでよく分かってなかったのかもしれません。&lt;br /&gt;
　仕方がないので&lt;a href=&quot;https://hb.afl.rakuten.co.jp/ichiba/3a9f3a95.dd7add01.3a9f3a96.316d307a/_RTLink90217?pc=https%3A%2F%2Fitem.rakuten.co.jp%2Fzitensyadepo%2Fmks-sylvan-gordito-sv%2F&amp;amp;link_type=hybrid_url&amp;amp;ut=eyJwYWdlIjoiaXRlbSIsInR5cGUiOiJoeWJyaWRfdXJsIiwic2l6ZSI6IjI0MHgyNDAiLCJuYW0iOjEsIm5hbXAiOiJyaWdodCIsImNvbSI6MSwiY29tcCI6ImRvd24iLCJwcmljZSI6MSwiYm9yIjoxLCJjb2wiOjEsImJidG4iOjEsInByb2QiOjAsImFtcCI6ZmFsc2V9&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MKS(三ヶ島製作所)SYLVAN Gordito&lt;/code&gt;&lt;/a&gt;と&lt;a href=&quot;https://hb.afl.rakuten.co.jp/ichiba/1b4d49cd.6bbf085f.1b4d49ce.c5e66119/_RTLink90217?pc=https%3A%2F%2Fitem.rakuten.co.jp%2Faris%2Fmks-spin-2%2F&amp;amp;link_type=hybrid_url&amp;amp;ut=eyJwYWdlIjoiaXRlbSIsInR5cGUiOiJoeWJyaWRfdXJsIiwic2l6ZSI6IjI0MHgyNDAiLCJuYW0iOjEsIm5hbXAiOiJyaWdodCIsImNvbSI6MSwiY29tcCI6ImRvd24iLCJwcmljZSI6MSwiYm9yIjoxLCJjb2wiOjEsImJidG4iOjEsInByb2QiOjAsImFtcCI6ZmFsc2V9&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MKS(三ヶ島製作所)蹴返しパーツ SPIN-2(スピン2)&lt;/code&gt;&lt;/a&gt;を購入して自分で付けました。&lt;/p&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
&lt;div style=&quot;float:left; margin: 0px 0px 0px&quot;&gt;
&lt;a href=&quot;/images/wellgo.png&quot;&gt;&lt;img width=&quot;150&quot; height=&quot;120&quot; src=&quot;https://happyclam.github.io/images/wellgo.png&quot; /&gt;&lt;/a&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 5px 0px&quot;&gt;
&lt;a href=&quot;/images/gordito.png&quot;&gt;&lt;img width=&quot;150&quot; height=&quot;120&quot; src=&quot;https://happyclam.github.io/images/gordito.png&quot; /&gt;&lt;/a&gt;
&lt;/div&gt;
&lt;div&gt;
&lt;a href=&quot;/images/grease.png&quot;&gt;&lt;img width=&quot;150&quot; height=&quot;120&quot; src=&quot;https://happyclam.github.io/images/grease.png&quot; /&gt;&lt;/a&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br clear=&quot;left&quot; /&gt;&lt;/p&gt;

&lt;p&gt;　グレードアップしていくのは嬉しいのですが、自転車って凝りだすと意外とお金がかかるんですよねぇ:sweat_smile:&lt;/p&gt;

&lt;div style=&quot;width:240px; margin: 0 auto;&quot;&gt;

  &lt;p&gt;&lt;a href=&quot;/images/spin2.png&quot;&gt;&lt;img src=&quot;https://happyclam.github.io/images/spin2.png&quot; alt=&quot;Gordito &amp;amp; SPIN-2&quot; width=&quot;240&quot; height=&quot;320&quot; title=&quot;Gordito &amp;amp; SPIN-2&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;h3 id=&quot;いずれはリアバスケットも付ける予定&quot;&gt;いずれはリアバスケットも付ける予定&lt;/h3&gt;
&lt;p&gt;　現在買い物に使っているマークローザに何かトラブルが起きたら引退させて、このStrollにリアバスケットを付けて買い物に使おうと思ってます。リアバスケットは&lt;a href=&quot;https://hb.afl.rakuten.co.jp/ichiba/3a468d0b.3450311a.3a468d0c.2e57a6ed/_RTLink90217?pc=https%3A%2F%2Fitem.rakuten.co.jp%2Fauc-cycle-parts%2Fra2101-4%2F&amp;amp;link_type=hybrid_url&amp;amp;ut=eyJwYWdlIjoiaXRlbSIsInR5cGUiOiJoeWJyaWRfdXJsIiwic2l6ZSI6IjI0MHgyNDAiLCJuYW0iOjEsIm5hbXAiOiJyaWdodCIsImNvbSI6MSwiY29tcCI6ImRvd24iLCJwcmljZSI6MSwiYm9yIjoxLCJjb2wiOjEsImJidG4iOjEsInByb2QiOjAsImFtcCI6ZmFsc2V9&quot;&gt;RITEWAY(ライトウェイ) のリアバスケット&lt;/a&gt;を予定しています。ネットで調べるとStrollへの取り付け実績もあるようなので大丈夫でしょう。リアバスケット付ける頃にはスタンディングやスキッドを自在に出来るようになっていればいいなぁと思ってます。買い物用のカゴ付き実用車でトリックを決めるのもアリだと思います:smile:&lt;/p&gt;

&lt;div style=&quot;width:320px; margin: 0 auto;&quot;&gt;

  &lt;p&gt;&lt;a href=&quot;/images/stroll_custom.png&quot;&gt;&lt;img src=&quot;https://happyclam.github.io/images/stroll_custom.png&quot; alt=&quot;STROLL Custom&quot; width=&quot;320&quot; height=&quot;240&quot; title=&quot;Stroll Custom&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div style=&quot;width:320px; margin: 0 auto;&quot;&gt;

  &lt;p&gt;&lt;a href=&quot;/images/stroll_custom2.png&quot;&gt;&lt;img src=&quot;https://happyclam.github.io/images/stroll_custom2.png&quot; alt=&quot;STROLL Custom&quot; width=&quot;240&quot; height=&quot;320&quot; title=&quot;Stroll Custom&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div&gt;
    &lt;script async=&quot;&quot; src=&quot;https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js&quot;&gt;&lt;/script&gt;
    &lt;!-- display01 --&gt;
    &lt;ins class=&quot;adsbygoogle&quot; style=&quot;display:block&quot; data-ad-client=&quot;ca-pub-9018029357773039&quot; data-ad-slot=&quot;3925247388&quot; data-ad-format=&quot;auto&quot; data-full-width-responsive=&quot;true&quot;&gt;&lt;/ins&gt;
    &lt;script&gt;
    (adsbygoogle = window.adsbygoogle || []).push({});
    &lt;/script&gt;
&lt;/div&gt;

&lt;hr /&gt;

</description>
        <pubDate>Sat, 16 Mar 2024 00:00:00 +0900</pubDate>
        <link>https://happyclam.github.io/miscellaneous/2024-03-16/stroll02</link>
        <guid isPermaLink="true">https://happyclam.github.io/miscellaneous/2024-03-16/stroll02</guid>
        
        <category>bicycle</category>
        
        
        <category>miscellaneous</category>
        
      </item>
    
      <item>
        <title>固定ギア（ピスト）に乗ってみたい</title>
        <description>&lt;h3 id=&quot;買い物用ママチャリの代替車&quot;&gt;買い物用ママチャリの代替車&lt;/h3&gt;
&lt;p&gt;　&lt;a href=&quot;/miscellaneous/2021-12-05/minivelo&quot;&gt;以前の記事&lt;/a&gt;でクロスバイクを買うつもりだと書きましたが、「IDIOM2で登れない坂」の件は、結局スプロケットを交換（12-25Tから11-32Tに交換）することで解決したので新しい自転車の購買欲は失せていました。&lt;br /&gt;
　でも今度は、現在買い物に使っているママチャリ（ブリジストンのマークローザ）が変速機が壊れたまま数年使っていて、そろそろ代替車を買おうかと考えているうちに変速機使ってないのならシングルギアでいいじゃないか？となり、シングルギアなら一度固定ギア（ピスト）を試してみるのもいいかも？となり、youtubeでピストの動画を見ていたらピストに乗りたくなってきたので買うことにしました。&lt;/p&gt;

&lt;h3 id=&quot;自転車買うときはサイズが大事&quot;&gt;自転車買うときはサイズが大事&lt;/h3&gt;
&lt;p&gt;　今使っているマークローザは15年前に買ったもので年式によって違うのですが、フレームサイズが確か450mmのものです。スレッドステムを交換してハンドルを下げてカスタムしているのですが、最近まで乗っていた470mmのロードバイクよりサイズ的には楽で自分に合ってるなぁと感じていました。ピストを買うと決めても何を買うかとなったときに、自分の場合は小さなフレームサイズが用意されている車種に限定されます。&lt;br /&gt;
　最初は今のママチャリと同じ26インチタイヤで尚且つホリゾンタルフレームの&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;TOKYOBIKEのMONO&lt;/code&gt;が候補になったのですが、実物を見てみると細くて小さなフレームで26インチだとなんだか子ども用の自転車に見えるんですよねぇ。700Cの自転車にすれば今持っているタイヤチューブのストックも流用出来るし26インチと違ってタイヤの種類も色々選べるので、ホリゾンタルフレームには惹かれるものの思い直して700Cのバイクから候補を探すことにしました。&lt;br /&gt;
　次に見つけた候補&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CinelliのTutto&lt;/code&gt;は小さいサイズがありませんし、460mmサイズがある&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;All CityのBig Block&lt;/code&gt;もいいなぁと思ったのですが、固定ギアを試してみたい、買い物用に使いたいというだけの自分にはどちらも値段が高過ぎて買う気になれません。いずれリアキャリアを付けるつもりなのでフレームにダボ穴があることも条件です。ということで430mmサイズがある&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FujiのStroll&lt;/code&gt;に行き着きました。470mmのロードバイクが少し大きいと感じて、450mmで26インチタイヤのマークローザが楽だと感じていた自分には丁度いいサイズかなぁと思ってます。&lt;br /&gt;
　聞いた話では&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;股下長 - 250mm = シートポスト長(CC)&lt;/code&gt;になるフレームサイズがちょうど良いらしいです。自分の場合430mmのStorollだと若干小さめとなりますが、少し小さめのフレームの方が乗りやすいとも聞きます。&lt;/p&gt;

&lt;div style=&quot;width:320px; margin: 0 auto;&quot;&gt;

  &lt;p&gt;&lt;a href=&quot;/images/stroll_2023.png&quot;&gt;&lt;img src=&quot;https://happyclam.github.io/images/stroll_2023.png&quot; alt=&quot;STROLL 2023&quot; width=&quot;320&quot; height=&quot;240&quot; title=&quot;Stroll 2023&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;h3 id=&quot;fuji-strollはフリップフロップハブ&quot;&gt;Fuji Strollはフリップフロップハブ&lt;/h3&gt;
&lt;p&gt;　上に挙げた候補の車種は全てフリップフロップというハブが採用されていて、２種類のコグを取り付けて後輪を外して向きをひっくり返して取り付ければ固定ギアとフリーギアを切り替えるなんて使い方が出来ます。自転車のカスタムをいろいろやりましたが、フリーギアしか触ったことがない自分はそういうハブが存在することも知りませんでした。自転車は奥が深いですねぇ、固定ギアとフリーギアを簡単に切り替えられると知ったことも固定ギアを試してみようと思った動機の一つです。固定ギアの自転車を買ってみて自分には合わないと感じた場合に、すぐに今まで使っていた自転車と同じフリーギアに戻せる点は購入の動機になりますよねぇ。FujiのStrollはデフォルトではフリーギアしか付いていませんが、このフリップフロップハブが採用されていることが購入の決め手になりました。あとは3000円程度の固定ギア（コグ）を購入するだけで済みます。&lt;/p&gt;

&lt;div style=&quot;width:400px; margin: 0 auto;&quot;&gt;
&lt;div style=&quot;float:left; margin: 0px 0px 0px&quot;&gt;
&lt;a href=&quot;/images/rench.png&quot;&gt;&lt;img width=&quot;120&quot; height=&quot;160&quot; src=&quot;https://happyclam.github.io/images/rench.png&quot; alt=&quot;15mmBox レンチ&quot; title=&quot;15mm Boxレンチ&quot; /&gt;&lt;/a&gt;
&lt;/div&gt;
&lt;div style=&quot;float:left; margin: 0px 5px 0px&quot;&gt;
&lt;a href=&quot;/images/free_gear.png&quot;&gt;&lt;img width=&quot;120&quot; height=&quot;160&quot; src=&quot;https://happyclam.github.io/images/free_gear.png&quot; alt=&quot;フリーギア 16T&quot; title=&quot;フリーギア 16T&quot; /&gt;&lt;/a&gt;
&lt;/div&gt;
&lt;div&gt;
&lt;a href=&quot;/images/fixed_gear.png&quot;&gt;&lt;img width=&quot;120&quot; height=&quot;160&quot; src=&quot;https://happyclam.github.io/images/fixed_gear.png&quot; alt=&quot;固定ギア 17T&quot; title=&quot;固定ギア 17T&quot; /&gt;&lt;/a&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br clear=&quot;left&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;初乗車でいきなりピストの洗礼を受ける&quot;&gt;初乗車でいきなりピストの洗礼を受ける&lt;/h3&gt;
&lt;p&gt;　とりあえず購入時のフリーギアで河川敷まで行ってから固定ギアに切り替えて練習することにしました。固定ギアで走り出して特に問題は無さそうだなと、たぶん20Km/hぐらいスピード出していたと思いますが、止まろうとしたら右前方に投げ出される感じで転倒してしまいました:sweat_smile:&lt;br /&gt;
　何が起こったか分からないって感じでしたが、止まるために軽くブレーキを握って足の回転を止めたのでしょう、足を止めてもペダルは動き続けるので止めた足をペダルが持ち上げて前方にぶっ飛んだ感じです。どこで打撲したのか分からないのですが、グローブをしていたのに軽く手を擦りむいてハンドルも曲がってしまいました。ブレーキ掛けてもすぐに足の回転を止めてはいけません。頭では分かっていたつもりなんですが…。&lt;br /&gt;
　前輪を両足に挟んでハンドルの曲がりを直していると、通りがかった見知らぬおばちゃんが「大丈夫？」と声を掛けてきました、転倒現場を見られていたようです。「大丈夫です」と笑って答えておきましたが、固定ギアの自転車に乗ってるなんて想像もしてないであろうおばちゃんには「なんてドン臭い人だろう」と思われたことでしょう:sweat_smile:でも、車道で試さなくてよかったと思うとともに、今は転倒シーンを動画に残しておきたかったなぁなんて思ってます（自分が見たい）。みなさんもピスト初めて乗るときは車道は避けましょう。そして停車の感覚が身に付くまではスピードを出さないことですね。&lt;/p&gt;

&lt;h3 id=&quot;徐々に分かってきた&quot;&gt;徐々に分かってきた&lt;/h3&gt;
&lt;p&gt;　その後一時間ぐらい慎重に乗りながら、上り坂や下り坂を試してみたり&lt;strong&gt;クロス降り（左足をペダルに置いたまま左ペダルが上昇するタイミングで右足でフレームを跨いで降車）&lt;/strong&gt;と言われる降り方を練習してました。Youtubeで見たときは&lt;strong&gt;クロス降り&lt;/strong&gt;なんてすぐ出来ると思っていたのですが練習が必要でした。&lt;strong&gt;スキッド(後輪をスライドさせてブレーキング)&lt;/strong&gt;も最初は全く出来る気がしませんでしたが、ブレーキを使えばそれっぽいことが出来ると分かってきました。街なかでノーブレーキピストなんて言うものが存在するのだからブレーキは使わないものだと思っていたのですが、ペダルが足を持ち上げる力が予想以上に強くてとてもブレーキ無しではペダルを後方に踏むなんて自分には無理な気がしました。前輪ブレーキを使って減速すると同時にペダルを後方に踏んで後輪をズッズッーっと短く滑らせることは何回か出来ましたが、ブレーキを使っていては&lt;strong&gt;スキッド&lt;/strong&gt;とは言えないでしょうね:sweat_smile:もう少し固定ギアに慣れてペダルにストラップを付けて前足でペダルを持ち上げる動作も加えれば可能なのかもしれませんが、ビンディングとかストラップって、何か危ない気がするんですよねぇ。転倒した時も、もし足をペダルに固定していたら骨折してたかもしれないと思うと、怖いのでとりあえず今のところはストラップは使わないつもりです。でも使うとしたらトゥークリップやビンディングではなくストラップにしようと思ってます、一番簡単に足が抜けそうですし。&lt;/p&gt;

&lt;h3 id=&quot;ピストバイクは休めない&quot;&gt;ピストバイクは休めない&lt;/h3&gt;
&lt;p&gt;　とりあえず&lt;strong&gt;クロス降り&lt;/strong&gt;が出来るようになったので満足して帰ることにしました。&lt;strong&gt;クロス降り&lt;/strong&gt;気に入りました。ただ自転車を降りるというだけの動作なのに、フリーギアとは違った難しさや面白さがあります。私もそうですが、ピストバイク乗る人は実用性よりも、こういう難しさを克服したときの達成感とか未知なものへの好奇心・探究心を満たすことを優先しているのではないでしょうか？&lt;br /&gt;
　帰路につく時にフリーギアに戻すかどうか迷いましたが、フリーギアに戻してそれに慣れてしまうと次固定ギアにした時に今回の二の舞になるかもしれないし、フリーギアに戻すと一回固定ギアを体験しただけで音を上げてピストを諦めてしまうような感じでなんだか悔しい気がしたので、しばらく固定ギアに慣れるためにそのまま固定ギアで帰路につきました。この「出来ないと悔しい」と言う感じ、プログラミングに通じるものがあると思います。&lt;br /&gt;
　家までの道中なにが辛かったかといえばピストバイクは一瞬たりとも休めないってことです。フリーギアなら足が疲れたと感じたときや、おしりが少し痛いと感じた時に漕ぐのを止めてペダルの上で立ち上がりサドルからおしりを離して惰性で進むことがあると思いますが、それが出来ないのが一番つらかったです。常にペダルを回していなければならず、おしりをサドルから離したければ立ち漕ぎを強いられ汗で密着したパンツを摘んでシワを直そうと思ったら片手離して立ち漕ぎを継続しなければなりません（そんなの無理）。河川敷から家までわずか数キロなのに２回自転車を降りて歩いて休憩しました。よく100キロ以上のロングライドに出かけてた自分にとっては、数キロで休憩なんて考えられないことです。ピストはやはり短距離競技用だなぁと痛感しました。競輪選手が乗っている自転車ですからねぇ。&lt;br /&gt;
　買い物・街乗りに使うだけなら短距離用で問題ないので、とりあえずもう少し固定ギアで様子を見ようと思ってます。また進展があれば記事を書こうと思います。&lt;/p&gt;

&lt;h3 id=&quot;ピストでおならは出来ない&quot;&gt;ピストでおならは出来ない？&lt;/h3&gt;
&lt;p&gt;　あと、「ピストバイク乗っているとおならは出来ない」と聞いたことがあります。googleで検索しても回答は得られなかったのですが、Twitterで検索すると何人かが「ピストでおならをするのは難しい」とか「おならしたら転けそうになった」という呟きを見かけたので、そういうことなんでしょう。出来ないってことはないみたいですね。&lt;/p&gt;

&lt;div&gt;
    &lt;script async=&quot;&quot; src=&quot;https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js&quot;&gt;&lt;/script&gt;
    &lt;!-- display01 --&gt;
    &lt;ins class=&quot;adsbygoogle&quot; style=&quot;display:block&quot; data-ad-client=&quot;ca-pub-9018029357773039&quot; data-ad-slot=&quot;3925247388&quot; data-ad-format=&quot;auto&quot; data-full-width-responsive=&quot;true&quot;&gt;&lt;/ins&gt;
    &lt;script&gt;
    (adsbygoogle = window.adsbygoogle || []).push({});
    &lt;/script&gt;
&lt;/div&gt;

&lt;hr /&gt;

</description>
        <pubDate>Sun, 10 Mar 2024 00:00:00 +0900</pubDate>
        <link>https://happyclam.github.io/miscellaneous/2024-03-10/stroll01</link>
        <guid isPermaLink="true">https://happyclam.github.io/miscellaneous/2024-03-10/stroll01</guid>
        
        <category>bicycle</category>
        
        
        <category>miscellaneous</category>
        
      </item>
    
      <item>
        <title>一回休み（パス）があるゲームでのαβ法</title>
        <description>&lt;h3 id=&quot;気になっていたこと&quot;&gt;気になっていたこと&lt;/h3&gt;
&lt;p&gt;　以前&lt;a href=&quot;/software/2020-06-07/mancala&quot;&gt;「マンカラは先手必勝？後手必勝？」&lt;/a&gt;という記事の中で、&lt;a href=&quot;https://www.amazon.co.jp/HTML5-CoffeeScriptで作る最強の三目並べプログラム-MIN-MAX法からαβ法へ-happyclam-ebook/dp/B01D1IJ0S0/ref=sr_1_1?s=digital-text&amp;amp;ie=UTF8&amp;amp;qid=1473938717&quot;&gt;自分が書いた本（「HTML5+CoffeeScriptで作る最強の三目並べプログラム」）&lt;/a&gt;を紹介して、「マンカラは三目並べと違ってパス（一回休み）があるので少しコードを変更する必要がある」と書いたまま詳細は説明してなかったことが気になってたので書くことにしました。本を買って頂いた方にとっては今更な感じはありますが、マンカラの&lt;a href=&quot;https://github.com/happyclam/mancala_karah&quot;&gt;ソースコード&lt;/a&gt;を元に説明しようと思います。&lt;/p&gt;

&lt;h3 id=&quot;αβ法の実装手順&quot;&gt;αβ法の実装手順&lt;/h3&gt;
&lt;p&gt;　当ブログも昔は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;αβ法&lt;/code&gt;で検索すると&lt;a href=&quot;/software/2014-09-16/ab_method&quot;&gt;この記事&lt;/a&gt;が上位に表示されていたのですが、今は他にもっと丁寧な説明のあるサイトが増えたので&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;圏外&lt;/code&gt;になってるみたいですね:sweat_smile:でもαβ法の解説に納得出来てもいざコードを書こうとすると出来ないという意見も見かけます。&lt;a href=&quot;https://www.amazon.co.jp/HTML5-CoffeeScriptで作る最強の三目並べプログラム-MIN-MAX法からαβ法へ-happyclam-ebook/dp/B01D1IJ0S0/ref=sr_1_1?s=digital-text&amp;amp;ie=UTF8&amp;amp;qid=1473938717&quot;&gt;この本&lt;/a&gt;では３つのソースコードを用意して、この手順でソースを変更していけばαβ法が実装できますよという例を示しましたが、ここでマンカラを例にして簡単におさらいします。&lt;br /&gt;
　まず、前提として先手は大きい値が有利、後手は小さい値が有利（逆でも可）という静的評価関数を用意します。静的評価関数はマンカラの場合なら&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;(先手のストア内の豆の数 - 後手のストア内の豆の数)&lt;/code&gt;になります。&lt;br /&gt;
　その後以下のように局面の先読みを行う関数を実装します。&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;１つの階層におけるすべての着手を試して静的評価を行い、先手なら一番大きい後手なら一番小さい評価値を得る着手とその時の評価値を返す関数を作る。&lt;/li&gt;
  &lt;li&gt;1で作った関数をゲームが終了するか指定された手数（読みの深さ）に達することを終了条件とする再帰関数に書き換える
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-&amp;gt;ミニマックス法完成&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;2で作った関数に下層ノードに評価値を渡すための引数（閾値）を追加して、その閾値と現在の階層の評価値を比較して読みを中断（枝刈り、αβカット）してリターンするか、読みを続けるかの条件を書き加える
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-&amp;gt;αβ法完成&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;3で作った関数に先手、後手、先手という風に順番に着手したのか、先手、先手、先手と連続着手したのか区別するための引数を追加して、αβカットをしている部分に連続着手した場合はαβカットをしないように条件を書き加える&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;　この4.の作業をすれば、&lt;strong&gt;一回休み（パス）があるゲームでのαβ法が完成します&lt;/strong&gt;。要は先手か後手が連続着手した場合は何回連続であってもすべて無視して一回の着手と考えて、その最後の一回の評価値と閾値を比較してαβカットを行うようにすればいいだけです。&lt;/p&gt;

&lt;h3 id=&quot;実際のコード&quot;&gt;実際のコード&lt;/h3&gt;
&lt;p&gt;　&lt;a href=&quot;https://github.com/happyclam/mancala_karah&quot;&gt;githubのレポジトリ内のソースコード&lt;/a&gt;は&lt;a href=&quot;/software/2020-06-07/mancala&quot;&gt;以前の記事&lt;/a&gt;で使ったコードと大体同じなのですが、&lt;a href=&quot;/software/2020-06-07/mancala&quot;&gt;以前の記事&lt;/a&gt;では先手必勝か後手必勝かを確認するためのものだったので、そのままでは先手あるいは後手の負けが確定したときに最善手を逃します。「勝ちあるいは負けが確定した時点で最善かどうかに拘らず読みを打ち切ってReturn」するようになってました。&lt;br /&gt;
　でも、&lt;a href=&quot;https://github.com/happyclam/mancala_karah&quot;&gt;ここで解説するコード&lt;/a&gt;は、&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;実際のアプリ（マンカラナッツ）&lt;/a&gt;で使ってるコードと同じで負けが確定しても最善で負けるようになってます。&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;マンカラナッツ&lt;/a&gt;では&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C++&lt;/code&gt;で作成していますがそれの&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Dart&lt;/code&gt;版です。&lt;/p&gt;

&lt;p&gt;　マンカラのゲーム盤は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;board&lt;/code&gt;変数で表され、14要素の固定長配列になってます。&lt;/p&gt;

&lt;div style=&quot;float:left; margin: 0px 0px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;&lt;br /&gt;後手のストア&lt;br /&gt; 0&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;&amp;nbsp;13&amp;nbsp;&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;&amp;nbsp;12&amp;nbsp;&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;&amp;nbsp;11&amp;nbsp;&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;&amp;nbsp;10&amp;nbsp; &lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;&amp;nbsp;&amp;nbsp;9&amp;nbsp;&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;&amp;nbsp;&amp;nbsp;8&amp;nbsp;&lt;/td&gt;
    &lt;td rowspan=&quot;2&quot; align=&quot;center&quot;&gt;&lt;br /&gt;先手のストア&lt;br /&gt; 7&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;&amp;nbsp;&amp;nbsp;1&amp;nbsp;&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;&amp;nbsp;&amp;nbsp;2&amp;nbsp;&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;&amp;nbsp;&amp;nbsp;3&amp;nbsp;&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;&amp;nbsp;&amp;nbsp;4&amp;nbsp;&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;&amp;nbsp;&amp;nbsp;5&amp;nbsp;&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;&amp;nbsp;&amp;nbsp;6&amp;nbsp;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br clear=&quot;all&quot; /&gt;&lt;/p&gt;

&lt;p&gt;　マンカラのルールを実装している部分は省略して先読みを行うAI部分だけ、行番号を付けて解説します。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;01---  List think(List board, Player oppo, int limit, int pre_value, bool pre_turn){
02---    List result =  List&amp;lt;int&amp;gt;.filled(2, 0, growable: false);
03---    int moved = 0;
04---    int score = 0;
05---    int ret = 0;
06---    int lastscore = (this.turn == FIRST) ? SECOND_WIN : FIRST_WIN;
07---    int lastposi = -1;
08---    var goal = (this.turn == FIRST) ? FIRST_GOAL : DENTS;
09---    var start = (this.turn == FIRST) ? FIRST_START : SECOND_START;

10---    List temp = [0,0,0,0,0,0,0,0,0,0,0,0,0,0];
11---    for (var i = start; i &amp;lt; goal; i++){
12---      temp = List.from(board);
13---      if (temp[i] == 0) continue;
14---      moved = karahaMove(temp, i, this.turn);
15---      ret = gameEnd(temp);
16---      if (ret == ONGAME &amp;amp;&amp;amp; limit &amp;gt; 0){
17---        if (moved == FIRST_GOAL || moved == SECOND_GOAL){
18---          result = this.think(temp, oppo, limit - 1, lastscore, false);
19---        } else {
20---          result = oppo.think(temp, this, limit - 1, lastscore, true);
21---        }
22---        score = result[0];
23---      } else {
24---        score = evaluate(temp);
25---        lastscore = score;
26---        lastposi = i;
27---        break;
28---      }
29---      if ((score &amp;gt;= lastscore &amp;amp;&amp;amp; this.turn == FIRST) || (score &amp;lt;= lastscore &amp;amp;&amp;amp; this.turn == SECOND)){
30---        lastscore = score;
31---        lastposi = i;
32---      }
33---      if (pre_turn == true &amp;amp;&amp;amp; ((pre_value &amp;lt; score &amp;amp;&amp;amp; this.turn == FIRST) || (pre_value &amp;gt; score &amp;amp;&amp;amp; this.turn == SECOND))) {
34---        break;
35---      }
36---    }
37---    result[0] = lastscore;
38---    result[1] = lastposi;
39---    return result;
40---  }

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;01: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;戻り値&lt;/code&gt;:[評価値, 着手]の2要素の配列&lt;br /&gt;
    &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;board&lt;/code&gt;:マンカラのBoardオブジェクト＝要素数14の固定長配列です&lt;br /&gt;
    &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;oppo&lt;/code&gt;:対戦相手のPlayerオブジェクト&lt;br /&gt;
    &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;limit&lt;/code&gt;:何手先まで読むのか（読みの深さ）の制限値、0になれば先読みを止める&lt;br /&gt;
    &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pre_value&lt;/code&gt;:αβカットの閾値（下層ノードに伝える評価値）&lt;br /&gt;
    &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pre_turn&lt;/code&gt;:連続着手か交互の着手かのフラグ（Falseなら連続着手なのでαβカットは行わない）&lt;/li&gt;
  &lt;li&gt;02: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;result&lt;/code&gt;:戻り値&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[評価値, 着手]&lt;/code&gt;の2要素の配列&lt;/li&gt;
  &lt;li&gt;03: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;moved&lt;/code&gt;:着手後に最後に豆を巻き終わった位置、自分のストアで豆を巻き終わったら連続で着手可能&lt;/li&gt;
  &lt;li&gt;04: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;score&lt;/code&gt;:同じ階層での一手毎の評価値を格納&lt;/li&gt;
  &lt;li&gt;05: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ret&lt;/code&gt;:ゲーム継続中（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ONGAME&lt;/code&gt;）かどうかを格納&lt;/li&gt;
  &lt;li&gt;06: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lastscore&lt;/code&gt;:最終的な評価値を格納。最初の比較時に必ず値が代入されるように先手の時は最小値、後手の時は最大値で初期化しておく&lt;/li&gt;
  &lt;li&gt;07: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lastposi&lt;/code&gt;:最終的に選ばれた着手を格納&lt;/li&gt;
  &lt;li&gt;08: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;goal&lt;/code&gt;:Board配列の添字。先手、後手、それぞれの着手の末端。先手なら6、後手なら13&lt;/li&gt;
  &lt;li&gt;09: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;start&lt;/code&gt;:Board配列の添字。先手、後手、それぞれの着手開始位置。先手なら1、後手なら8&lt;/li&gt;
  &lt;li&gt;10: マンカラの場合一度着手した盤面を元に戻す作業が煩雑なので、引数で渡された盤面データ（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;board&lt;/code&gt;）を元に戻すための作業用の配列を用意&lt;/li&gt;
  &lt;li&gt;11: 同じ階層で最善手を選択するためのforループ。このfor文は横（同じ手番）との比較で、再帰呼出しは上下（先手と後手）の評価値の比較、階層間の比較になります。&lt;/li&gt;
  &lt;li&gt;12: 作業用配列に盤面データをコピー&lt;/li&gt;
  &lt;li&gt;13: 穴に豆がなければ次の穴へ&lt;/li&gt;
  &lt;li&gt;14: 一手着手&lt;/li&gt;
  &lt;li&gt;15: ゲームが終了していないか確認&lt;/li&gt;
  &lt;li&gt;16: 再帰関数の終了条件を満たしていなければ（＝ゲームが終了していなくて、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;limit&lt;/code&gt;で指定された深さまで達していなければ）、再帰呼出しして先読み。&lt;br /&gt;
    この時引数の&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pre_value&lt;/code&gt;には、現時点でのその階層での最善手（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lastscore&lt;/code&gt;、先手なら最大評価値、後手なら最小評価値）を渡す。&lt;/li&gt;
  &lt;li&gt;18: 自分のストアで豆を巻き終われば、手番を替えずにもう一手先読み。&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pre_turn&lt;/code&gt;引数に&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;false&lt;/code&gt;を渡して、手番が変わっていないことを下層ノードに伝える。&lt;/li&gt;
  &lt;li&gt;20: それ以外は手番を交代してもう一手先読み。&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pre_turn&lt;/code&gt;引数に&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;true&lt;/code&gt;を渡して、手番が変わったことを下層ノードに伝える。&lt;/li&gt;
  &lt;li&gt;22: 戻ってきた評価値を格納、同じ階層での評価値の比較に使う。&lt;/li&gt;
  &lt;li&gt;24: 再帰関数の終了条件を満たしていれば（＝ゲームが終了したか、指定された深さまで読み終わったら）静的評価を行って呼び出し元にリターン&lt;/li&gt;
  &lt;li&gt;27: 戻り値（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;result&lt;/code&gt;）に値をセットしてリターンするのと同じ&lt;/li&gt;
  &lt;li&gt;29: 同じ階層での評価値の比較作業。先手の場合はより大きな評価値、後手の場合はより小さな評価値を選択し、その評価値と指し手を保存。&lt;/li&gt;
  &lt;li&gt;33: 連続着手ではない時（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pre_turn == true&lt;/code&gt;）だけαβカット。上層から引数で渡されてきた閾値（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pre_value&lt;/code&gt;）と現局面の評価値を比較し、先手の場合は閾値（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pre_value&lt;/code&gt;）より大きな評価値だった時、後手の場合は閾値（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pre_value&lt;/code&gt;）より小さな評価値だった時に読みを中断（その先を読む必要がない）して呼び出し元にリターン&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;　大して長くもないのでソースコードを追いかけていって、何をしているのかわからない部分は、解説を見るという感じで理解できるのではないでしょうか？&lt;/p&gt;

&lt;h3 id=&quot;αβ法の確認&quot;&gt;αβ法の確認&lt;/h3&gt;
&lt;p&gt;　実装したαβ法がうまく機能しているかどうか確認するのに一番簡単な方法は、αβ法を実装している部分をコメントアウトしてみて実装した場合と同じ出力が得られるかどうかです。計算量を削減するのがαβ法なので、ただのミニマックス法で実行した時と同じ結果が得られて尚且つ実行時間が大幅に短縮されるはずです。&lt;br /&gt;
　上のコードで33行目から35行目までをコメントアウトして&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dart mancala.dart&lt;/code&gt;を実行したところ出力結果は同じで、実行時間は２０分と４時間弱の違いがありました。&lt;/p&gt;

&lt;h5 id=&quot;αβ法無し&quot;&gt;αβ法無し&lt;/h5&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ dart mancala.dart
[0, 2, 2, 2, 2, 2, 2, 0, 2, 2, 2, 2, 2, 2]
=== result = 1, 6, i = 1
=== result = 4, 5, i = 2
=== result = 3, 5, i = 3
=== result = 2, 5, i = 4
=== result = 4, 5, i = 5
=== result = 5, 5, i = 6
=== result = 4, 5, i = 7
=== result = 5, 5, i = 8
=== result = 5, 5, i = 9
=== result = 4, 5, i = 10
=== result = 5, 6, i = 11
=== result = 5, 6, i = 12
=== result = 5, 5, i = 13
=== result = 5, 5, i = 14
=== result = 7, 5, i = 15
=== result = 12, 5, i = 16
=== result = 999, 5, i = 17
14208572
[999, 5]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h5 id=&quot;αβ法有り&quot;&gt;αβ法有り&lt;/h5&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ dart mancala.dart
[0, 2, 2, 2, 2, 2, 2, 0, 2, 2, 2, 2, 2, 2]
=== result = 1, 6, i = 1
=== result = 4, 5, i = 2
=== result = 3, 5, i = 3
=== result = 2, 5, i = 4
=== result = 4, 5, i = 5
=== result = 5, 5, i = 6
=== result = 4, 5, i = 7
=== result = 5, 5, i = 8
=== result = 5, 5, i = 9
=== result = 4, 5, i = 10
=== result = 5, 6, i = 11
=== result = 5, 6, i = 12
=== result = 5, 5, i = 13
=== result = 5, 5, i = 14
=== result = 7, 5, i = 15
=== result = 12, 5, i = 16
=== result = 999, 5, i = 17
1276771
[999, 5]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;先手必勝か後手必勝かだけを確認したい場合&quot;&gt;先手必勝か後手必勝かだけを確認したい場合&lt;/h3&gt;
&lt;p&gt;　前述しましたが、最善手に拘らずに先手必勝なのか、後手必勝なのかだけを調べたい場合は、同じ階層での評価値の比較の際に、１個差の負けでも大差の負けでも同じと考えて、先手勝ちあるいは後手勝ちの結論が出た段階ですぐに呼び出し元にReturnすればいいだけです。例えば以下のコードを32行目と33行目の間に入れれば、&lt;strong&gt;指定された読みの深さ内で&lt;/strong&gt;先手勝ちあるいは後手勝ちの結論が出たことになるので、そこで探索を打ち切り呼び出し元にリターンすれば探索時間を大幅に短縮できます。&lt;br /&gt;
　ただこの時に使用する静的評価関数は単に&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;(先手のストア内の豆の数 - 後手のストア内の豆の数)&lt;/code&gt;とするだけではなく、ゲームが終了しているかどうかを確認して先手勝ち（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FIRST_WIN&lt;/code&gt;）、後手勝ち（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SECOND_WIN&lt;/code&gt;）の特別な値を返すようにしておく必要があります。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;      if ((score &amp;gt;= FIRST_WIN &amp;amp;&amp;amp; this.turn == FIRST)||(score &amp;lt;= SECOND_WIN &amp;amp;&amp;amp; this.turn == SECOND)) {
        lastscore = score;
        lastposi = i;
        break;
      }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;　上記のコードを追加した後、豆２個のケースで試したら、自分の環境では約半分近くの時間で先手必勝を読み切れました。&lt;/p&gt;

&lt;div&gt;
    &lt;script async=&quot;&quot; src=&quot;https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js&quot;&gt;&lt;/script&gt;
    &lt;!-- display01 --&gt;
    &lt;ins class=&quot;adsbygoogle&quot; style=&quot;display:block&quot; data-ad-client=&quot;ca-pub-9018029357773039&quot; data-ad-slot=&quot;3925247388&quot; data-ad-format=&quot;auto&quot; data-full-width-responsive=&quot;true&quot;&gt;&lt;/ins&gt;
    &lt;script&gt;
    (adsbygoogle = window.adsbygoogle || []).push({});
    &lt;/script&gt;
&lt;/div&gt;

&lt;hr /&gt;

</description>
        <pubDate>Sat, 18 Nov 2023 00:00:00 +0900</pubDate>
        <link>https://happyclam.github.io/software/2023-11-18/abmethod_skipped</link>
        <guid isPermaLink="true">https://happyclam.github.io/software/2023-11-18/abmethod_skipped</guid>
        
        <category>dart</category>
        
        <category>flutter</category>
        
        <category>mancala</category>
        
        
        <category>software</category>
        
      </item>
    
      <item>
        <title>カラハ問題、根強い人気？</title>
        <description>&lt;h3 id=&quot;先手必勝aiと自作aiとのマンカラ対戦&quot;&gt;先手必勝AIと自作AIとのマンカラ対戦&lt;/h3&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/ovR4V5R6Lt0?si=fhltwApvJmgzRyKO&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;
&lt;/div&gt;

&lt;h3 id=&quot;ブログ内トップの関心事&quot;&gt;ブログ内トップの関心事&lt;/h3&gt;
&lt;p&gt;　以前&lt;a href=&quot;/software/2020-06-07/mancala&quot;&gt;「マンカラは先手必勝？後手必勝？」&lt;/a&gt;という記事を書いてからは、当ブログに流入してくる検索ワードはずっとマンカラに関するものが一番多いです。「マンカラ 完全解析」とか「マンカラ 先手必勝」とかで検索すると未だに&lt;a href=&quot;/software/2020-06-07/mancala&quot;&gt;前述の記事&lt;/a&gt;が検索上位に表示されます。&lt;br /&gt;
　ブログもアプリも永らく放置していたのですが、googleに&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;アプリ&lt;/a&gt;の更新を催促されたのを機会に、久しぶりにマンカラに関して試したことを記事に書いてみようと思います。&lt;/p&gt;

&lt;h3 id=&quot;マンカラのノード数は&quot;&gt;マンカラのノード数は？&lt;/h3&gt;
&lt;p&gt;　マンカラの全ノードをメモリーに持つことが出来れば、&lt;a href=&quot;/software/2019-07-19/self-play&quot;&gt;以前の記事&lt;/a&gt;で三目並べでやったようにモンテカルロ法を使って先手必勝か後手必勝が証明できるし、全ノードを保持出来なくても工夫すれば序盤の定石データの作成等何か出来るかもと思いノード数を数えてみることにしました。&lt;br /&gt;
　やったことは以前&lt;a href=&quot;/software/2018-08-18/puzzle&quot;&gt;「BFSで将棋パズルを解く」&lt;/a&gt;に書いたのと同じ方法です。全ての指し手を一手ずつ進めて重複局面を省きながらゲーム木を作る方法なので概算ではなく正確なノード数が求まるはずです。&lt;br /&gt;
　プログラムは&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Dart&lt;/code&gt;で作ったのですが、まずは豆１つのケースで試したら数秒でノード数は1,182,341ノード（重複局面削除済み）と判明しましたが、豆２つでやってみると一日待って&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Out of Memory&lt;/code&gt;が出てプログラムが終了してしまいました:cold_sweat:&lt;br /&gt;
　おかしいなと思い&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;psensor&lt;/code&gt;でメモリー使用状況を確認したのが以下の画像です。&lt;/p&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/dart_memory.png&quot;&gt;&lt;img src=&quot;https://happyclam.github.io/images/dart_memory.png&quot; alt=&quot;Dartメモリ使用状況&quot; width=&quot;480&quot; height=&quot;289&quot; title=&quot;Dartメモリ使用状況&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;　&lt;a href=&quot;/software/2020-06-07/mancala&quot;&gt;以前の記事「マンカラは先手必勝？後手必勝？」&lt;/a&gt;を書いたときよりPCはハイスペックになっていて、今は128GBのメモリを積んでいるのですが、理由は分かりませんが、どうやら&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Dart&lt;/code&gt;では64GB以上のメモリーを使ってくれないようです:cold_sweat:ガベージコレクションが関係しているのでしょうか？兎に角こういうことをやるのには&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Dart&lt;/code&gt;(Version3.1.2)は向いてませんね。仕方なく&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C++&lt;/code&gt;で書き直して試してみると、&lt;/p&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/cplus_memory.png&quot;&gt;&lt;img src=&quot;https://happyclam.github.io/images/cplus_memory.png&quot; alt=&quot;C++メモリ使用状況&quot; width=&quot;480&quot; height=&quot;289&quot; title=&quot;C++メモリ使用状況&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;　それでも１５分ほどで搭載されているメモリーすべて使い切って、重複局面は排除したのですがノード数を数え切れませんでした:cold_sweat:&lt;br /&gt;
　マンカラの完全解析は意外と手強いです。作成したNodeクラスは後にプログラムで使用するつもりの余計な要素も含まれているのですが、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sizeof&lt;/code&gt;で確認すると１つのNodeオブジェクトは88バイトだったので、128GBで足りないとなると&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;128GB / 88B&lt;/code&gt;で15億ノード以上あるということでしょうか？しかも豆２つでこの状況ですから三目並べと同様のアプローチは無理ですね:sweat_smile:&lt;/p&gt;

&lt;h3 id=&quot;chatgptに聞いてみる&quot;&gt;ChatGPTに聞いてみる&lt;/h3&gt;
&lt;p&gt;　無料版のChatGPT(GPT3.5)に「マンカラカラハは先手必勝のゲームと証明されていますか？」と聞いてみたところ以下の回答でした。&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;マンカラ（またはカラハ）が「先手必勝」であるという一般的な証拠や公式な証明は存在しません。このゲームは非常に複雑で、初期配置やプレイヤーのスキルに依存するため、先手と後手の優劣は局面や戦術によって変化します。&lt;/p&gt;

  &lt;p&gt;マンカラは多くのバリエーションが存在し、さまざまなルールでプレイされることもあるため、先手必勝かどうかについて一般的な結論を出すことは難しいです。一部のバリエーションでは、特定の初期配置や戦術によって先手が有利になることがあるかもしれませんが、一般的なルールでのマンカラは均衡のゲームとされており、どちらが優勢であるかは状況に依存します。&lt;/p&gt;

  &lt;p&gt;したがって、特定の局面やルールにおいて先手必勝であるかどうかを証明するには、数学的な証拠や研究が必要です。一般的なマンカラゲームが先手必勝であるかどうかについての確かな証拠は提供されていないと言えます。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;　他にもいろいろ試しましたが、ChatGPTでは明確な回答は得られませんでした。&lt;/p&gt;

&lt;h3 id=&quot;wikipediaによると解決済みらしい&quot;&gt;Wikipediaによると解決済みらしい&lt;/h3&gt;
&lt;p&gt;　ネットを検索すると&lt;a href=&quot;https://en.wikipedia.org/wiki/Kalah&quot;&gt;Wikipediaのこの記事&lt;/a&gt;で先手必勝が確認されていると出てくるのですが、&lt;a href=&quot;https://en.wikipedia.org/wiki/Kalah&quot;&gt;この記事&lt;/a&gt;がどういう理屈で先手必勝を証明しているのか自分にはよく理解できません:sweat_smile:&lt;br /&gt;
　そこで&lt;a href=&quot;https://en.wikipedia.org/wiki/Kalah&quot;&gt;同じ記事&lt;/a&gt;内の下の方に用意してある&lt;a href=&quot;http://kalaha.krus.dk/&quot;&gt;Webゲーム&lt;/a&gt;と&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;自分のアプリ&lt;/a&gt;を対戦させてみました。「先手必勝の理屈が分からない奴は&lt;a href=&quot;http://kalaha.krus.dk/&quot;&gt;このWebゲーム&lt;/a&gt;に後手で勝ってみろ！出来ないだろ？だから先手必勝の結論に間違いないんだよ！」という理屈のようです:sweat_smile:&lt;a href=&quot;http://kalaha.krus.dk/&quot;&gt;このゲーム&lt;/a&gt;の作者の意図はそういうものではないかもしれませんが、自分はそのように解釈しました:sweat_smile:&lt;br /&gt;
　&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;自分のアプリ&lt;/a&gt;も豆６個に対応しているので、&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;自分のアプリ&lt;/a&gt;が後手で勝ったらおもしろいなぁなんて思いながら対戦させてみました。&lt;br /&gt;
　結果は&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;自分のアプリ&lt;/a&gt;の負けでした、残念:sweat_smile:&lt;/p&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/6x6karah_game01.png&quot;&gt;&lt;img src=&quot;https://happyclam.github.io/images/6x6karah_game01.png&quot; alt=&quot;対先手必勝AI&quot; width=&quot;480&quot; height=&quot;234&quot; title=&quot;対先手必勝AI&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;　&lt;a href=&quot;http://kalaha.krus.dk/&quot;&gt;このゲーム&lt;/a&gt;で遊ぶときは左下の&lt;button type=&quot;button&quot;&gt;Change Rules&lt;/button&gt;のボタンをクリックして、以下のようにチェックマークをOnにしないと同じルールにならない（Capture=横取りの動作が異なります）ので注意が必要です。Nintendo Switch『世界のアソビ大全51』のマンカラソフトもこれと同じルールです。&lt;/p&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/6x6karah_game02.png&quot;&gt;&lt;img src=&quot;https://happyclam.github.io/images/6x6karah_game02.png&quot; alt=&quot;先手必勝AIの設定&quot; width=&quot;480&quot; height=&quot;92&quot; title=&quot;先手必勝AIの設定&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;　
　次に、&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;アプリ&lt;/a&gt;では最強に設定しても１１手読みなので１５手読みに設定してPCで試してみたのが冒頭の動画です。&lt;/p&gt;

&lt;div style=&quot;width:480px; margin: 0 auto;&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;/images/6x6karah_game03.png&quot;&gt;&lt;img src=&quot;https://happyclam.github.io/images/6x6karah_game03.png&quot; alt=&quot;対先手必勝ゲーム-15手読み&quot; width=&quot;480&quot; height=&quot;230&quot; title=&quot;対先手必勝AI-15手読み&quot; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;　１５手読みにするとRyzen7 5700Gでも一手５分ぐらい掛かるのですが、それでもやはり勝てません。あと一個で引き分けという惜敗ですが、試しに自分の頭で考えてやってみるとゲームの最後までプレイ出来ずに途中で大差で負けます:sweat_smile:&lt;br /&gt;
&lt;a href=&quot;http://kalaha.krus.dk/&quot;&gt;このWebゲーム&lt;/a&gt;は豆６個しか試せないようですが、&lt;a href=&quot;https://en.wikipedia.org/wiki/Kalah&quot;&gt;Wikipedia&lt;/a&gt;に書いてある通り３個、４個、５個でもすべて先手必勝は間違いなさそうですね。&lt;/p&gt;

&lt;h3 id=&quot;追記2023-11-10&quot;&gt;追記（2023-11-10）&lt;/h3&gt;
&lt;p&gt;　ノード数を数える時に手番データを含めて重複局面を保存しないようにしていたのですが、手番データを含めずにノード数をカウントしたところ、豆２個でもカウント完了出来ました。先手番の局面か後手番の局面かを気にせずに豆の配置の違いだけを数えれば大幅にノード数は減りますが、データとしては使いにくいのであまり意味はありませんけど一応記しておきます。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;豆１個のケース-&amp;gt;647,826ノード&lt;/li&gt;
  &lt;li&gt;豆２個のケース-&amp;gt;495,196,185ノード&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;　豆の配置は同じだけど手番が違う局面というのがかなり存在するということみたいです。&lt;/p&gt;

&lt;div&gt;
    &lt;script async=&quot;&quot; src=&quot;https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js&quot;&gt;&lt;/script&gt;
    &lt;!-- display01 --&gt;
    &lt;ins class=&quot;adsbygoogle&quot; style=&quot;display:block&quot; data-ad-client=&quot;ca-pub-9018029357773039&quot; data-ad-slot=&quot;3925247388&quot; data-ad-format=&quot;auto&quot; data-full-width-responsive=&quot;true&quot;&gt;&lt;/ins&gt;
    &lt;script&gt;
    (adsbygoogle = window.adsbygoogle || []).push({});
    &lt;/script&gt;
&lt;/div&gt;

&lt;hr /&gt;

</description>
        <pubDate>Tue, 07 Nov 2023 00:00:00 +0900</pubDate>
        <link>https://happyclam.github.io/software/2023-11-07/karah_problem</link>
        <guid isPermaLink="true">https://happyclam.github.io/software/2023-11-07/karah_problem</guid>
        
        <category>dart</category>
        
        <category>android</category>
        
        <category>flutter</category>
        
        <category>c++</category>
        
        <category>mancala</category>
        
        
        <category>software</category>
        
      </item>
    
      <item>
        <title>lishogi(Minishogi)に挑戦</title>
        <description>&lt;h3 id=&quot;lishogiと５五将棋アプリを対戦させてみた&quot;&gt;&lt;a href=&quot;https://lishogi.org&quot;&gt;lishogi&lt;/a&gt;と&lt;a href=&quot;https://play.google.com/store/apps/details?id=shogi55.io.github.happyclam&quot;&gt;５五将棋アプリ&lt;/a&gt;を対戦させてみた&lt;/h3&gt;
&lt;p&gt;　&lt;a href=&quot;https://lishogi.org&quot;&gt;lishogi&lt;/a&gt;に５五将棋（Minishogi）が実装されたようです。ちょうど&lt;a href=&quot;http://happyclam.github.io/project/2020-01-02/minishogi&quot;&gt;２年前の記事&lt;/a&gt;で&lt;a href=&quot;http://hgm.nubati.net/miniShogi.html&quot;&gt;GNU mini-shogi&lt;/a&gt;のサイトで公開されているフリーソフトのPC用５五将棋エンジンと&lt;a href=&quot;https://play.google.com/store/apps/details?id=shogi55.io.github.happyclam&quot;&gt;５五将棋アプリ&lt;/a&gt;と対戦させて、アプリが勝てなかったことを書きました。&lt;a href=&quot;https://play.google.com/store/apps/details?id=shogi55.io.github.happyclam&quot;&gt;５五将棋アプリ&lt;/a&gt;のAI部分は２年前と同じですので、普通に考えれば前回同様アプリの惨敗になることが予想されますが、どうなったでしょうか&lt;/p&gt;

&lt;h3 id=&quot;スマホのハードウェア進化に期待&quot;&gt;スマホのハードウェア進化に期待&lt;/h3&gt;
&lt;p&gt;　&lt;a href=&quot;http://hgm.nubati.net/miniShogi.html&quot;&gt;GNU mini-shogi&lt;/a&gt;で公開されているフリーのPCエンジンは１対１の対戦用なので一手に数十秒使っていましたが、&lt;a href=&quot;https://lishogi.org&quot;&gt;lishogi&lt;/a&gt;は複数人が利用するWebアプリなので一人に多くのリソースを割けません、そこに勝機があるかもと思いました。&lt;br /&gt;
　また、&lt;a href=&quot;https://play.google.com/store/apps/details?id=shogi55.io.github.happyclam&quot;&gt;５五将棋アプリ&lt;/a&gt;側もスマホの性能が上がったので、アプリを最強レベルに設定して何とか使える状態になってきました。&lt;a href=&quot;https://play.google.com/store/apps/details?id=shogi55.io.github.happyclam&quot;&gt;５五将棋アプリ&lt;/a&gt;を既にお使いの方はご存知だと思いますが、AIを最強レベルに設定すると一手に時間がかかり過ぎるので、作った本人が言うのもなんですが、とてもAIの指し手を待ってられませんでした。自分も今まではスマホで最強レベルではほとんど使っていません。PC上でCUI環境でテストするか、PC上でエミュレータを使って遊んでいました。&lt;br /&gt;
　でも最近自分もスマホの機種変更（Xperia 10 Ⅲ、RAM6GB）をして、これなら最強レベル（瞑想モード）でも何とか使えるなと感じたので試してみることにしました。&lt;/p&gt;

&lt;h3 id=&quot;まずは最強レベルで試してみる&quot;&gt;まずは最強レベルで試してみる&lt;/h3&gt;
&lt;p&gt;　流石に最強レベルには勝てないだろうと思いながらも、まずは最強モード（YaneuraOu V6.00 レベル８）で、先手と後手一局ずつ手動で対戦してみました。持ち時間設定は最長にしました。&lt;/p&gt;

&lt;p&gt;　※以下はアプリから出力した棋譜（CSA形式）です。&lt;a href=&quot;https://play.google.com/store/apps/details?id=shogi55.io.github.happyclam&quot;&gt;５五将棋アプリ&lt;/a&gt;にコピペすれば棋譜を再現出来ます。&lt;/p&gt;

&lt;div class=&quot;cp_actab&quot;&gt;
    &lt;input id=&quot;kifu01&quot; type=&quot;radio&quot; name=&quot;kifu&quot; /&gt;
    &lt;label for=&quot;kifu01&quot;&gt;01. 先手:アプリ　後手:lishogi　４０手まで後手の勝ち&lt;/label&gt;
    &lt;div class=&quot;cp_actab-content&quot;&gt;
    &lt;p&gt;
        &lt;pre&gt;&lt;code&gt;&apos; #５五将棋 https://play.google.com/store/apps/details?id=shogi55.io.github.happyclam 
&apos;No. 0
&apos;
V2.2
N+AI
N-Player
P1-HI-KA-GI-KI-OU
P2 *  *  *  * -FU
P3 *  *  *  *  * 
P4+FU *  *  *  * 
P5+OU+KI+GI+KA+HI
+
+4544KI
-4132KA
+5453FU
-5141HI
+4433KI
-2122KI
+3332KI
-3132GI
+0054KA
-2233KI
+1514HI
-0043KI
+5445KA
-3323KI
+4523KA
-3223GI
+2543KA
-0022KA
+5554OU
-2314GI
+0044KI
-4143HI
+5443OU
-0021KA
+0032KI
-0041HI
+0042HI
-2132KA
+4332OU
-0031KI
+3243OU
-3142KI
+4354OU
-4243KI
+5445OU
-4344KI
+3544GI
-4144HI
+4535OU
-0045HI
        &lt;/code&gt;&lt;/pre&gt;
    &lt;/p&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;cp_actab&quot;&gt;
    &lt;input id=&quot;kifu02&quot; type=&quot;radio&quot; name=&quot;kifu&quot; /&gt;
    &lt;label for=&quot;kifu02&quot;&gt;02. 先手:lishogi　後手:アプリ　１９手まで先手勝ち&lt;/label&gt;
    &lt;div class=&quot;cp_actab-content&quot;&gt;
    &lt;p&gt;
        &lt;pre&gt;&lt;code&gt;&apos; #５五将棋 https://play.google.com/store/apps/details?id=shogi55.io.github.happyclam 
&apos;No. 0
&apos;
V2.2
N+Player
N-AI
P1-HI-KA-GI-KI-OU
P2 *  *  *  * -FU
P3 *  *  *  *  * 
P4+FU *  *  *  * 
P5+OU+KI+GI+KA+HI
-
+4544KI
-4132KA
+2534KA
-3142GI
+3445KA
-2122KI
+1525HI
-4243GI
+2522HI
-4344GI
+3544GI
-1122OU
+0033GI
-2231OU
+0042KI
-3121OU
+4232KI
-2111OU
+3322GI
        &lt;/code&gt;&lt;/pre&gt;
    &lt;/p&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;　結果は２局とも&lt;a href=&quot;https://play.google.com/store/apps/details?id=shogi55.io.github.happyclam&quot;&gt;５五将棋アプリ&lt;/a&gt;の完敗でした。とても勝てそうな気がしなかったので、今度はlishogiのレベルを下げてレベル５で先手と後手３局ずつ計６局対戦させてみました。&lt;/p&gt;

&lt;h3 id=&quot;lishogiをレベル５に下げて６局対戦&quot;&gt;lishogiをレベル５に下げて６局対戦&lt;/h3&gt;

&lt;div class=&quot;cp_actab&quot;&gt;
    &lt;input id=&quot;kifu03&quot; type=&quot;radio&quot; name=&quot;kifu&quot; /&gt;
    &lt;label for=&quot;kifu03&quot;&gt;03. 先手:lishogi　後手:アプリ　３０手まで後手勝ち&lt;/label&gt;
    &lt;div class=&quot;cp_actab-content&quot;&gt;
    &lt;p&gt;
        &lt;pre&gt;&lt;code&gt;&apos; #５五将棋 https://play.google.com/store/apps/details?id=shogi55.io.github.happyclam 
&apos;No. 0
&apos;
V2.2
N+Player
N-AI
P1-HI-KA-GI-KI-OU
P2 *  *  *  * -FU
P3 *  *  *  *  * 
P4+FU *  *  *  * 
P5+OU+KI+GI+KA+HI
+
+4544KI
-4132KA
+2534KA
-3142GI
+5545OU
-5131HI
+1525HI
-3241KA
+3524GI
-3134HI
+4434KI
-2122KI
+2535HI
-4114KA
+0052HI
-2232KI
+3515HI
-0025KA
+2435GI
-3243KI
+1525HI
-1425UM
+0055KA
-0033HI
+3433KI
-4333KI
+5242HI
-0034KI
+3534GI
-2534UM
        &lt;/code&gt;&lt;/pre&gt;
    &lt;/p&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;div class=&quot;cp_actab&quot;&gt;
    &lt;input id=&quot;kifu04&quot; type=&quot;radio&quot; name=&quot;kifu&quot; /&gt;
    &lt;label for=&quot;kifu04&quot;&gt;04. 先手:lishogi　後手:アプリ　２６手まで後手勝ち&lt;/label&gt;
    &lt;div class=&quot;cp_actab-content&quot;&gt;
    &lt;p&gt;
        &lt;pre&gt;&lt;code&gt;&apos; #５五将棋 https://play.google.com/store/apps/details?id=shogi55.io.github.happyclam 
&apos;No. 0
&apos;
V2.2
N+Player
N-AI
P1-HI-KA-GI-KI-OU
P2 *  *  *  * -FU
P3 *  *  *  *  * 
P4+FU *  *  *  * 
P5+OU+KI+GI+KA+HI
+
+4544KI
-4132KA
+2534KA
-3142GI
+3425KA
-2122KI
+3524GI
-5131HI
+4445KI
-3241KA
+4534KI
-4152KA
+3423KI
-2223KI
+2552KA
-2324KI
+0044KA
-0033GI
+1545HI
-3344GI
+4544HI
-3135RY
+0045GI
-0022KA
+5243KA
-2244KA
        &lt;/code&gt;&lt;/pre&gt;
    &lt;/p&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;div class=&quot;cp_actab&quot;&gt;
    &lt;input id=&quot;kifu05&quot; type=&quot;radio&quot; name=&quot;kifu&quot; /&gt;
    &lt;label for=&quot;kifu05&quot;&gt;05. 先手:lishogi　後手:アプリ　２０手まで後手勝ち&lt;/label&gt;
    &lt;div class=&quot;cp_actab-content&quot;&gt;
    &lt;p&gt;
        &lt;pre&gt;&lt;code&gt;&apos; #５五将棋 https://play.google.com/store/apps/details?id=shogi55.io.github.happyclam 
&apos;No. 0
&apos;
V2.2
N+Player
N-AI
P1-HI-KA-GI-KI-OU
P2 *  *  *  * -FU
P3 *  *  *  *  * 
P4+FU *  *  *  * 
P5+OU+KI+GI+KA+HI
+
+2534KA
-4132KA
+1525HI
-5141HI
+2524HI
-2122KI
+5453FU
-2233KI
+4554KI
-3254KA
+3412KA
-3324KI
+5554OU
-0043KI
+5455OU
-0054HI
+5545OU
-5444HI
+3544GI
-4344KI
        &lt;/code&gt;&lt;/pre&gt;
    &lt;/p&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;div class=&quot;cp_actab&quot;&gt;
    &lt;input id=&quot;kifu06&quot; type=&quot;radio&quot; name=&quot;kifu&quot; /&gt;
    &lt;label for=&quot;kifu06&quot;&gt;06. 先手:アプリ　後手:lishogi　４６手まで後手勝ち&lt;/label&gt;
    &lt;div class=&quot;cp_actab-content&quot;&gt;
    &lt;p&gt;
        &lt;pre&gt;&lt;code&gt;&apos; #５五将棋 https://play.google.com/store/apps/details?id=shogi55.io.github.happyclam 
&apos;No. 0
&apos;
V2.2
N+AI
N-Player
P1-HI-KA-GI-KI-OU
P2 *  *  *  * -FU
P3 *  *  *  *  * 
P4+FU *  *  *  * 
P5+OU+KI+GI+KA+HI
+
+4544KI
-2122KI
+5453FU
-1213FU
+2534KA
-3142GI
+1525HI
-4253GI
+4453KI
-5153HI
+0054GI
-5352HI
+3452KA
-4152KA
+0051HI
-0041KA
+3534GI
-0031KI
+5443GI
-5243KA
+3443GI
-0033GI
+0015KA
-0024FU
+2535HI
-1121OU
+5545OU
-4123KA
+4555OU
-2332KA
+4332GI
-2232KI
+3533HI
-3233KI
+0054KA
-0043GI
+0012GI
-2112OU
+5445KA
-1222OU
+5131RY
-2231OU
+0035KI
-0044GI
+3544KI
-3344KI
        &lt;/code&gt;&lt;/pre&gt;
    &lt;/p&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;div class=&quot;cp_actab&quot;&gt;
    &lt;input id=&quot;kifu07&quot; type=&quot;radio&quot; name=&quot;kifu&quot; /&gt;
    &lt;label for=&quot;kifu07&quot;&gt;07. 先手:アプリ　後手:lishogi　５５手まで先手勝ち&lt;/label&gt;
    &lt;div class=&quot;cp_actab-content&quot;&gt;
    &lt;p&gt;
        &lt;pre&gt;&lt;code&gt;&apos; #５五将棋 https://play.google.com/store/apps/details?id=shogi55.io.github.happyclam 
&apos;No. 0
&apos;
V2.2
N+AI
N-Player
P1-HI-KA-GI-KI-OU
P2 *  *  *  * -FU
P3 *  *  *  *  * 
P4+FU *  *  *  * 
P5+OU+KI+GI+KA+HI
-
+4544KI
-2122KI
+5453FU
-1213FU
+2534KA
-3142GI
+1525HI
-4253GI
+4453KI
-5153HI
+0054GI
-5352HI
+3452KA
-4152KA
+0051HI
-0041KA
+3534GI
-0031KI
+5443GI
-5243KA
+3443GI
-0042FU
+2522HI
-0044GI
+5544OU
-4243FU
+4443OU
-3122KI
+5141HI
-0021HI
+0012FU
-1112OU
+0034KA
-0023FU
+0031KI
-0032GI
+3132KI
-2141HI
+3241KI
-0033HI
+4344OU
-3334HI
+4434OU
-0052KA
+3445OU
-2232KI
+0044KA
-3222KI
+0032HI
-5234KA
+4534OU
-1221OU
+3231HI
-2112OU
+0011HI
        &lt;/code&gt;&lt;/pre&gt;
    &lt;/p&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;div class=&quot;cp_actab&quot;&gt;
    &lt;input id=&quot;kifu08&quot; type=&quot;radio&quot; name=&quot;kifu&quot; /&gt;
    &lt;label for=&quot;kifu08&quot;&gt;08. 先手:アプリ　後手:lishogi　７３手まで先手勝ち&lt;/label&gt;
    &lt;div class=&quot;cp_actab-content&quot;&gt;
    &lt;p&gt;
        &lt;pre style=&quot;font-size: 80%;&quot;&gt;&lt;code&gt;&apos; #５五将棋 https://play.google.com/store/apps/details?id=shogi55.io.github.happyclam 
&apos;No. 0
&apos;
V2.2
N+AI
N-Player
P1-HI-KA-GI-KI-OU
P2 *  *  *  * -FU
P3 *  *  *  *  * 
P4+FU *  *  *  * 
P5+OU+KI+GI+KA+HI
-
+4544KI
-2122KI
+5453FU
-1213FU
+2534KA
-3142GI
+1525HI
-4253GI
+4453KI
-5153HI
+0054GI
-5352HI
+3452KA
-4152KA
+0051HI
-0041KI
+5152HI
-0033KA
+0044KA
-3344KA
+3544GI
-4152KI
+0031KA
-0032HI
+3122KA
-3222HI
+0023KI
-0021FU
+2322KI
-2122FU
+0041HI
-0021KI
+4433GI
-0031KA
+2515HI
-0014KA
+1514HI
-1314FU
+4145RY
-0015HI
+0025KA
-3142KA
+3342GI
-5242KI
+0024KA
-0033GI
+2415KA
-1415TO
+0013HI
-0012KA
+1315HI
-2132KI
+1514HI
-3223KI
+1412HI
-1112OU
+0013FU
-1211OU
+4542RY
-0035HI
+0045KA
-3545RY
+5445GI
-0021KA
+0031HI
-2313KI
+3133RY
-0054FU
+4554GI
-1323KI
+3323RY
-2112KA
+2322RY
        &lt;/code&gt;&lt;/pre&gt;
    &lt;/p&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;　結果はアプリの５勝１敗でレベル５なら勝てそうですが、lishogiは序盤の指し手を結構変えてくるので、余裕かましてる感じがありますね。&lt;/p&gt;

&lt;h3 id=&quot;lishogiのレベルは何が基準なのか&quot;&gt;lishogiのレベルは何が基準なのか&lt;/h3&gt;
&lt;p&gt;　&lt;a href=&quot;https://play.google.com/store/apps/details?id=shogi55.io.github.happyclam&quot;&gt;５五将棋アプリ&lt;/a&gt;のAIレベルの違いは、主に読みの深さ（３手〜５手読み）の違いだけで、瞑想モードだけは絞り込む候補手の数を多めにしています。また、同じ局面ではほとんど同じ手を選びます（評価値が同じ場合はランダム選択にしてますが、同じ評価値になる時はあまり無いと思います）が、lishogiは結構指し手を変えてくるようです。lishogiは機械学習型のAIだと思うので、レベルの違いはどうやっているのでしょう？&lt;br /&gt;
　もしかしてレベルが高いと第１候補手、低いと第２、第３と下げているのかなとか考えましたが、それだとこの局面ではこの一手という絶対手が存在するときに困ります。第１候補手以外は自玉が詰んでしまうような局面だと、低いレベルでも第１候補手を選ばないとすぐに負けてしまうからです。おそらく&lt;a href=&quot;http://yaneuraou.yaneu.com/2020/12/20/deep-learning-shogi-features/&quot;&gt;この記事（「Deep Learning将棋は従来の将棋ソフトとここが違うぞ」）&lt;/a&gt;に書いてあるような方法で、特に評価値に大きな違いがある局面ではCPUを使った先読みの結果を優先して、それ以外の通常の指し手はGPUを使った候補手を選択しているような気がしますが、あくまで想像です。&lt;/p&gt;

&lt;h3 id=&quot;５五将棋アプリの今後&quot;&gt;&lt;a href=&quot;https://play.google.com/store/apps/details?id=shogi55.io.github.happyclam&quot;&gt;５五将棋アプリ&lt;/a&gt;の今後&lt;/h3&gt;
&lt;p&gt;　&lt;a href=&quot;/programming/2021-08-21/nodejs&quot;&gt;以前の記事&lt;/a&gt;でネットワーク対戦機能を付けるみたいなことを書きましたが、lishogiでスマホを使った５五将棋のネットワーク対戦が出来るようなのでニーズは減った気がするし、やはり運用が大変そうなので後回しにしようかと思ってます。&lt;br /&gt;
　それより今回の対戦で&lt;a href=&quot;https://play.google.com/store/apps/details?id=shogi55.io.github.happyclam&quot;&gt;５五将棋アプリ&lt;/a&gt;の評価関数の出来自体はそこそこ良いんじゃないかなんて思ってまして、&lt;a href=&quot;https://play.google.com/store/apps/details?id=shogi55.io.github.happyclam&quot;&gt;５五将棋アプリ&lt;/a&gt;のAI部分をC++で作り直してもっと深く読めるようにして再度対戦させてみたいと思ってます。でもそうすると、AI部分はそれほどでもないのですが、今のJavascript製のGUI部分を一から作る必要がある？ので、その作業量が大きいのでなかなか手をつける気になりません。&lt;a href=&quot;https://play.google.com/store/apps/details?id=shogi55.io.github.happyclam&quot;&gt;５五将棋アプリ&lt;/a&gt;を使っていただいている方は、気長にお待ち頂きたいと思います。&lt;br /&gt;
　あと、&lt;a href=&quot;https://play.google.com/store/apps/details?id=shogi55.io.github.happyclam&quot;&gt;５五将棋アプリ&lt;/a&gt;は遅過ぎて使えないと思っていた方もスマホをハイスペックなものに変える機会があれば、もう一度試して欲しいと思います。&lt;/p&gt;

&lt;p&gt;　それから&lt;a href=&quot;http://hgm.nubati.net/miniShogi.html&quot;&gt;GNU mini-shogiのサイト&lt;/a&gt;でかなり昔から公開されているフリーのPC用の５五将棋エンジンは後発の&lt;a href=&quot;https://lishogi.org&quot;&gt;lishogi&lt;/a&gt;に勝てないのか？も少し気になるのですが、どなたか試す人はいないのでしょうか？lishogiを作った人たちは絶対既に試していると思うので、勝つことは確認済みなのでしょうねぇ。暇な時に一度試してみたいと思ってます。&lt;/p&gt;

&lt;div&gt;
    &lt;script async=&quot;&quot; src=&quot;https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js&quot;&gt;&lt;/script&gt;
    &lt;!-- display01 --&gt;
    &lt;ins class=&quot;adsbygoogle&quot; style=&quot;display:block&quot; data-ad-client=&quot;ca-pub-9018029357773039&quot; data-ad-slot=&quot;3925247388&quot; data-ad-format=&quot;auto&quot; data-full-width-responsive=&quot;true&quot;&gt;&lt;/ins&gt;
    &lt;script&gt;
    (adsbygoogle = window.adsbygoogle || []).push({});
    &lt;/script&gt;
&lt;/div&gt;

&lt;hr /&gt;

</description>
        <pubDate>Sun, 02 Jan 2022 00:00:00 +0900</pubDate>
        <link>https://happyclam.github.io/project/2022-01-02/lishogi</link>
        <guid isPermaLink="true">https://happyclam.github.io/project/2022-01-02/lishogi</guid>
        
        <category>coffeescript</category>
        
        <category>cordova</category>
        
        <category>android</category>
        
        <category>javascript</category>
        
        <category>shogi</category>
        
        
        <category>project</category>
        
      </item>
    
      <item>
        <title>ミニベロは上り坂で有利なのか？</title>
        <description>&lt;h3 id=&quot;ロードバイクで登れるけどミニベロで登れない坂がある&quot;&gt;ロードバイクで登れるけど、ミニベロで登れない坂がある&lt;/h3&gt;
&lt;p&gt;　&lt;a href=&quot;/miscellaneous/2020-05-16/bicycle01&quot;&gt;以前の記事「ロード系ミニベロのカスタマイズ」&lt;/a&gt;が結構読まれているようなので、また自転車ネタを書いてみます。&lt;br /&gt;
　新しく自転車を買ってみようかと思っているのですが、その自転車に求める条件の一つに「近所にある山を登り切りたい」という変な拘りがあります。全国的に有名な急坂とかそういう大層なものではないのですが、&lt;a href=&quot;/miscellaneous/2020-05-16/bicycle01&quot;&gt;以前の記事&lt;/a&gt;で紹介したIDIOM2では登れないけど、今年売っ払ったロードバイクなら登れた坂というのが近所にあって、IDIOM2よりかは上り坂に強い自転車を選びたいと思ってます。&lt;br /&gt;
　そこでフロントシングルでどんなギアが用意されていればいいか考えてみました。&lt;/p&gt;

&lt;h3 id=&quot;ロードとidiom2の比較&quot;&gt;ロードとIDIOM2の比較&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt; &lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;ロード　　&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;　IDIOM2　&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;クランク長&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;165mm&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;165mm&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;フロント&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;50-34T&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;48T&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ギア&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;11-25T&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;12-25T&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;タイヤ&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;23-700&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;28-451&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;　自分が持っている2010年式IDIOM2はロード系と言われるだけあってフロントギアは大きめ（48T）ですがスプロケット（SHIMANO HG50 8S 12-25T）のレンジが狭く、ローギアがロードと同じ25Tで坂には向いていません。&lt;br /&gt;
　一般的にミニベロは上り坂で有利なんて言われたりしますが、車体の重さやクランク長の違いなどの要素もあるものの、ペダルを回す負荷を考えたら結局ギア比で決まると思います。大きな車輪を回すより小さな車輪を回す方が負荷は低くはなりますが、その分を考慮した値で比較すれば700Cも小径車も同じだと思います。700Cと451のタイヤを回す負荷を比較する場合、ギア比を掛けてやれば求められるので&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;タイヤの外径×ギア比&lt;/code&gt;の値を比較すればいいはずです。&lt;br /&gt;
　タイヤの外径をタイヤサイズ表記に使われている&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;700&lt;/code&gt;や&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;451&lt;/code&gt;を使って計算してもいいのですが、700Cのタイヤのビード座直径は実際には700mmではないようですし、同じタイヤサイズでもタイヤの太さによってタイヤの高さ（外径）も変わるのでここではタイヤの外径の代わりに、タイヤ周長を使おうと思います。タイヤ周長は多くのサイクルコンピュータに予め用意されているのでタイヤの太さによる違いなども考慮されているのでより正確だと思います。それと、タイヤ外径とタイヤ周長の違いは定数である円周率（3.14）を掛けただけなので、タイヤ外径の代わりに周長を使っても問題ありません。&lt;/p&gt;

&lt;p&gt;　ここでは&lt;a href=&quot;https://www.cyclabo.com/ja/topics/vnu1m1awr7/&quot;&gt;このサイト&lt;/a&gt;からタイヤ周長の数値を引っ張ってきて、ロードとミニベロのペダルを回す負荷値（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;タイヤ周長×ギア比&lt;/code&gt;）を計算してみました。&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt; &lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;ロード　　&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;　IDIOM2　&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;タイヤサイズ&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;700x23C(ETRTO 23-622)&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;20x1-1/8(ETRTO 28-451)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;トップギア&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2096 * (50 / 11.0) = 9.527m&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1545 * (48 / 12.0) = 6.180m&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ローギア&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2096 * (34 / 25.0) = 2.850m&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;1545 * (48 / 25.0) =  2.966m&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;　IDIOM2の&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2.966m&lt;/code&gt;よりロードの&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2.850m&lt;/code&gt;の方が小さい負荷なのでロードで坂が登れたということだと思ってます。&lt;br /&gt;
　ペダルを回す負荷値なんて書きましたが、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;タイヤ周長×ギア比&lt;/code&gt;というのは結局&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ペダル一漕ぎで進む距離&lt;/code&gt;のことです。&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ペダル一漕ぎで進む距離&lt;/code&gt;が上り坂を克服し易さを表す指標と考えていいと思いますが、あまりそういう話を周りで聞かないので不思議です。もっとこの認識が拡がればいいのにと思ってます。&lt;/p&gt;

&lt;h3 id=&quot;一輪車は上り坂で有利&quot;&gt;一輪車は上り坂で有利？&lt;/h3&gt;
&lt;p&gt;　一輪車には乗ったことはないのですが、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ペダル一漕ぎで進む距離&lt;/code&gt;が小さいほど坂が登り易いのであれば、一輪車は坂を登り易いということになりますが、どうなのでしょう？&lt;a href=&quot;https://www.youtube.com/watch?v=WhFdxguU_dY&quot;&gt;こんな動画&lt;/a&gt;を見つけましたが、斜度も分からないし何とも言えませんがスピードを無視してペダルを回せるかどうかだけを考えれば一輪車は上り坂に強いような気もします。それに一輪車のクランク長は一般的には自転車よりも短いらしいので、スピードのことは考えず登ることだけを考えて長めのクランクを付けたらさらに楽に登れそうです。&lt;br /&gt;
　でも、自転車（二輪車）であれば、やろうと思えばギア比を&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt;以下にすることも出来るので自転車の方が有利であることに間違いないでしょう。&lt;br /&gt;
　それと上で比較したロードとIDIOM2のクランク長は偶々同じサイズですが、クランク長まで考慮しだすと面倒なので購入する自転車を選ぶ際には今のところ無視しています。&lt;/p&gt;

&lt;h3 id=&quot;ペダルを回せるかどうかが大事&quot;&gt;ペダルを回せるかどうかが大事&lt;/h3&gt;
&lt;p&gt;　自転車で坂を登れるかどうかっていうのは第一にペダルを回せるかどうかが大事です。全く疲労していない状態でも急勾配な坂だと、力一杯ペダルを踏み込んでも全く回せないので、こういう状態だとギア比を変えるしかありません。&lt;br /&gt;
　かなり昔のことですが、男６、７人で遠乗りしたことがあって、クロスバイクやロードバイクの人達の中で私だけがミニベロのIDIOM2でした。そして上り坂になった時、私が他のメンバーをグイグイ追い抜いて先頭になって坂の中腹でみんなを待つ状態になったことがあったのですが、「気合い入ってるね」とか「速いね」とか言われたのですが、何の事は無い、自分としてはもっと軽いギアでクルクルペダルを回してゆっくり上りたいのですが、軽いギアが無いために無理やり他の人より重いギアで漕いでいただけのことです。ギア比のことに思い至っていない人だと、上り坂はミニベロが有利なんだと勘違いするかも知れません。&lt;br /&gt;
　この時は、その後山の頂上が近づくにつれて坂が急勾配になっていき、私がペダルが踏めなくなって自転車を押して歩く羽目になったのとは対照的に、軽い高級ロードバイクの人が先頭を走っていました。&lt;/p&gt;

&lt;h3 id=&quot;坂だけを考えたらクロスバイク&quot;&gt;坂だけを考えたらクロスバイク？&lt;/h3&gt;
&lt;p&gt;　冒頭に書いたIDIOM2で登れない坂を克服することを考えながら自転車を物色していると、クロスバイクの方が良さそうな気がしています。購入後にギアだけ変えるのは面倒なので、取り敢えず最初から用意されているギア比を見ているとクロスバイクの方がワイドレンジになっていて坂には有利なようですし、リアキャリアを付けたいのでダボ穴が用意されているクロスバイクになりそうです。&lt;br /&gt;
　購入したらまた記事を書いてみようと思います。&lt;/p&gt;

&lt;div&gt;
    &lt;script async=&quot;&quot; src=&quot;https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js&quot;&gt;&lt;/script&gt;
    &lt;!-- display01 --&gt;
    &lt;ins class=&quot;adsbygoogle&quot; style=&quot;display:block&quot; data-ad-client=&quot;ca-pub-9018029357773039&quot; data-ad-slot=&quot;3925247388&quot; data-ad-format=&quot;auto&quot; data-full-width-responsive=&quot;true&quot;&gt;&lt;/ins&gt;
    &lt;script&gt;
    (adsbygoogle = window.adsbygoogle || []).push({});
    &lt;/script&gt;
&lt;/div&gt;

&lt;hr /&gt;

</description>
        <pubDate>Sun, 05 Dec 2021 00:00:00 +0900</pubDate>
        <link>https://happyclam.github.io/miscellaneous/2021-12-05/minivelo</link>
        <guid isPermaLink="true">https://happyclam.github.io/miscellaneous/2021-12-05/minivelo</guid>
        
        <category>bicycle</category>
        
        
        <category>miscellaneous</category>
        
      </item>
    
      <item>
        <title>M1 Macbook ProのCPU性能</title>
        <description>&lt;h3 id=&quot;macbook12インチでスマホアプリ開発してた人&quot;&gt;Macbook12インチでスマホアプリ開発してた人&lt;/h3&gt;
&lt;p&gt;&lt;span id=&quot;back1&quot;&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;　リリース済みのアプリの多くはCordova製なので、最初はブラウザさえあれば開発出来るものでした。でも途中からアプリにファイル保存機能を付けたり、Firebaseの機能を使い始めるとエミュレータを使った開発が必要になって来て、非力なMacbook12で開発作業をするのは苦行に近いものでした&lt;sup id=&quot;fnref:1&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;。&lt;br /&gt;
　で、ようやく以前から欲しかったMacbookProを購入し、別世界を体感しています。&lt;/p&gt;

&lt;div style=&quot;width:640px; margin: 0 auto;&quot;&gt;
&lt;div style=&quot;float:left; margin: 0px 20px 0px;&quot;&gt;
&lt;a href=&quot;/images/macbook_pro1.png&quot;&gt;&lt;img width=&quot;240&quot; height=&quot;183&quot; src=&quot;https://happyclam.github.io/images/macbook_pro1.png&quot; alt=&quot;Macbook Pro 2021 表&quot; title=&quot;M1 Macbook Pro 14インチ 表&quot; /&gt;&lt;/a&gt;
&lt;/div&gt;
&lt;div&gt;
&lt;a href=&quot;/images/macbook_pro2.png&quot;&gt;&lt;img width=&quot;240&quot; height=&quot;186&quot; src=&quot;https://happyclam.github.io/images/macbook_pro2.png&quot; alt=&quot;Macbook Pro 2021 裏&quot; title=&quot;M1 Macbook Pro 14インチ 裏&quot; /&gt;&lt;/a&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br clear=&quot;all&quot; /&gt;&lt;/p&gt;
&lt;div style=&quot;width:640px; margin: 0 auto;&quot;&gt;
&lt;div style=&quot;float:left; margin: 0px 20px 0px;&quot;&gt;
&lt;a href=&quot;/images/macbook_comp1.png&quot;&gt;&lt;img width=&quot;240&quot; height=&quot;181&quot; src=&quot;https://happyclam.github.io/images/macbook_comp1.png&quot; alt=&quot;Macbook12との比較 上&quot; title=&quot;Macbook12との比較 真上から&quot; /&gt;&lt;/a&gt;
&lt;/div&gt;
&lt;div&gt;
&lt;a href=&quot;/images/macbook_comp2.png&quot;&gt;&lt;img width=&quot;240&quot; height=&quot;126&quot; src=&quot;https://happyclam.github.io/images/macbook_comp2.png&quot; alt=&quot;Macbook12との比較 横&quot; title=&quot;Macbook12との比較 側面&quot; /&gt;&lt;/a&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br clear=&quot;all&quot; /&gt;&lt;/p&gt;

&lt;p&gt;　Macbook12と比較するとかなり大きく、重い（1.6Kg）ので持ち歩く気にはなりません。&lt;/p&gt;

&lt;h3 id=&quot;cpu性能比較１&quot;&gt;CPU性能比較１&lt;/h3&gt;
&lt;p&gt;　&lt;a href=&quot;/software/2020-09-19/js_dart_cpp&quot;&gt;以前の記事&lt;/a&gt;で２×６列のマンカラカラハで先手必勝を読み切るまでに要する時間を３つのプログラミング言語（Dart,TypeScript,C++）で比較しましたが、今回は同じC++のソースを使ってCPUによる比較をしてみたいと思います。Intelの&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Core i7-2600K&lt;/code&gt;とARM系&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Apple M1 Pro&lt;/code&gt;、４コアと１０コア、比較の基準がバラバラですが、単に自分が持っているPCでどれだけ性能が上がったか知りたいだけです。&lt;br /&gt;
　まずは&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Core i7-2600K&lt;/code&gt;（Ubuntu機）側から。&lt;a href=&quot;/software/2020-09-19/js_dart_cpp&quot;&gt;前回の記事&lt;/a&gt;と出力内容が違うのは、&lt;a href=&quot;/software/2020-09-19/js_dart_cpp&quot;&gt;前回の記事&lt;/a&gt;にも書いた通りバグがあったためです。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ./mancala.out
0,2,2,2,2,2,2,0,2,2,2,2,2,2,
=== result = 4, 5, i = 1
=== result = 3, 5, i = 2
=== result = 1, 6, i = 3
=== result = 3, 5, i = 4
=== result = 5, 5, i = 5
=== result = 4, 5, i = 6
=== result = 5, 5, i = 7
=== result = 4, 5, i = 8
=== result = 4, 5, i = 9
=== result = 5, 6, i = 10
=== result = 5, 6, i = 11
=== result = 5, 5, i = 12
=== result = 5, 5, i = 13
=== result = 5, 5, i = 14
=== result = 6, 5, i = 15
=== result = 12, 5, i = 16
=== result = 999, 5, i = 17
467263.232000[ms]
999, 5
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;span id=&quot;back2&quot;&gt;&lt;/span&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;　&lt;a href=&quot;/software/2020-09-19/js_dart_cpp&quot;&gt;前回の記事&lt;/a&gt;より実行時間が短縮しているのもバグを修正した所為で、前回と同じPCで実行しています。&lt;br /&gt;
　続いて、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Apple M1 Pro&lt;/code&gt;側です。初めてのARMベースのCPUということでコンパイルするのも一手間&lt;sup id=&quot;fnref:2&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:2&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;だったのですが、&lt;a href=&quot;https://zenn.dev/ress/articles/069baf1c305523dfca3d&quot;&gt;この記事&lt;/a&gt;を参考にして解決できました。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% ./mancala.out 
0,2,2,2,2,2,2,0,2,2,2,2,2,2,
=== result = 4, 5, i = 1
=== result = 3, 5, i = 2
=== result = 1, 6, i = 3
=== result = 3, 5, i = 4
=== result = 5, 5, i = 5
=== result = 4, 5, i = 6
=== result = 5, 5, i = 7
=== result = 4, 5, i = 8
=== result = 4, 5, i = 9
=== result = 5, 6, i = 10
=== result = 5, 6, i = 11
=== result = 5, 5, i = 12
=== result = 5, 5, i = 13
=== result = 5, 5, i = 14
=== result = 6, 5, i = 15
=== result = 12, 5, i = 16
=== result = 999, 5, i = 17
274362.594000[ms]
999, 5
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　同じ結果を得るのに要した時間は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Core i7-2600K&lt;/code&gt;が&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;467秒&lt;/code&gt;だったのに対して、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Apple M1 Pro&lt;/code&gt;では&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;274秒&lt;/code&gt;でした。
　ちなみに実行結果の最後の行、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;999, 5&lt;/code&gt;は、以下の表の&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;5&lt;/code&gt;の位置を先手が初手に選べば、先手が勝てることを意味しています。２×６列のマンカラカラハは先手必勝のゲームです、詳しくは&lt;a href=&quot;/software/2020-06-07/mancala&quot;&gt;こちらの記事&lt;/a&gt;に書いています。&lt;/p&gt;

&lt;div style=&quot;float:left; margin: 0px 15px 0px&quot;&gt;
    &lt;table&gt;
    &lt;tr&gt;
    &lt;td rowspan=&quot;4&quot; align=&quot;center&quot;&gt;0↓&lt;/td&gt;
    &lt;td colspan=&quot;6&quot; align=&quot;center&quot;&gt;後手&lt;/td&gt;    
    &lt;td rowspan=&quot;4&quot; align=&quot;center&quot;&gt;7↑&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;13&lt;br /&gt;←&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;12&lt;br /&gt;←&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;11&lt;br /&gt;←&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;10&lt;br /&gt;←&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;9&lt;br /&gt;←&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;8&lt;br /&gt;←&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td colspan=&quot;6&quot; align=&quot;center&quot;&gt;先手&lt;/td&gt;    
    &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td align=&quot;center&quot;&gt;1&lt;br /&gt;→&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;2&lt;br /&gt;→&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;3&lt;br /&gt;→&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;4&lt;br /&gt;→&lt;/td&gt;    
    &lt;td align=&quot;center&quot;&gt;&lt;font color=&quot;red&quot;&gt;5&lt;/font&gt;&lt;br /&gt;→&lt;/td&gt;
    &lt;td align=&quot;center&quot;&gt;6&lt;br /&gt;→&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br clear=&quot;all&quot; /&gt;&lt;/p&gt;

&lt;p&gt;　３×６列や４×６列のカラハでどうなるのか確認したいところですが、CPUがそこそこ速くなったぐらいでは結果を得るのに数ヶ月以上掛かると思われるので他の工夫が必要だと思ってます。&lt;/p&gt;

&lt;p&gt;　ついでにMacbook12インチでも試してみました。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% ./mancala.out
0,2,2,2,2,2,2,0,2,2,2,2,2,2,
=== result = 4, 5, i = 1
=== result = 3, 5, i = 2
=== result = 1, 6, i = 3
=== result = 3, 5, i = 4
=== result = 5, 5, i = 5
=== result = 4, 5, i = 6
=== result = 5, 5, i = 7
=== result = 4, 5, i = 8
=== result = 4, 5, i = 9
=== result = 5, 6, i = 10
=== result = 5, 6, i = 11
=== result = 5, 5, i = 12
=== result = 5, 5, i = 13
=== result = 5, 5, i = 14
=== result = 6, 5, i = 15
=== result = 12, 5, i = 16
=== result = 999, 5, i = 17
440331.482000[ms]
999, 5
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;440秒&lt;/code&gt;ということで意外だったのですが&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Core i7-2600K&lt;/code&gt;（Ubuntu機）よりMacbook12インチ（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Intel Core M-5Y51&lt;/code&gt;）の方が速いんですね。普段メインで使っていたUbuntu機の方が断然レスポンスが良いと感じていたのはメモリ（12GB）の差でしょうか？Macbook12インチ（メモリ8GB）もメモリ増設していればそこそこ開発用として使えていたのかも知れません。&lt;br /&gt;
　ちょっと気になったので検索したら&lt;a href=&quot;https://www.cpu-monkey.com/ja/compare_cpu-intel_core_m_5y51-454-vs-intel_core_i7_2600k-6&quot;&gt;こんなページ&lt;/a&gt;がありました。シングルコアで比較すると結構いい勝負しているようです。それでもCoreMの方が速いというのはやはり合点がいかないのですが、Ubuntu機の方は他の多くのプログラムが動いている中で試していたのでその所為だと思われます。&lt;/p&gt;

&lt;h3 id=&quot;cpu性能比較２&quot;&gt;CPU性能比較２&lt;/h3&gt;
&lt;p&gt;　話が逸れましたがもう一つ、&lt;a href=&quot;/software/2018-10-27/unpromote&quot;&gt;以前の記事&lt;/a&gt;で「歩不成の詰将棋」を読み切るのに２週間掛かったことを紹介しましたが、この時使ったスクリプトを今回購入したMacbook Proで実行してみました。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ coffee game.coffee 
hmmxxxggggkkkkyyyffffffffffff
 9 8 7 6 5 4 3 2 1
| | | | | |f|T| |y|1
| | | | | | | | | |2
| | | | |H| |F|o| |3
| | | | | |X| |f|f|4
| | | | | | | | | |5
| | | | | | | | | |6
| | | | | | | | | |7
| | | | | | | | | |8
|O| | | | | | | | |9
F
first: i = 1, kind = Hi, temp = [{&quot;turn&quot;:-1,&quot;status&quot;:0,&quot;posi&quot;:[5,3],&quot;id&quot;:&quot;q6owepmi&quot;},[5,2],-589,1,{&quot;koma&quot;:{&quot;turn&quot;:-1,&quot;status&quot;:0,&quot;posi&quot;:[9,9],&quot;id&quot;:&quot;ribd4do4&quot;},&quot;posi&quot;:[9,8],&quot;score&quot;:-614,&quot;status&quot;:0}]
first: i = 2, kind = Fu, temp = [{&quot;turn&quot;:-1,&quot;status&quot;:0,&quot;posi&quot;:[3,3],&quot;id&quot;:&quot;g8a244eb&quot;},[3,2],-532,1,{&quot;koma&quot;:{&quot;turn&quot;:-1,&quot;status&quot;:0,&quot;posi&quot;:[5,3],&quot;id&quot;:&quot;q6owepmi&quot;},&quot;posi&quot;:[5,2],&quot;score&quot;:-542,&quot;status&quot;:1}]
first: i = 4, kind = Fu, temp = [{&quot;turn&quot;:-1,&quot;status&quot;:0,&quot;posi&quot;:[3,3],&quot;id&quot;:&quot;g8a244eb&quot;},[3,2],-522,1,{&quot;koma&quot;:{&quot;turn&quot;:-1,&quot;status&quot;:0,&quot;posi&quot;:[3,3],&quot;id&quot;:&quot;g8a244eb&quot;},&quot;posi&quot;:[3,2],&quot;score&quot;:-554,&quot;status&quot;:0}]
first: i = 5, kind = Fu, temp = [{&quot;turn&quot;:-1,&quot;status&quot;:0,&quot;posi&quot;:[3,3],&quot;id&quot;:&quot;g8a244eb&quot;},[3,2],-594,0,{&quot;koma&quot;:{&quot;turn&quot;:-1,&quot;status&quot;:0,&quot;posi&quot;:[4,4],&quot;id&quot;:&quot;a7qa7o3i&quot;},&quot;posi&quot;:[3,4],&quot;score&quot;:-702,&quot;status&quot;:0}]
hmmxxxggggkkkkyyyffffffffffff
 9 8 7 6 5 4 3 2 1
| | | | | |f|T| |y|1
| | | | | | |F| | |2
| | | | |H| | |o| |3
| | | | | |X| |f|f|4
| | | | | | | | | |5
| | | | | | | | | |6
| | | | | | | | | |7
| | | | | | | | | |8
|O| | | | | | | | |9
F
初手経過時間: 370448881ミリ秒
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Core i7-2600K&lt;/code&gt;で&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1208445383ミリ秒（約２週間）&lt;/code&gt;掛かった処理が&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Apple M1 Pro&lt;/code&gt;だと&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;370448881ミリ秒（約４日）&lt;/code&gt;でした。やはり断然速いですね。&lt;/p&gt;

&lt;div&gt;
    &lt;script async=&quot;&quot; src=&quot;https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js&quot;&gt;&lt;/script&gt;
    &lt;!-- display01 --&gt;
    &lt;ins class=&quot;adsbygoogle&quot; style=&quot;display:block&quot; data-ad-client=&quot;ca-pub-9018029357773039&quot; data-ad-slot=&quot;3925247388&quot; data-ad-format=&quot;auto&quot; data-full-width-responsive=&quot;true&quot;&gt;&lt;/ins&gt;
    &lt;script&gt;
    (adsbygoogle = window.adsbygoogle || []).push({});
    &lt;/script&gt;
&lt;/div&gt;

&lt;hr /&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;Flutter製アプリは別のUbuntu機を使って開発してます。&lt;a href=&quot;#back1&quot;&gt;戻る&lt;/a&gt; &lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;Rosettaって何？状態だったのでM1 Macbookのコンパイル環境を作るのに手間取りましたが、ソースコードそのものの修正は不要でした。&lt;a href=&quot;#back2&quot;&gt;戻る&lt;/a&gt; &lt;a href=&quot;#fnref:2&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</description>
        <pubDate>Tue, 23 Nov 2021 00:00:00 +0900</pubDate>
        <link>https://happyclam.github.io/hardware/2021-11-23/macbookpro</link>
        <guid isPermaLink="true">https://happyclam.github.io/hardware/2021-11-23/macbookpro</guid>
        
        <category>macbook</category>
        
        <category>cordova</category>
        
        <category>mancala</category>
        
        <category>shogi</category>
        
        
        <category>hardware</category>
        
      </item>
    
      <item>
        <title>Ubuntuで使えるBluetoothマウス</title>
        <description>&lt;h3 id=&quot;macbookproを買って貯まったヨドバシのポイント&quot;&gt;MacbookProを買って貯まったヨドバシのポイント&lt;/h3&gt;
&lt;p&gt;　ヨドバシのポイントが貯まるとすぐに使い切ってしまいたくなる質なので、キーボードとBluetoothマウスを新調しました。&lt;/p&gt;

&lt;h3 id=&quot;悩まされてきたbluetoothマウス&quot;&gt;悩まされてきたBluetoothマウス&lt;/h3&gt;
&lt;p&gt;　自分だけかも知れませんが、今までUbuntu機でいくつかBluetoothマウスを試して長く愛用出来るものには出会えませんでした。マウスポインタの動きがおかしかったり、少しの間快適に使えていてもUbuntuのUpdateをするとまたおかしくなったりしてました。値段の高いトラックボールなんかだとUbuntuの設定を弄ってなんとか使えるようにしてましたが、マウスだとすぐに諦めて有線に戻していた所為もあるでしょう。&lt;br /&gt;
　今回買ったのはマウスとしては少々高めのお値段ですが、&lt;a href=&quot;https://hb.afl.rakuten.co.jp/ichiba/220691a2.603e89c9.220691a3.4b08f26e/?pc=https%3A%2F%2Fitem.rakuten.co.jp%2Flogicool%2Fm720r%2F&amp;amp;link_type=hybrid_url&amp;amp;ut=eyJwYWdlIjoiaXRlbSIsInR5cGUiOiJoeWJyaWRfdXJsIiwic2l6ZSI6IjI0MHgyNDAiLCJuYW0iOjEsIm5hbXAiOiJyaWdodCIsImNvbSI6MSwiY29tcCI6ImRvd24iLCJwcmljZSI6MSwiYm9yIjoxLCJjb2wiOjEsImJidG4iOjEsInByb2QiOjAsImFtcCI6ZmFsc2V9&quot;&gt;logicoolのM720rトライアスロンマルチデバイスマウス&lt;/a&gt;と言うものです。&lt;/p&gt;

&lt;div style=&quot;width:400px; margin: 0 auto;&quot;&gt;

  &lt;p&gt;&lt;a href=&quot;/images/logi_m720r01.png&quot;&gt;&lt;img src=&quot;https://happyclam.github.io/images/logi_m720r01.png&quot; alt=&quot;M720r&quot; width=&quot;360&quot; height=&quot;309&quot; title=&quot;M720r&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p&gt;　今までUbuntu機で使ったことのあるBluetoothマウスは全て汎用のBluetoothアダプタ（ドングル）と通信して使うものでしたが、この&lt;a href=&quot;https://hb.afl.rakuten.co.jp/ichiba/220691a2.603e89c9.220691a3.4b08f26e/?pc=https%3A%2F%2Fitem.rakuten.co.jp%2Flogicool%2Fm720r%2F&amp;amp;link_type=hybrid_url&amp;amp;ut=eyJwYWdlIjoiaXRlbSIsInR5cGUiOiJoeWJyaWRfdXJsIiwic2l6ZSI6IjI0MHgyNDAiLCJuYW0iOjEsIm5hbXAiOiJyaWdodCIsImNvbSI6MSwiY29tcCI6ImRvd24iLCJwcmljZSI6MSwiYm9yIjoxLCJjb2wiOjEsImJidG4iOjEsInByb2QiOjAsImFtcCI6ZmFsc2V9&quot;&gt;M720r&lt;/a&gt;は付属の専用アダプタと通信して使うタイプです。専用アダプタが付属するものは自分の経験ではUbuntuでは使えないものばかりでしたが、この製品はアダプタをUbuntu機に挿したらいきなり使えました（Ubuntu 20.04）。&lt;br /&gt;
　おまけに付属のアダプタを使わずにBluetooth接続も出来ると聞いていたので、MacbookProで試したところ、&lt;a href=&quot;https://www.logitech.com/assets/64937/4/m720-web-qsg.pdf&quot;&gt;取扱説明書&lt;/a&gt;を読むまでもなく使用できました。マウス側面のデバイス切り替えボタンで３台のPCで使えるそうですが、一番手前のボタンを長押しすれば簡単にペアリング出来ます。&lt;/p&gt;

&lt;div style=&quot;width:400px; margin: 0 auto;&quot;&gt;

  &lt;p&gt;&lt;a href=&quot;/images/logi_m720r02.png&quot;&gt;&lt;img src=&quot;https://happyclam.github.io/images/logi_m720r02.png&quot; alt=&quot;M720r&quot; width=&quot;360&quot; height=&quot;282&quot; title=&quot;M720r&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p&gt;　専用レシーバーは電池横のポケットに収納出来るようになっていて、紛失の可能性も軽減。まだ分かりませんが、このマウスは長く使っていけそうな気がします。&lt;/p&gt;

&lt;h3 id=&quot;初めてのメカニカルキーボード&quot;&gt;初めてのメカニカルキーボード&lt;/h3&gt;
&lt;p&gt;　ヨドバシでキーボードのコーナーを何気なく見ていたら、見た目がとてもスマートだなと思って目が止まったのが&lt;a href=&quot;https://hb.afl.rakuten.co.jp/ichiba/2207b93f.46532365.2207b940.7c241670/?pc=https%3A%2F%2Fitem.rakuten.co.jp%2Fakindo%2Fk835gpb%2F&amp;amp;link_type=hybrid_url&amp;amp;ut=eyJwYWdlIjoiaXRlbSIsInR5cGUiOiJoeWJyaWRfdXJsIiwic2l6ZSI6IjI0MHgyNDAiLCJuYW0iOjEsIm5hbXAiOiJyaWdodCIsImNvbSI6MSwiY29tcCI6ImRvd24iLCJwcmljZSI6MCwiYm9yIjoxLCJjb2wiOjEsImJidG4iOjEsInByb2QiOjAsImFtcCI6ZmFsc2V9&quot;&gt;ロジクール キーボード K835 TKL 赤軸&lt;/a&gt;、スマホで検索してみるとメカニカルキーボードじゃないですか。メカニカルキーボードと言えば、昔秋葉原でCherry社の高級キーボードを触ったことがありますが、値段が高過ぎて（確か３万円ぐらい？）とても買ってみようなんて思わなかったのですが、当時を思い出しすぐに買いたくなりました。&lt;/p&gt;

&lt;div style=&quot;width:400px; margin: 0 auto;&quot;&gt;

  &lt;p&gt;&lt;a href=&quot;/images/logi_k83501.png&quot;&gt;&lt;img src=&quot;https://happyclam.github.io/images/logi_k83501.png&quot; alt=&quot;K835&quot; width=&quot;360&quot; height=&quot;148&quot; title=&quot;K835&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;div style=&quot;width:400px; margin: 0 auto;&quot;&gt;

  &lt;p&gt;&lt;a href=&quot;/images/logi_k83502.png&quot;&gt;&lt;img src=&quot;https://happyclam.github.io/images/logi_k83502.png&quot; alt=&quot;K835&quot; width=&quot;360&quot; height=&quot;227&quot; title=&quot;K835&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p&gt;　赤軸と青軸があるのですが、音が控えめな赤軸の方にしました。音が控えめと言っても普通のメンブレン式キーボードに較べたら音は大きめです。メンブレン式キーボードでも&lt;a href=&quot;https://yukirai.com/2017/08/17/hhkb-lite2-review/&quot;&gt;HHKB Lite2&lt;/a&gt;はかなり煩かったですが、それよりは静かです。&lt;/p&gt;

&lt;div style=&quot;width:400px; margin: 0 auto;&quot;&gt;

  &lt;p&gt;&lt;a href=&quot;/images/logi_k83503.png&quot;&gt;&lt;img src=&quot;https://happyclam.github.io/images/logi_k83503.png&quot; alt=&quot;K835&quot; width=&quot;360&quot; height=&quot;227&quot; title=&quot;K835&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p&gt;　それとこのキーボード、キートップがキーボードの筐体に埋まっていないのでキーとキーの隙間に埃やゴミが溜まりにくそうです。写真のようにキートップを外すと非常に掃除がし易そうで、これなら無精な自分でも掃除をする気にさせてくれるのではないかと思ってます。&lt;/p&gt;

&lt;div&gt;
    &lt;script async=&quot;&quot; src=&quot;https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js&quot;&gt;&lt;/script&gt;
    &lt;!-- display01 --&gt;
    &lt;ins class=&quot;adsbygoogle&quot; style=&quot;display:block&quot; data-ad-client=&quot;ca-pub-9018029357773039&quot; data-ad-slot=&quot;3925247388&quot; data-ad-format=&quot;auto&quot; data-full-width-responsive=&quot;true&quot;&gt;&lt;/ins&gt;
    &lt;script&gt;
    (adsbygoogle = window.adsbygoogle || []).push({});
    &lt;/script&gt;
&lt;/div&gt;

&lt;hr /&gt;

</description>
        <pubDate>Wed, 10 Nov 2021 00:00:00 +0900</pubDate>
        <link>https://happyclam.github.io/hardware/2021-11-10/logicool</link>
        <guid isPermaLink="true">https://happyclam.github.io/hardware/2021-11-10/logicool</guid>
        
        <category>ubuntu</category>
        
        <category>logicool</category>
        
        
        <category>hardware</category>
        
      </item>
    
      <item>
        <title>５五将棋アプリのオンライン対戦機能？</title>
        <description>&lt;h3 id=&quot;リリースするかは未定だけど&quot;&gt;リリースするかは未定だけど&lt;/h3&gt;
&lt;p&gt;　以前から将棋関連アプリのオンライン対戦機能を作ってみようかと、FirebaseのCloud FunctionsをJavaScriptで使ってみたりしていたのですが、従量制なので実際運用し始めたらどれぐらいの費用が掛かるのか分からないので、なかなか本気になれませんでした。開発することを考えるとオンライン対戦機能をどのように実現するかという問題の方が先ですが、運用コストを考えるといろいろ迷います。そこで定額制で運用することを考えると自分の場合はRailsかNode.jsかな〜と思い、取り敢えずNode.jsで着手してみました。&lt;/p&gt;

&lt;h3 id=&quot;結局herokuで試すことに&quot;&gt;結局Herokuで試すことに&lt;/h3&gt;
&lt;p&gt;　ローカル環境である程度作ったところでリモートサーバーで試してみたいと思って、定額制でNode.jsの運用先を探したところ&lt;a href=&quot;https://paiza.cloud/ja/&quot;&gt;Paiza Cloud&lt;/a&gt;というのを見つけたのですが、ここは無料プランやライトプランではサービスを公開出来ないようです。&lt;br /&gt;
　&lt;a href=&quot;/programming/2021-06-30/heroku_delete&quot;&gt;以前の記事&lt;/a&gt;で&lt;a href=&quot;/programming/2015-04-25/mongo_upsert&quot;&gt;Node.jsを使ったアプリ&lt;/a&gt;を、MongoDBのアドオンが使えなくなったために仕方なく非公開にしたことを書きましたが、そんなことがあったのでもうHerokuでMongoDBを使うのは止めようと思っていたのですが、無料でリモート環境で試せるHerokuはやはり魅力的です。実際にリリースするかどうかも決めてないので尚更です。&lt;/p&gt;

&lt;h3 id=&quot;mongodb-atlasを使う&quot;&gt;MongoDB Atlasを使う&lt;/h3&gt;
&lt;p&gt;　HerokuでMongoDBのアドオン（mLabアドオン）が使えなくなったので、代替方法であるMongoDB Atlasを使うと料金が発生するかもと心配しましたが、Atlasの方は新たなアカウントを作らずにgoogleアカウントでログインするだけでデータベース一つだけなら無料で使えるらしいです。&lt;a href=&quot;https://qiita.com/Molly95554907/items/43b89c8eec475e9f1ed8&quot;&gt;こちらの記事&lt;/a&gt;の通りにすれば、簡単に環境が作れました。&lt;/p&gt;

&lt;h3 id=&quot;heroku本番で使うかどうかは未定で動作確認&quot;&gt;Heroku（本番で使うかどうかは未定）で動作確認&lt;/h3&gt;
&lt;p&gt;　ブラウザを２つ立ち上げて２台のスマホ端末に見立てて動作確認してみました。&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/y1_h8-bk1TI&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;　ちゃんと動いて一安心です。&lt;/p&gt;

&lt;h3 id=&quot;全体の３割ぐらい完成か&quot;&gt;全体の３割ぐらい完成か？&lt;/h3&gt;
&lt;p&gt;　自分の将棋関連アプリの中から&lt;a href=&quot;https://play.google.com/store/apps/details?id=shogi55.io.github.happyclam&quot;&gt;５五将棋アプリ&lt;/a&gt;を選んでここまで作りましたが、今になって５五将棋は既に&lt;a href=&quot;http://sdin.jp/browser/board/55shogi/&quot;&gt;SDINサイト&lt;/a&gt;でオンライン対戦が可能なので、他のアプリ（例えば禽将棋アプリ）にした方がよかったかも？なんて考えてます。まぁ他のアプリでも使えるように考えながらサーバーサイドを作っているつもりですが、最終的にどうするかは決めてません。&lt;br /&gt;
　あと、&lt;a href=&quot;https://play.google.com/store/apps/details?id=shogi55.io.github.happyclam&quot;&gt;５五将棋アプリ&lt;/a&gt;は初期配置をユーザーが自由に編集可能なので、対戦申し込みする時に初期配置を相手に表示して「この初期配置だけど、いいですか？」という意志を確認するために対戦申し込みする側の初期配置を相手側に通知する機能の実装が面倒だったのですが、開発時の苦労話や技術的なTipsみたいな物も今後記事にするかも知れません。&lt;/p&gt;

&lt;h3 id=&quot;mongodbnosqlとrdbとの違い&quot;&gt;MongoDB（NoSQL）とRDBとの違い&lt;/h3&gt;
&lt;p&gt;　例えば棋譜テーブルは以下のように定義しています。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;var kifuSchema = new Schema(
  {
    description: {
      type: String
    },
    firstPlayer: {
      type: String,
      required: true
    },
    secondPlayer: {
      type: String,
      required: true
    },
    applicant: {
      type: String,
      required: true
    },
    koma: {
      type: Array,
      default: []
    },
    histories: {
      type: Array,
      default: []
    },
    users: [{ type: Schema.Types.ObjectId, ref: &quot;User&quot; }]
  },
  {
    timestamps: true,
  }
);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　配列型のカラム（histories）を用意して、指し手が進む毎にスマホ端末から貰ったJSON形式の棋譜データをそのまま追加してます。このやり方なら禽将棋であろうが５五将棋であろうがテーブル構造を変える必要がありません。&lt;br /&gt;
　以下のコードは対局が一手進んだ時のサーバー側の処理です。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    client.on(&quot;gameMove&quot;, data =&amp;gt; {
      let filter = {_id: data.kifuId};
      let update = {$push: {koma: data.koma, histories: data.record}};
      Kifu.findOneAndUpdate(filter, update, {returnDocument: &apos;after&apos;})
        .then(kifu =&amp;gt; {
          return kifu;
        })
        .then(kifu =&amp;gt; {
          User.find({_id: {$in: [kifu.users[0], kifu.users[1]]}})
            .then(users =&amp;gt; {
              if (users[0].socketId == client.id){
                io.to(users[1].socketId).emit(&quot;gameMoved&quot;, kifu);
              } else {
                io.to(users[0].socketId).emit(&quot;gameMoved&quot;, kifu);
              }
            })
        })
        .catch(error =&amp;gt; {
          console.log(`Error in io.on.gameMove:${error.message}`);
        });
    });

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　RDB（リレーショナルデータベース）だと配列型のカラムではなく別テーブルにすると思いますが、そうすると将棋の種類が変わるとテーブル構造が変わりなかなか汎用的に作れません。NoSQLデータベース（MongoDB）ではテーブルの正規化とかあまり考えずに緩く定義（冗長化）して使えるのが利点だと思います。最近のRDBでは配列型のカラムを使用することは出来るかも知れませんが（私は使ったことがありません）、今のところNode.js＋MongoDBで作ることにしてよかったなと思ってます。&lt;br /&gt;
　&lt;a href=&quot;https://atmarkit.itmedia.co.jp/ait/articles/1103/25/news131_3.html&quot;&gt;この記事&lt;/a&gt;によると「NoSQLデータベースの設計では、正規化をしてはいけない」と言う人もいるそうです。それは極端かも知れませんが、RDBで配列型のカラムを使うぐらいならNoSQLデータベースを使う方がいいような気がします。&lt;/p&gt;

&lt;div&gt;
    &lt;script async=&quot;&quot; src=&quot;https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js&quot;&gt;&lt;/script&gt;
    &lt;!-- display01 --&gt;
    &lt;ins class=&quot;adsbygoogle&quot; style=&quot;display:block&quot; data-ad-client=&quot;ca-pub-9018029357773039&quot; data-ad-slot=&quot;3925247388&quot; data-ad-format=&quot;auto&quot; data-full-width-responsive=&quot;true&quot;&gt;&lt;/ins&gt;
    &lt;script&gt;
    (adsbygoogle = window.adsbygoogle || []).push({});
    &lt;/script&gt;
&lt;/div&gt;

&lt;hr /&gt;

</description>
        <pubDate>Sat, 21 Aug 2021 00:00:00 +0900</pubDate>
        <link>https://happyclam.github.io/programming/2021-08-21/nodejs</link>
        <guid isPermaLink="true">https://happyclam.github.io/programming/2021-08-21/nodejs</guid>
        
        <category>javascript</category>
        
        <category>android</category>
        
        <category>cordova</category>
        
        <category>shogi</category>
        
        <category>heroku</category>
        
        <category>node</category>
        
        <category>MongoDB</category>
        
        
        <category>programming</category>
        
      </item>
    
      <item>
        <title>FlutterアプリのNull Safety対応</title>
        <description>&lt;p&gt;&lt;a href=&quot;https://taimienphi.vn/download-mancala-nuts-90337&quot;&gt;&lt;img src=&quot;https://happyclam.github.io/images/tmp2.png&quot; alt=&quot;マンカラアプリ&quot; title=&quot;マンカラ ナッツ&quot; width=&quot;155&quot; height=&quot;60&quot; /&gt;&lt;/a&gt;
&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;&lt;img src=&quot;https://happyclam.github.io/images/ja_badge_web_generic.png&quot; alt=&quot;マンカラアプリ&quot; title=&quot;マンカラ ナッツ&quot; width=&quot;155&quot; height=&quot;60&quot; /&gt;&lt;/a&gt;
&lt;a href=&quot;https://www.amazon.co.jp/happyclam-マンカラ-ナッツ/dp/B08D8QVVQY/ref=sr_1_2&quot;&gt;&lt;img src=&quot;https://happyclam.github.io/images/amazon-appstore-badge-jp-white.png&quot; alt=&quot;マンカラアプリ&quot; title=&quot;マンカラ ナッツ&quot; width=&quot;155&quot; height=&quot;60&quot; /&gt;&lt;/a&gt;
&lt;br /&gt;&lt;a href=&quot;https://taimienphi.vn&quot; title=&quot;download&quot;&gt;taimienphi.vn&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;はっきり言って面倒臭い&quot;&gt;はっきり言って面倒臭い&lt;/h3&gt;
&lt;p&gt;　プログラミングの際にオブジェクトを代入する変数を&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;null&lt;/code&gt;で初期化して、その変数が&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;null&lt;/code&gt;かどうかで条件分岐する、なんてコードをよく書いていたので、また面倒なことが増えたって気がしますが、実行時のNull Pointer Exceptionを避ける意味はあるのでしょう。はっきり言ってこういう仕組みは普段テストを書く習慣が無い人のためにあるんじゃないの？って気もしますが、世の流れには逆らえずFlutter製の&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;アプリ（マンカラナッツ）&lt;/a&gt;でも対応することにしました。&lt;/p&gt;

&lt;h3 id=&quot;パッケージの依存状況を調べる&quot;&gt;パッケージの依存状況を調べる&lt;/h3&gt;
&lt;p&gt;　&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;flutter pub outdated --mode=null-safety&lt;/code&gt;と打てば、使用しているパッケージがNull Safety対応済みかどうか分かります。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ flutter pub outdated --mode=null-safety
Showing dependencies that are currently not opted in to null-safety.
[✗] indicates versions without null safety support.
[✓] indicates versions opting in to null safety.

Package Name               Current  Upgradable  Resolvable  Latest

direct dependencies:
flutter_google_ad_manager  ✗0.11.1  ✗0.11.1     ✗0.11.1     ✗0.11.1

dev_dependencies: all support null safety.
You are already using the newest resolvable versions listed in the &apos;Resolvable&apos; column.
Newer versions, listed in &apos;Latest&apos;, may not be mutually compatible.

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　以前にも少し作業したので、&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;マンカラナッツ&lt;/a&gt;の場合はNull Safetyに対応していないのは&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;flutter_google_ad_manager&lt;/code&gt;だけです。というかこのパッケージ（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;flutter_google_ad_manager&lt;/code&gt;）が対応されるのを待っていた状態でした。対応作業する前は&lt;a href=&quot;/software/2020-10-01/flutter_plugin&quot;&gt;自分で作ったパッケージ（karah_think.so）&lt;/a&gt;もこのリストに表示されていたのですが、既に修正したので、今回は&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;flutter_google_ad_manager&lt;/code&gt;の代わりに&lt;a href=&quot;https://pub.dev/packages/admob_flutter/versions/2.0.0-nullsafety.1&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admob_flutter&lt;/code&gt;&lt;/a&gt;を使うことで対応しました。作業内容は&lt;a href=&quot;https://pub.dev/packages/admob_flutter/versions/2.0.0-nullsafety.1/example&quot;&gt;使用例&lt;/a&gt;に書かれているので簡単でした。&lt;/p&gt;

&lt;h3 id=&quot;コードの修正&quot;&gt;コードの修正&lt;/h3&gt;
&lt;p&gt;　以前にNull Safety対応作業した時には既にFlutter2.0だったのですが、今回&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Flutter upgrade&lt;/code&gt;してから作業するといくつか追加の作業が必要でした。以前&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;flutter_google_ad_manager&lt;/code&gt;部分をコメントにしてビルドした時には既に&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Sound Null Safety&lt;/code&gt;と表示されていたのですが、Flutter自体が完全にNull Safetyになっていなかったのでしょうか？今回AndroidStudioのバージョンアップ（&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;4.2.2&lt;/code&gt;）もしたので、それも関係あるのかも知れませんがよく分かりません。&lt;/p&gt;

&lt;p&gt;　今回の環境は以下の通りです。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ flutter --version
Flutter 2.2.3 • channel stable • https://github.com/flutter/flutter
Framework • revision f4abaa0735 (8 days ago) • 2021-07-01 12:46:11 -0700
Engine • revision 241c87ad80
Tools • Dart 2.13.4
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;修正例&quot;&gt;修正例&lt;/h3&gt;
&lt;p&gt;　修正前&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  GlobalKey _keyBoard = GlobalKey();
  RenderBox _box;

    if (_box == null)
      WidgetsBinding.instance.addPostFrameCallback((_afterLayout){
        setState(() {
          _box = _keyBoard.currentContext.findRenderObject();
        });
      });

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　修正後&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  final GlobalKey _keyBoard = GlobalKey();
  late RenderBox _box;

    WidgetsBinding.instance!.addPostFrameCallback((_) {
      setState(() {
        _box = _keyBoard.currentContext!.findRenderObject() as RenderBox;
      });
    });
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　遅延初期化のための&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;late&lt;/code&gt;キーワードが使えるようになったのはDart2.12からだそうです。また、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;as&lt;/code&gt;を使って明確に型を指定しないとビルド出来なくなっていました。C++のように型にうるさくなっていくのでしょう。&lt;/p&gt;

&lt;h3 id=&quot;修正後&quot;&gt;修正後&lt;/h3&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ flutter pub outdated --mode=null-safety
Showing dependencies that are currently not opted in to null-safety.
[✗] indicates versions without null safety support.
[✓] indicates versions opting in to null safety.

All your dependencies declare support for null-safety.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　AdMob用のパッケージを&lt;a href=&quot;https://pub.dev/packages/admob_flutter/versions/2.0.0-nullsafety.1&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;admob_flutter&lt;/code&gt;&lt;/a&gt;に変えたことで、Null Safety非対応のプラグインはなくなりました。&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ flutter build apk --release

💪 Building with sound null safety 💪

Picked up _JAVA_OPTIONS: -Djava.net.preferIPv6Addresses=true
Running Gradle task &apos;assembleRelease&apos;...
Running Gradle task &apos;assembleRelease&apos;... Done                     121.0s
✓  Built build/app/outputs/flutter-apk/app-release.apk (60.1MB).

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;　ビルド時に:muscle:絵文字が出て、&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Sound Null Safety&lt;/code&gt;と表示されます。&lt;br /&gt;
　目出度く&lt;a href=&quot;https://play.google.com/store/apps/details?id=mancala.io.github.happyclam&quot;&gt;マンカラナッツ&lt;/a&gt;はVersion1.2.2から&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Null Safety&lt;/code&gt;になりました。&lt;/p&gt;

&lt;div&gt;
    &lt;script async=&quot;&quot; src=&quot;https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js&quot;&gt;&lt;/script&gt;
    &lt;!-- display01 --&gt;
    &lt;ins class=&quot;adsbygoogle&quot; style=&quot;display:block&quot; data-ad-client=&quot;ca-pub-9018029357773039&quot; data-ad-slot=&quot;3925247388&quot; data-ad-format=&quot;auto&quot; data-full-width-responsive=&quot;true&quot;&gt;&lt;/ins&gt;
    &lt;script&gt;
    (adsbygoogle = window.adsbygoogle || []).push({});
    &lt;/script&gt;
&lt;/div&gt;

&lt;hr /&gt;

</description>
        <pubDate>Sat, 10 Jul 2021 00:00:00 +0900</pubDate>
        <link>https://happyclam.github.io/software/2021-07-10/null_safety</link>
        <guid isPermaLink="true">https://happyclam.github.io/software/2021-07-10/null_safety</guid>
        
        <category>mancala</category>
        
        <category>dart</category>
        
        <category>android</category>
        
        <category>flutter</category>
        
        
        <category>software</category>
        
      </item>
    
  </channel>
</rss>
