
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    
    <title>マンカラは先手必勝？後手必勝？</title>

    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-1752720-7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      
      gtag('config', 'UA-1752720-7');
    </script>
    <meta name="author" content="happyclam">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
      <script src="/assets/themes/twitter/js/excanvas.min.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link rel="shortcut icon" href="/images/favicon.ico">
    <!-- Le fav and touch icons -->
  <!-- Update these with your own images

    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@SappierBoy">
  <meta name="twitter:creator" content="@SappierBoy">
  
  <meta name="twitter:title" content="マンカラは先手必勝？後手必勝？">
  
  
  <meta name="twitter:url" content="/software/2020-06-07/mancala">
  
  
  <meta name="twitter:description" content="一番単純なルールのマンカラベーシックで先手必勝なのか後手必勝なのかDartで検証">
  
  
  <meta name="twitter:image:src" content="https://happyclam.github.io/images/55shogi_logo.png">
  

  <link rel="canonical" href="/software/2020-06-07/mancala" />
    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script language="JavaScript">
$(document).ready( function () {
    $("a[href^='http']:not([href*='" + location.hostname + "'])").attr('target', '_blank');
})
</script>
<script src="/assets/themes/twitter/js/jquery.min.js"></script>
<script src="/assets/themes/twitter/js/jquery.flot.min.js"></script>
<script src="/assets/themes/twitter/js/flotr2.min.js" type="text/javascript"></script>
<script src="/assets/themes/twitter/js/jquery.flot.selection.js" type="text/javascript" ></script>
<script src="/assets/themes/twitter/js/jekyll-search.js" type="text/javascript"></script>
    <!-- <script> -->
    <!--   (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ -->
    <!--   (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), -->
    <!--   m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) -->
    <!--   })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); -->
    <!--   ga('create', 'UA-1752720-7', 'happyclam.github.io'); -->
    <!--   ga('send', 'pageview'); -->
    <!-- </script> -->
<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  jax: ["input/TeX", "output/HTML-CSS"],
  tex2jax: {
    inlineMath: [ ['$', '$'] ],
    displayMath: [ ['$$', '$$']],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  messageStyle: "none",
  "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
});
</script>
<script src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>
  </head>

  <body>
    <div style="text-align: center;">
      <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
      <script>
        (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-9018029357773039",
        enable_page_level_ads: true
        });
      </script>
    </div>
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-narrow">
          <a class="brand" href="/">自己満足プログラミング</a>
          <ul class="nav">
            
            
            


  
    
      
    
  
    
      
      	
      	<li><a href="/archive">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages">Pages</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/policy">Policy</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/profile">About</a></li>
      	
      
    
  
    
      
    
  
    
  
    
      
      	
      	<li><a href="/tags">Tags</a></li>
      	
      
    
  
    
  
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">
      <div class="row-fluid">
        <div class="span3">
        <a href="https://twitter.com/share" class="twitter-share-button"{count} data-via="SappierBoy">Tweet</a>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
        </div>
        <div class="span9"
             <!-- Html Elements for Search -->
             <div id="search-container" align="right">
               <input type="text" id="search-input" placeholder="search...">
               <ul id="results-container"></ul>
             </div>
             <div class="results"></div>
        </div>
      </div>
<script type="text/javascript">
  SimpleJekyllSearch.init({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('results-container'),
    json: '/search.json',
    searchResultTemplate: '<li><a href="{url}" title="{category}:{title}">{title}</a></li>',
    noResultsText: 'No results found',
    limit: 15,
    fuzzy: false,
  })
</script>
      <div class="content">
        
<div class="page-header">
  <h1>マンカラは先手必勝？後手必勝？ </h1>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="date">
      <span>07 June 2020</span>
    </div>
    <div class="content">
      <h3 id="最古のボードゲームらしい">最古のボードゲームらしい</h3>
<p>　世界最古のボードゲームらしいのですが、存在自体知りませんでした。早速アプリをダウンロードして遊んでみたところ、何回か遊んでいるうちに勝つためのコツというのが少しずつ見えてきて楽しめましたが、それよりもこの単純なルールならすぐに人間に負けないＡＩが作れるんじゃないか？と思い試してみることにしました。</p>

<h3 id="派生のルールがいろいろあるらしい">派生のルールがいろいろあるらしい</h3>
<p>　<a href="https://ja.wikipedia.org/wiki/マンカラ">Wikipedia</a>によるといろいろな遊び方があるようですが、たまたまダウンロードしたアプリは「ベーシック」と「カラハ」という２つのルールで遊べるもので、ベーシックをやってみてすごく単純なルールに興味を持ったのですが、最初にカラハのルールで遊んでいたら面倒そうなので自分でプログラムを作ってみようなんて思わなかったかも知れません<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>。<br />
　先手必勝か後手必勝かを調べる方法は、<a href="/software/2014-09-23/tictactoe_arrange">以前の記事</a>で<strong>３手前に打った駒が消える特殊なルールの三目並べ</strong>を例にして紹介したように、MIN-MAX法（+αβ法）で先読みの深さを徐々に深くしていって（反復深化）、お互い最善手を尽くしても先手が勝つ（先手必勝）のかあるいは後手が勝つ（後手必勝）のかを確認するやり方です。</p>

<h3 id="マンカラベーシックのルール">マンカラベーシックのルール</h3>
<p>　普通は６×２列×石４つで行うゲームですが、それだと先読みの際にまたスタックオーバーフローに見舞われるだろうと思い、取り敢えず３×２列で検証することにしました。下図は石が３つの場合です。</p>

<div style="float:left; margin: 0px 15px 0px">
    <table>
    <tr>
    <td rowspan="4" align="center">後手のストア<br />0↓</td>
    <td colspan="3" align="center">後手</td>    
    <td rowspan="4" align="center">先手のストア<br />0↑</td>
    </tr>
    <tr>
    <td align="center">3<br />←</td>    
    <td align="center">3<br />←</td>
    <td align="center">3<br />←</td>
    </tr>
    <tr>
    <td colspan="3" align="center">先手</td>    
    </tr>
    <tr>
    <td align="center">3<br />→</td>    
    <td align="center">3<br />→</td>
    <td align="center">3<br />→</td>
    </tr>
    </table>
</div>
<p><br clear="all" /></p>

<p>　先手と後手が自分の穴のどれかを選んで全ての石を取り出し、矢印のように反時計回りに一つずつ石を撒いていく動作を先手後手交互に繰り返して、先に自分の穴の石が全てなくなれば勝ちです。自分か相手のストアで石を撒き終わった場合はもう一度自分の手番になります。</p>

<h3 id="dartで実装">Dartで実装</h3>
<p>　今リリースしている自分の将棋関連アプリの中で一番利用されている<a href="https://play.google.com/store/apps/details?id=shogi55.io.github.happyclam">５五将棋アプリ</a>をFlutterで作り直そうかと思って、慣れるためにプログラミング言語はDartにしました。<br />
　石の数は３つの場合<code>List board = [0,3,3,3,0,3,3,3];</code>のようにリストを作ります。添字の<code>0</code>と<code>4</code>がストアになります。カラハのルールだと相手のストアには石を撒かないそうですが、ベーシックのルールだと相手のストアにも石を撒くので、このリストをシーケンシャルに処理していけばいいだけなので処理が単純です。またカラハのように自分の空の穴で石を撒き終わった時に相手の石を取る（capture）ことが出来るというルールもありません。</p>

<pre><code class="language-Dart">void main() {
  final List board = [0,3,3,3,0,3,3,3];
  List result = new List();
  Player first = new Player(FIRST);
  Player second = new Player(SECOND);
  print(board);
  Stopwatch watch = new Stopwatch();
  watch.start();
  // result = first.think(board, second, 50, SECOND_WIN);
  // result = second.think(board, first, 50, FIRST_WIN);
  for (var i = 1; i &lt; 50; i++){
    print("i = ${i}");
    result = first.think(board, second, i, SECOND_WIN);
    if (result[0] == FIRST_WIN || result[1] == SECOND_WIN){
      print("=== result = ${result[0]}, ${result[1]}, i = ${i}");
      break;
    }
  }
  print(watch.elapsedMilliseconds);
  print(result);

}

</code></pre>

<p>　一手読みから５０手読みまで反復深化で徐々に読みを深くしていって、先手勝ち（<code>999</code>）の評価値が返ってきたら先手必勝、後手勝ち（<code>-999</code>）の評価値が返ってきたら後手必勝となります。この辺りの話は<a href="/software/2014-09-23/tictactoe_arrange">以前の記事</a>を読んでみてください。</p>

<pre><code class="language-Dart">  //評価関数
  int evaluate(List board){
    int first = 0;
    int second = 0;
    first = board.getRange(FIRST_START, FIRST_GOAL).where((value) =&gt; value == 0).length;
    second = board.getRange(SECOND_START, DENTS).where((value) =&gt; value == 0).length;
    if (first == WIN_COUNT &amp;&amp; second == WIN_COUNT){
      print("=============== Error =============================");
      return DRAW;
    } else if (first == WIN_COUNT){
      return FIRST_WIN;
    } else if (second == WIN_COUNT){
      return SECOND_WIN;
    } else {
      return (first - second);
    }
  }
</code></pre>

<p>　評価関数は先手勝ち（<code>999</code>）か後手勝ち（<code>-999</code>）、それ以外は<code>(先手の空になっている穴の数 - 後手の空になっている穴の数)</code>にしていますが、<code>return 0</code>でもいいと思います。形勢判断の評価関数として<code>(先手の空になっている穴の数 - 後手の空になっている穴の数)</code>というのはかなり雑ですが、読み切ってしまうことが目的なので適当で構いません。</p>

<h3 id="結果">結果</h3>
<p>　石の数を１〜９個にして、５０手先読みしたそれぞれの結果です。</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">石の数</th>
      <th style="text-align: center">１</th>
      <th style="text-align: center">２</th>
      <th style="text-align: center">３</th>
      <th style="text-align: center">４</th>
      <th style="text-align: center">５</th>
      <th style="text-align: center">６</th>
      <th style="text-align: center">７</th>
      <th style="text-align: center">８</th>
      <th style="text-align: center">９</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">戻り値</td>
      <td style="text-align: center">[999, 1]</td>
      <td style="text-align: center">[999, 1]</td>
      <td style="text-align: center">[999, 1]</td>
      <td style="text-align: center">[999, 2]</td>
      <td style="text-align: center">[999, 1]</td>
      <td style="text-align: center">[999, 1]</td>
      <td style="text-align: center">[-999, 3]</td>
      <td style="text-align: center">[-999, 3]</td>
      <td style="text-align: center">[999, 3]</td>
    </tr>
    <tr>
      <td style="text-align: left">読みの深さ</td>
      <td style="text-align: center">５手</td>
      <td style="text-align: center">２４手</td>
      <td style="text-align: center">２４手</td>
      <td style="text-align: center">３８手</td>
      <td style="text-align: center">３６手</td>
      <td style="text-align: center">４３手</td>
      <td style="text-align: center">４８手</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: left">結論</td>
      <td style="text-align: center">先手必勝</td>
      <td style="text-align: center">先手必勝</td>
      <td style="text-align: center">先手必勝</td>
      <td style="text-align: center">先手必勝</td>
      <td style="text-align: center">先手必勝</td>
      <td style="text-align: center">先手必勝</td>
      <td style="text-align: center">後手必勝</td>
      <td style="text-align: center">後手必勝</td>
      <td style="text-align: center">先手必勝</td>
    </tr>
  </tbody>
</table>

<p>※先手なのに指し手の数が偶数になるのは、連続で指した場合にまとめて一手とカウントしてるためで、不正確です<sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup>。</p>

<p>　先読みメソッドの戻り値は（評価値,指し手）となっていて、評価値に最大値（<code>999</code>）が返ってきたら先手必勝、最小値（<code>-999</code>）が返ってきたら後手必勝です。石の数４個の場合、先手が初手にリストの<code>2</code>の位置を選べば先手必勝であることを表しています。石の数７個の時は後手必勝となりました。指し手に<code>3</code>が返ってきているのは、取り敢えず最善手として<code>3</code>を選んだという意味で、深い意味はありません。先手は勝てないことが分かったけど取り敢えず最善手として<code>3</code>を選んだということです。</p>

<h3 id="検証１石が１個の時">検証１（石が１個の時）</h3>
<p>　取り敢えず石の数１個の時のケースを確認しましょう。先手が初手に<code>1</code>の場所を選んで石を撒いた直後の状態は以下のようになります。</p>

<div style="float:left; margin: 0px 0px 0px">
    <table>
    <tr>
    <td rowspan="2" align="center">0</td>
    <td align="center">1</td>    
    <td align="center">1</td>
    <td align="center">1</td>
    <td rowspan="2" align="center">0</td>
    </tr>
    <tr>
    <td align="center">0</td>    
    <td align="center">2</td>
    <td align="center">1</td>
    </tr>
    </table>
</div>
<p><br clear="all" /></p>

<p>　後手はこの次にどこを選んでも（以下の図は<code>5</code>を選んだ場合）、先手は<code>3</code>を選べば自分のストアに石を撒き終わるので次も先手の番です。その結果、３手連続で着手することが出来るので以下のように遷移して先手が勝てます。</p>

<div style="width:500px; margin: 0 auto;">
<div style="float:left; margin: 0px 0px 0px">
    <table>
    <tr>
    <td rowspan="2" align="center">0</td>
    <td align="center">1</td>    
    <td align="center">2</td>
    <td align="center">0</td>
    <td rowspan="2" align="center">1</td>
    </tr>
    <tr>
    <td align="center">0</td>    
    <td align="center">2</td>
    <td align="center">0</td>
    </tr>
    </table>
</div>
<div style="float:left; margin: 0px 15px 0px">
<span>→</span>
</div>
<div style="float:left; margin: 0px 15px 0px">
    <table>
    <tr>
    <td rowspan="2" align="center">0</td>
    <td align="center">1</td>    
    <td align="center">2</td>
    <td align="center">0</td>
    <td rowspan="2" align="center">2</td>
    </tr>
    <tr>
    <td align="center">0</td>    
    <td align="center">0</td>
    <td align="center">1</td>
    </tr>
    </table>
</div>
<div style="float:left; margin: 0px 15px 0px">
<span>→</span>
</div>
<div style="float:left; margin: 0px 15px 0px">
    <table>
    <tr>
    <td rowspan="2" align="center">0</td>
    <td align="center">1</td>    
    <td align="center">2</td>
    <td align="center">0</td>
    <td rowspan="2" align="center">3</td>
    </tr>
    <tr>
    <td align="center">0</td>    
    <td align="center">0</td>
    <td align="center">0</td>
    </tr>
    </table>
</div>
</div>
<p><br clear="all" /></p>

<p>　先手が一手指した後の状態から、後手の立場で先読みしてみます。</p>

<pre><code class="language-Dart">final List board = [0,0,2,1,0,1,1,1];
result = second.think(board, first, 50, FIRST_WIN);
</code></pre>

<p>　戻り値は<code>[999, 7]</code>となって後手は<code>7</code>を選ぶけど、先手必勝（<code>999</code>）の結論は変わりません。<br />
　後手は２手目にどこを選んでも負けるのですが、２手目は<code>7</code>を選んだ方が上で紹介した評価関数に従って有利と判定されるので<code>7</code>が最善手となります。初手からの遷移を省略せずに書くと以下のようになります。</p>

<div style="width:500px; margin: 0 auto;">
<div style="float:left; margin: 0px 0px 0px">
    <table>
    <tr>
    <td rowspan="2" align="center">0</td>
    <td align="center">1</td>    
    <td align="center">1</td>
    <td align="center">1</td>
    <td rowspan="2" align="center">0</td>
    </tr>
    <tr>
    <td align="center">1</td>    
    <td align="center">1</td>
    <td align="center">1</td>
    </tr>
    </table>
</div>
<div style="float:left; margin: 0px 15px 0px">
<span>→</span>
</div>
<div style="float:left; margin: 0px 15px 0px">
    <table>
    <tr>
    <td rowspan="2" align="center">0</td>
    <td align="center">1</td>    
    <td align="center">1</td>
    <td align="center">1</td>
    <td rowspan="2" align="center">0</td>
    </tr>
    <tr>
    <td align="center">0</td>    
    <td align="center">2</td>
    <td align="center">1</td>
    </tr>
    </table>
</div>
<div style="float:left; margin: 0px 15px 0px">
<span>→</span>
</div>
<div style="float:left; margin: 0px 15px 0px">
    <table>
    <tr>
    <td rowspan="2" align="center">1</td>
    <td align="center">0</td>    
    <td align="center">1</td>
    <td align="center">1</td>
    <td rowspan="2" align="center">0</td>
    </tr>
    <tr>
    <td align="center">0</td>    
    <td align="center">2</td>
    <td align="center">1</td>
    </tr>
    </table>
</div>
<div style="float:left; margin: 0px 15px 0px">
<span>→</span>
</div>
<div style="float:left; margin: 0px 15px 0px">
    <table>
    <tr>
    <td rowspan="2" align="center">1</td>
    <td align="center">1</td>    
    <td align="center">0</td>
    <td align="center">1</td>
    <td rowspan="2" align="center">0</td>
    </tr>
    <tr>
    <td align="center">0</td>    
    <td align="center">2</td>
    <td align="center">1</td>
    </tr>
    </table>
</div>
<div style="float:left; margin: 0px 15px 0px">
<span>→</span>
</div>
<div style="float:left; margin: 0px 15px 0px">
    <table>
    <tr>
    <td rowspan="2" align="center">1</td>
    <td align="center">1</td>    
    <td align="center">0</td>
    <td align="center">1</td>
    <td rowspan="2" align="center">1</td>
    </tr>
    <tr>
    <td align="center">0</td>    
    <td align="center">2</td>
    <td align="center">0</td>
    </tr>
    </table>
</div>
<div style="float:left; margin: 0px 15px 0px">
<span>→</span>
</div>
<div style="float:left; margin: 0px 15px 0px">
    <table>
    <tr>
    <td rowspan="2" align="center">1</td>
    <td align="center">1</td>    
    <td align="center">0</td>
    <td align="center">1</td>
    <td rowspan="2" align="center">2</td>
    </tr>
    <tr>
    <td align="center">0</td>    
    <td align="center">0</td>
    <td align="center">1</td>
    </tr>
    </table>
</div>
<div style="float:left; margin: 0px 15px 0px">
<span>→</span>
</div>
<div style="float:left; margin: 0px 15px 0px">
    <table>
    <tr>
    <td rowspan="2" align="center">1</td>
    <td align="center">1</td>    
    <td align="center">0</td>
    <td align="center">1</td>
    <td rowspan="2" align="center">3</td>
    </tr>
    <tr>
    <td align="center">0</td>    
    <td align="center">0</td>
    <td align="center">0</td>
    </tr>
    </table>
</div>
</div>
<p><br clear="all" /></p>

<p>　都合７手で先手勝ちなのですが、最後に先手が連続で着手出来るので５手読みで先手必勝と分かります。</p>

<pre><code class="language-Dart">[0, 1, 1, 1, 0, 1, 1, 1]
i = 1
i = 2
i = 3
i = 4
=== result = 999, 1, i = 4
6
[999, 1]
</code></pre>
<p>　main関数の出力も<code>i = 4</code>（５手読み）で先手が勝つと表示されます。</p>

<h3 id="検証２石が４個の時">検証２（石が４個の時）</h3>
<p>　石の数が１の場合は簡単に検証できましたが、石の数が２個以上の場合は何十手もかかるので、目で追うだけで検証するのは大変です。簡単にみていきます。<br />
　石の数が４個の場合は<code>2</code>の位置を選べば３８手で先手必勝と表示されます。先手が<code>2</code>の位置を選んで石を撒いたら以下の状態になります。</p>

<div style="width:500px; margin: 0 auto;">
<div style="float:left; margin: 0px 0px 0px">
    <table>
    <tr>
    <td rowspan="2" align="center">0</td>
    <td align="center">4</td>    
    <td align="center">4</td>
    <td align="center">4</td>
    <td rowspan="2" align="center">0</td>
    </tr>
    <tr>
    <td align="center">4</td>    
    <td align="center">4</td>
    <td align="center">4</td>
    </tr>
    </table>
</div>
<div style="float:left; margin: 0px 15px 0px">
<span>→</span>
</div>
<div style="float:left; margin: 0px 15px 0px">
    <table>
    <tr>
    <td rowspan="2" align="center">0</td>
    <td align="center">4</td>    
    <td align="center">5</td>
    <td align="center">5</td>
    <td rowspan="2" align="center">1</td>
    </tr>
    <tr>
    <td align="center">4</td>    
    <td align="center">0</td>
    <td align="center">5</td>
    </tr>
    </table>
</div>
</div>
<p><br clear="all" /></p>

<p>　この状態から後手の手番で先読みしてみましょう。</p>
<pre><code class="language-Dart">final List board = [0,4,0,5,1,5,5,4];
result = second.think(board, first, 50, FIRST_WIN);
</code></pre>

<p>　戻り値は<code>[999, 7]</code>となって先手必勝（<code>999</code>）の結論は変わりません。<br />
　今度は初期状態から先手（下側）と後手（上側）の順番を入れ替えて、本来の後手（上側）から先読みしてみると</p>

<pre><code class="language-Dart">final List board = [0,4,4,4,0,4,4,4];
result = second.think(board, first, 50, FIRST_WIN);
</code></pre>

<p>　戻り値は<code>[-999, 6]</code>となって<code>2</code>の対称の位置にある<code>6</code>を選べば本来の後手（上側）が必勝と判定されます。上下対象の配置なので当然こうなるべきで、これも一応プログラムは正しく動いてそうです。</p>

<h3 id="６２ではどうなのか">６×２ではどうなのか</h3>
<p>　３×２列のマンカラでなく、通常の６×２列で石の数が４個のマンカラではどうなのか調べたいと思い、まず石１個でやってみました。</p>

<pre><code class="language-Dart">final List board = [0,1,1,1,1,1,1,0,1,1,1,1,1,1];
result = second.think(board, first, 50, FIRST_WIN);
</code></pre>

<p>　結果は<code>[999, 1]</code>となって先手が初手に<code>1</code>の場所を選べば先手必勝のようです。<br />
　ただ、石２個、３個、４個で試すと循環する手順があるのか、丸一日動かしていても結果が返って来ませんでした。まだ原因がはっきり分かっていませんが、循環する手順があるとしても必勝手順が存在する場合は、その手順を避けて結果が返って来るはずなので、<strong>５０手以内には必勝手順は存在しない</strong>と言えると思います<sup id="fnref:3"><a href="#fn:3" class="footnote">3</a></sup>。マンカラで遊び始めたばかりなので、何か気づいていない特殊なケースがあるのかもしれません。<br />
　ベーシックのルール特有のケースかもしれないので、先にカラハのルールを実装して試してみようかなどと考えていますが、いずれにしても読み切るには結構時間が掛かるので、三目並べのように絶対人間に負けないプログラムを作るのは思っていたほど簡単ではないようです。<br />
　カラハのルールだと自分の空の穴で撒き終わった場合に相手の石を取ることが出来るというルールがあるので、ベーシックのルールより早くゲームを終わらせる必勝手順があるような気がしていますが、どうなるか分かりません。</p>

<h3 id="ソースファイル">ソースファイル</h3>
<p>　<a href="/software/2014-09-23/tictactoe_arrange">以前の記事</a>の「３手前に打った駒が消える特殊なルールの三目並べ」のように<a href="https://github.com/happyclam/tictactoe_ruby/tree/arrange">github</a>でソースを公開しようと思っていたのですが、マンカラのアプリも作ってみようかと考えているところなので公開するのはその後にしようと思います。GUIで検証している最中にバグが見つかるかも知れませんので、結果が変わったらこの記事を更新するつもりです。<br />
　MIN-MAX法やαβ法のアルゴリズムに興味のある方は、もしよろしければ<a href="https://www.amazon.co.jp/HTML5-CoffeeScriptで作る最強の三目並べプログラム-MIN-MAX法からαβ法へ-happyclam-ebook/dp/B01D1IJ0S0/ref=sr_1_1?s=digital-text&amp;ie=UTF8&amp;qid=1473938717&amp;Sr=1-1&amp;keywords=三目並べ">この本</a>を買ってみてください。使用言語はCoffeeScript（JavaScript）ですが、本の中の相互再帰のやり方と今回の検証プログラムはほとんど同じやり方で、マンカラの場合は連続で指し手が続くケースがあるのでその部分だけif文（数行）が追加されている感じです。</p>

<hr />

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>マンカラベーシックという呼び方が同じでも国や地域によってルールが違うようです。 <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p>先読み関数から手数を返せば正確になるのですが、今のところやってません。 <a href="#fnref:2" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:3">
      <p>この辺りの事情は<a href="http://localhost:4000/software/2014-10-04/arrange_line">以前の記事</a>にも書きました。 <a href="#fnref:3" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

    </div>

  
    <ul class="tag_box inline">
      <li><i class="icon-folder-open"></i></li>
      
      


  
     
    	<li><a href="/categories.html#software-ref">
    		software <span>26</span>
    	</a></li>
    
  


    </ul>
    

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
     
    	<li><a href="/tags.html#dart-ref">dart <span>1</span></a></li>
     
    	<li><a href="/tags.html#android-ref">android <span>48</span></a></li>
    
  



    </ul>
    

    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/miscellaneous/2020-05-21/bicycle02" title="同じ規格でもタイヤの高さは違うことがある">&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next disabled"><a>Next &rarr;</a>
      
      </ul>
    </div>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'hello-my-world'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';        
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
</div>

<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://hello-my-world.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      </div>
      <hr>
      <footer>
        <p>&copy; 2020 happyclam
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div>

    
  </body>
</html>

