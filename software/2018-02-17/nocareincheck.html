<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">
  <meta name="author" content="happyclam">
  <meta name="description"
    content="王手放置について 相手の玉を取るのもありだとは思いますが、とりあえず王手放置出来ないようにしました Reinventing the wheel.">
  <title> 王手放置について - 自己満足プログラミング </title>

  <!-- Global Site Tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-1752720-7"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-1752720-7');
  </script>

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@SappierBoy">
  <meta name="twitter:creator" content="@SappierBoy">
  
  <meta name="twitter:title" content="王手放置について">
  
  
  <meta name="twitter:url" content="/software/2018-02-17/nocareincheck">
  
  
  <meta name="twitter:description" content="「王手放置」されたら遠慮なく玉を頂けばいいだけのことと思っていたのですが、とりあえず指せないようにしました。でも、今後変更するかもしれません。">
  
  
  <meta name="twitter:image:src" content="https://happyclam.github.io/images/33shogi_logo.png">
  

  <!-- stylesheets -->
  <link media="all" href="//netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
  <link media="all" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
  <link media="all" rel="stylesheet" href="/assets/css/site.css">

</head>


<body>
  <header>
  <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a id="site-title" class="navbar-brand" href="/">
          <img class="pull-left img-responsive" src="">
          <span class="name-holder">自己満足プログラミング</span>
        </a>
      </div>

      <div class="collapse navbar-collapse" id="navbar">

        <ul id="main-menu" class="nav navbar-nav navbar-right">

          
            <li>
<a href="/">
              <i class="fa fa-home"></i> Home</a>
            </li>
          
            <li>
<a href="/categories/">
              <i class="fa fa-sitemap"></i> Categories</a>
            </li>
          
            <li>
<a href="/tags/">
              <i class="fa fa-tag"></i> Tags</a>
            </li>
          
            <li>
<a href="/about/">
              <i class="fa fa-info-circle"></i> About</a>
            </li>
          
            <li>
<a href="/policy/">
              <i class="fa fa-check"></i> Policy</a>
            </li>
          

        </ul>
      </div>
      <!-- /.navbar-collapse -->
    </div>
    <!-- /.container-fluid -->
  </nav>
</header>

  <div style="text-align: center;">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-9018029357773039",
          enable_page_level_ads: true
      });
    </script>
  </div>
  <div class="blog-header">
    <div class="span3">
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="SappierBoy">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    </div>
  </div>
  
  <div class="container">
  <div class="row">
    <div class="col-xs-12 col-sm-12 col-md-offset-1 col-md-10 col-lg-offset-2 col-lg-8">
      <div class="page">

        <header class="page-header">
          <h2 class="page-title"><a href="/software/2018-02-17/nocareincheck">王手放置について</a></h2>
          <div class="post-metadata">
            <div> <i class="fa fa-calendar"></i>
              <time>
                Saturday, February 17, 2018
              </time>
            </div>
            <div> <i class="fa fa-tag"></i>
                
                  <span class="label label-tag">coffeescript</span>
                
                  <span class="label label-tag">cordova</span>
                
                  <span class="label label-tag">android</span>
                
                  <span class="label label-tag">javascript</span>
                
                  <span class="label label-tag">shogi</span>
                
            </div>
          </div>

        </header>

        <article class="page-content">
          <h3 id="王手放置が反則だとは知らなかった">王手放置が反則だとは知らなかった</h3>
<p>　趣味で長年将棋を指してますが、<a href="https://www.shogi.or.jp/knowledge/shogi/05.html">将棋連盟のサイト</a>で王手放置が反則と規定されているとは知りませんでした、というか深く考えたことがありませんでした。相手が王手を放置したら相手玉を取ればいいだけの話と思っていたし、確か将棋連盟が運営している「将棋倶楽部24」でも、王手放置した段階では反則負けとはならず、投了するか玉が取られたらゲーム終了となっていたと思います。ただ、市販の将棋ソフトやスマホアプリでは王手を放置しようとするとなんらかのメッセージを表示して王手放置をさせないようにしているものが多いと思います。<a href="https://happyclam.github.io/software/2018-01-27/utifudume">前回の記事</a>でも少し触れましたが、将棋が「相手の玉を取ったら終了」ではなく「相手玉を詰ましたら終了」となっているため、王手放置をさせないようにする方がソフト開発時にも整合性を保ちやすいという事情があるようです。</p>

<h3 id="規制はできるだけ無い方がいいけどいろいろ問題が">規制はできるだけ無い方がいいけど、いろいろ問題が…</h3>
<p>　下のような局面で先手が「勝った」と思い２一歩成りと指して相手に玉を取られて負けてしまうなんてことが将棋覚えたての人にはよくあることだと思います（後手も自分が勝ったと気づかなかったり<img class="emoji" title=":sweat_smile:" alt=":sweat_smile:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f605.png" height="20" width="20">）。</p>

<div style="width:320px; margin: 0 auto;">
  <p><img src="/images/hochi1.png" alt="王手放置１" width="320" title="王手放置１"></p>
</div>

<p>　自分の玉に王手がかかることに気づかずにうっかり自分の駒を動かして王手放置をしてしまうことは初心者によくあることだし、自分も将棋覚えた頃はそういうことを相手と一緒に楽しんでました。「王手に気づくなよ、気づくなよ」と念じながら空き王手したりして楽しんでいたものです。だからわざわざ王手放置を禁止する（指せないようにする）必要もないと思ってアプリを作っていたのですが、ルール上「王手放置は反則」というのであれば他のソフトに倣って対応した方がいいのかもと思えてきました。<br>
　また、王手放置には上記のような大駒の利きをうっかりする場合と、敵駒の利きにわざと玉を移動するようなあからさまな自爆行為もあります。ネット対戦とかで見かけますが、悔し紛れとか嫌がらせのつもりでそういう手を指す人もいるでしょう。でも故意に王手放置をした場合は反則でうっかりミスの場合は許されるなんていうルールはあり得ません。悪意があろうがなかろうが王手放置に違いはなく、特にソフト開発の視点からはどちらも同じ王手放置です。玉を動かして自爆した場合と大駒の利きに入った場合を区別することは出来ますが、玉をぶつけてきたとしても悪意があると断定出来るわけでもないので結局同じように扱うしかないでしょう。<br>
　もう一点、ソフト側で王手放置出来ないようにすると、本来なら王手放置で反則負けになるはずだったのにソフトに教えてもらって負けずに済んだ（放置せずに済んだ、助言を貰ったのと同じ）という弊害もあります。これは良くないと考えるなら、王手放置は出来るけど王手放置をした時点で反則負けと判定すればいいはずですが、なぜかそういう仕様のソフトは見たことがありません。ソフト相手にそんなに厳格なルールを適用する必要はないという考え方でしょうか？でも、人対人の将棋倶楽部24でも王手放置は出来るけど、その時点で反則負けになるわけではなかったと思います。<br>
　「余計な規制は必要ない」、「マナー違反出来ないようにして欲しい」、「ソフトが指し手に助言を与えるのはおかしい」、人それぞれの経験値や考え方が違うので、どういう仕様にするか迷いましたがとりあえずよくあるソフトの仕様に倣うことにしました（version0.9.4.0）。この辺りはまだ流動的で今後仕様変更するかもしれません。</p>

<h3 id="どうなればゲーム終了かをソフトに教える必要がある">どうなればゲーム終了かをソフトに教える必要がある</h3>

<div style="width:320px; margin: 0 auto;">
  <p><img src="/images/hochi2.png" alt="王手放置２" width="320" title="王手放置２"></p>
</div>

<p><span>上の局面は３三将棋の初形から２二銀、２一玉（王手放置）と進んだ局面ですが、ここで先手が後手玉を取ればゲーム終了になりますが、取らずに１三歩と打っても下の図のように後手玉が詰み（王手は掛かっていませんが玉が自爆する手しかない状態、次に王手放置せざるを得ない）となります（version0.9.3.0以前）。</span></p>

<div style="width:320px; margin: 0 auto;">
  <p><img src="/images/hochi3.png" alt="王手放置３" width="320" title="王手放置３"></p>
</div>

<p><span>次の例は先手が１三歩ではなく１二歩と打ったケースですが、この場合後手玉は１二に移動出来る余地があるので後手玉は詰みとならずにゲームが継続します（version0.9.3.0以前）。</span></p>

<div style="width:320px; margin: 0 auto;">
  <p><img src="/images/hochi4.png" alt="王手放置４" width="320" title="王手放置４"></p>
</div>

<p><span>上の局面は先手の１二歩に対して後手が３二銀と打って先手玉を詰ました局面ですが、手番は先手ですので先手が後手玉を取ればゲーム終了になります（version0.9.3.0以前）。これでいい、玉を取るまで指させればいいじゃないか、と言う人もいると思いますが、某９マス将棋アプリのレビューを読んでいると、「将棋は玉を取るまで指させるもんじゃない」「詰み局面で終了すべき」と言う意見も多く、私も相手玉を取るまでゲームが終わらないことに違和感を感じた一人です。</span><br>
　
ある時は詰み局面（王手は掛かってないけど、王手放置せざるを得ない局面含む）でゲームが終了して、ある時は玉を取るまで終わらないというのはおかしな仕様だと思ったので、とりあえず他の多くのソフトに倣って王手放置は出来ないように対応しました（version0.9.4.0）。<br>
　普通の将棋盤で遊ぶような感覚で自由に指せる仕様にしようと開発していたのですが、<strong>ソフト側で終了判定をしようとするなら、結局玉を取るまで終わらないようにするしかなさそうです。</strong>でも、それでは長年将棋を指している人からすると、玉を取るまで終わらないのは将棋じゃないと感じる気持ちもわかります。また、詰み判定（終了判定）はソフトがするのに、打ち歩詰めと王手放置の時だけソフトが助言してくれるというのも一貫性がないような気がするので、いっそのこと二歩も合わせて打ち歩詰め、王手放置はその瞬間に反則負けとする仕様もありかなと思ったりもします。</p>

<h3 id="ルールを厳格に適用すると">ルールを厳格に適用すると…</h3>

<div style="width:320px; margin: 0 auto;">
  <p><img src="/images/foulplay1.png" alt="反則１" width="320" title="反則１"></p>
</div>
<p><span>上の局面は後手が２一桂と王手を掛けたところです。先手がここで持ち駒の歩を３二に打った場合「二歩」であり「王手放置」であり「打ち歩詰め」でもあります。</span></p>
<div style="width:320px; margin: 0 auto;">
  <p><img src="/images/foulplay2.png" alt="反則２" width="320" title="反則２"></p>
</div>
<p><span>上の局面は後手が２二角と王手を掛けたところです。先手がここで持ち駒の歩を３一に打った場合「二歩」であり「王手放置」であり「行き場の無い駒を打つ」という反則でもあります。</span></p>

<p>　おそらく反則の優先順位は聞いた事ないし規定されていないでしょう。反則手を指した段階で反則負けとする場合、ソフトのメッセージにはいったいどのように出力すればいいのでしょうか？それに行き場のない駒を打った時も反則になるわけですから、それを突き詰めていくと、持ち駒を選択した後に盤面の外をタップした時も反則になるのではないのか？という意見も出てくるかもしれません（さすがにそれはないか<img class="emoji" title=":sweat_smile:" alt=":sweat_smile:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f605.png" height="20" width="20">）。<br>
　また、反則を厳格に適用すると勝負を続けたかったのにうっかりクリックミス（タップミス）しただけで中断されるのは嫌だという意見があるかもしれませんが、どうせマイナーなアプリだし、オリジナリティを出すためにもルールに厳格な「初心者に厳しい将棋アプリ」を目指すかもしれません。</p>

<h3 id="開発者視点での王手放置">開発者視点での王手放置</h3>
<p>　反則手のチェックをするのは一見業務システムの入力データのチェックをする場合と似ているように思えます。反則手は事前にチェックしてその手を指させないようにしようと考えがちですが、<a href="https://happyclam.github.io/software/2018-01-27/utifudume">前回の記事</a>で書いたように、打ち歩詰めを事前にチェックしようとして苦労しました。でも、打ち歩詰めも王手放置も一旦指させてから反則の場合には元に戻すと言うやり方の方が、無駄なコードを書かなくていいことがわかってきました。<br>
　「一旦指させてから元に戻す」という作業は局面の先読みをする過程でやっていることで、局面の先読みの過程でも反則手を指させないようにチェックするのではなく、敢えて反則手を指させてその局面の評価を「負け」と評価する方がコードもすっきりして、局面の枝刈りが効率的になり実行速度も速くなるようなので、その辺りのことを書こうと思っていたのですが記事が長くなってきたので次回にまわすことにします。</p>

<hr>


        </article>
      </div>
    </div>
  </div>
</div>


  

<footer class="footer">
  <div class="container">
    <div class="row">
      <div class="col-lg-offset-3 col-lg-6">
        <div class="row">
          <div class="col-xs-12 text-center">
            <small>© rifyll theme, 2014</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</footer>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
  <!--<script src="/assets/js/prism.js"></script> -->
  <script src="/assets/js/site.js"></script>

</body>

</html>
