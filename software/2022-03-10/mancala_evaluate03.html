<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">
  <meta name="author" content="happyclam">
  <meta name="description"
    content="マンカラカラハで後手でも勝てるケース マンカラカラハの評価関数と読みの深さ Reinventing the wheel.">
  <title> マンカラカラハで後手でも勝てるケース - 自己満足プログラミング </title>

  <!-- Global Site Tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-1752720-7"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-1752720-7');
  </script>

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@SappierBoy">
  <meta name="twitter:creator" content="@SappierBoy">
  
  <meta name="twitter:title" content="マンカラカラハで後手でも勝てるケース">
  
  
  <meta name="twitter:url" content="/software/2022-03-10/mancala_evaluate03">
  
  
  <meta name="twitter:description" content="マンカラカラハで後手でも勝てたけど、先手必勝の結論は変わらない？">
  
  
  <meta name="twitter:image:src" content="https://happyclam.github.io/images/mancala_screen2_thumb.png">
  

  <link rel="canonical" href="https://happyclam.github.io/software/2022-03-10/mancala_evaluate03" />
  <!-- stylesheets -->
  <link media="all" href="//netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
  <link media="all" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
  <link media="all" rel="stylesheet" href="/assets/css/site.css">

</head>


<body>
  <header>
  <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a id="site-title" class="navbar-brand" href="/">
          <img class="pull-left img-responsive" src="">
          <span class="name-holder">自己満足プログラミング</span>
        </a>
      </div>

      <div class="collapse navbar-collapse" id="navbar">

        <ul id="main-menu" class="nav navbar-nav navbar-right">

          
            <li><a href="/">
              <i class="fa fa-home"></i> Home</a>
            </li>
          
            <li><a href="/categories/">
              <i class="fa fa-sitemap"></i> Categories</a>
            </li>
          
            <li><a href="/tags/">
              <i class="fa fa-tag"></i> Tags</a>
            </li>
          
            <li><a href="/about/">
              <i class="fa fa-info-circle"></i> About</a>
            </li>
          
            <li><a href="/policy/">
              <i class="fa fa-check"></i> Policy</a>
            </li>
          

        </ul>
      </div>
      <!-- /.navbar-collapse -->
    </div>
    <!-- /.container-fluid -->
  </nav>
</header>

  <!-- <script src="https://unpkg.com/simple-jekyll-search@1.5.0/dest/simple-jekyll-search.min.js"></script> -->
  <script src="/assets/js/simple-jekyll-search.min.js"></script>
  <div style="text-align: center;">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-9018029357773039",
          enable_page_level_ads: true
      });
    </script>
  </div>
  <div class="blog-header">
    <div class="row-fluid">
      <div class="span3">
        <a href="https://twitter.com/share" class="twitter-share-button"{count} data-via="SappierBoy">Tweet</a>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
      </div>
      <div class="span9">
        <!-- Html Elements for Search -->
        <div id="search-container" align="right">
          <input type="text" id="search-input" placeholder="search...">
          <ul class="searchresult" id="results-container"></ul>
        </div>
        <div class="results"></div>
      </div>
    </div>
<script type="text/javascript">
  SimpleJekyllSearch.init({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('results-container'),
    json: '/search.json',
    searchResultTemplate: '<li><a href="{url}" title="{category}:{title}">{title}</a></li>',
    noResultsText: 'No results found',
    limit: 15,
    fuzzy: false,
  })
</script>
  <script src="/assets/js/jquery.min.js"></script>
  </div>
  <div class="container">
  <div class="row">
    <div class="col-xs-12 col-sm-12 col-md-offset-1 col-md-10 col-lg-offset-2 col-lg-8">
      <div class="page">

        <header class="page-header">
          <h2 class="page-title"><a href="/software/2022-03-10/mancala_evaluate03">マンカラカラハで後手でも勝てるケース</a></h2>
          <div class="post-metadata">
            <div> <i class="fa fa-calendar"></i>
              <time>
                Thursday, March 10, 2022
              </time>
            </div>
            <div> <i class="fa fa-tag"></i>
                
                  <span class="label label-tag">dart</span>
                
                  <span class="label label-tag">android</span>
                
                  <span class="label label-tag">flutter</span>
                
                  <span class="label label-tag">c++</span>
                
                  <span class="label label-tag">mancala</span>
                
                  <span class="label label-tag">shogi</span>
                
            </div>
          </div>

        </header>

        <article class="page-content">
          <h3 id="後手でも勝てるケース">後手でも勝てるケース</h3>
<p>　<a href="/software/2021-01-22/mancala_evaluate02">去年の記事</a>の最後に追記しましたが、<a href="https://play.google.com/store/apps/details?id=mancala.io.github.happyclam">アプリ</a>の設定を「やばい」（＝最強）にしていても後手で人間が勝てるケース（豆４つ）を見つけてしまいました。適当に遊んでいて見つけたぐらいですから、<a href="https://play.google.com/store/apps/details?id=mancala.io.github.happyclam">アプリ</a>のユーザーの中にも後手で勝てた人はいると思います。でも<a href="https://play.google.com/store/apps/details?id=mancala.io.github.happyclam">アプリ</a>のAIは完全に読み切っている訳では無いのでこういうことがあっても不思議はないと思っていて、豆４つのケースでは先手必勝の結論に変わりはないと思っています。１１手読みでは必勝手順を間違えてしまうことがあるということだと思います。<br />
　単純な評価関数（勝ちか負けかだけを判断）でも十分強いだろうと思っていましたが、評価関数を工夫した方がいいのかもしれません。</p>

<h3 id="途中の局面からなら読み切れる">途中の局面からなら読み切れる</h3>
<p>　たまたま後手で勝つことが出来た時その手順を再現出来なくて困っていたのですが、記憶を頼りに途中まで局面を進めていって、その途中の局面からプログラムで先読みさせれば勝ち（将棋で言う「詰み」）を読み切れる場合があります。そういうやり方で後手での勝ち手順を確認したので、一例として紹介したいと思います。<br />
　マンカラの棋譜をどのように表現するか、標準的なものは無いと思うので、ここでは以下の表の番号に従って、指し手を表現します。<a href="https://play.google.com/store/apps/details?id=mancala.io.github.happyclam">アプリ</a>の画面と対比し易いように上側（Upper）を先手、下側（Lower）を後手にして、それぞれ<code class="language-plaintext highlighter-rouge">U</code>と<code class="language-plaintext highlighter-rouge">L</code>の次に場所を表す数字を付加して棋譜を表現しました。</p>

<div style="float:left; margin: 0px 0px 0px">
    <table>
    <tr>
    <td rowspan="2" align="center"><br />上側のストア</td>
    <td align="center">U6</td>    
    <td align="center">U5</td>
    <td align="center">U4</td>
    <td align="center">U3</td>
    <td align="center">U2</td>
    <td align="center">U1</td>    
    <td rowspan="2" align="center"><br />下側のストア</td>
    </tr>
    <tr>
    <td align="center">L1</td>    
    <td align="center">L2</td>
    <td align="center">L3</td>
    <td align="center">L4</td>
    <td align="center">L5</td>
    <td align="center">L6</td>        
    </tr>
    </table>
</div>
<p><br clear="all" /></p>

<h4 id="後手勝ちの棋譜の一例５１手でゲーム終了後手の勝ち">後手勝ちの棋譜の一例（５１手でゲーム終了、後手の勝ち）</h4>

<table>
  <thead>
    <tr>
      <th style="text-align: left">手数</th>
      <th style="text-align: center">01</th>
      <th style="text-align: center">02</th>
      <th style="text-align: center">03</th>
      <th style="text-align: center">04</th>
      <th style="text-align: center">05</th>
      <th style="text-align: center">06</th>
      <th style="text-align: center">07</th>
      <th style="text-align: center">08</th>
      <th style="text-align: center">09</th>
      <th style="text-align: center">10</th>
      <th style="text-align: center">11</th>
      <th style="text-align: center">12</th>
      <th style="text-align: center">13</th>
      <th style="text-align: center">14</th>
      <th style="text-align: center">15</th>
      <th style="text-align: center">16</th>
      <th style="text-align: center">17</th>
      <th style="text-align: center">18</th>
      <th style="text-align: center">19</th>
      <th style="text-align: center">20</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">指し手</td>
      <td style="text-align: center">U3*</td>
      <td style="text-align: center">U6</td>
      <td style="text-align: center">L2*</td>
      <td style="text-align: center">L1</td>
      <td style="text-align: center">U5</td>
      <td style="text-align: center">L4</td>
      <td style="text-align: center">U6*</td>
      <td style="text-align: center">U2*</td>
      <td style="text-align: center">U6*</td>
      <td style="text-align: center">U4</td>
      <td style="text-align: center">L3</td>
      <td style="text-align: center">U6*</td>
      <td style="text-align: center">U1*</td>
      <td style="text-align: center">U6*</td>
      <td style="text-align: center">U5</td>
      <td style="text-align: center">L5</td>
      <td style="text-align: center">U4*</td>
      <td style="text-align: center">U5*</td>
      <td style="text-align: center">U3</td>
      <td style="text-align: center">L4</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th style="text-align: left">手数</th>
      <th style="text-align: center">21</th>
      <th style="text-align: center">22</th>
      <th style="text-align: center">23</th>
      <th style="text-align: center">24</th>
      <th style="text-align: center">25</th>
      <th style="text-align: center">26</th>
      <th style="text-align: center">27</th>
      <th style="text-align: center">28</th>
      <th style="text-align: center">29</th>
      <th style="text-align: center">30</th>
      <th style="text-align: center">31</th>
      <th style="text-align: center">32</th>
      <th style="text-align: center">33</th>
      <th style="text-align: center">34</th>
      <th style="text-align: center">35</th>
      <th style="text-align: center">36</th>
      <th style="text-align: center">37</th>
      <th style="text-align: center">38</th>
      <th style="text-align: center">39</th>
      <th style="text-align: center">40</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">指し手</td>
      <td style="text-align: center">U1</td>
      <td style="text-align: center">L5</td>
      <td style="text-align: center">U2</td>
      <td style="text-align: center">L6!</td>
      <td style="text-align: center">U1</td>
      <td style="text-align: center">L2*</td>
      <td style="text-align: center">L6*</td>
      <td style="text-align: center">L3</td>
      <td style="text-align: center">L3</td>
      <td style="text-align: center">U4*</td>
      <td style="text-align: center">U2</td>
      <td style="text-align: center">L5*</td>
      <td style="text-align: center">L6*</td>
      <td style="text-align: center">L4</td>
      <td style="text-align: center">U3</td>
      <td style="text-align: center">L6*</td>
      <td style="text-align: center">L5</td>
      <td style="text-align: center">U6!</td>
      <td style="text-align: center">L1*</td>
      <td style="text-align: center">L6*</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th style="text-align: left">手数</th>
      <th style="text-align: center">41</th>
      <th style="text-align: center">42</th>
      <th style="text-align: center">43</th>
      <th style="text-align: center">44</th>
      <th style="text-align: center">45</th>
      <th style="text-align: center">46</th>
      <th style="text-align: center">47</th>
      <th style="text-align: center">48</th>
      <th style="text-align: center">49</th>
      <th style="text-align: center">50</th>
      <th style="text-align: center">51</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">指し手</td>
      <td style="text-align: center">L5*</td>
      <td style="text-align: center">L6*</td>
      <td style="text-align: center">L2</td>
      <td style="text-align: center">U5</td>
      <td style="text-align: center">L1</td>
      <td style="text-align: center">U5</td>
      <td style="text-align: center">L4*</td>
      <td style="text-align: center">L6*</td>
      <td style="text-align: center">L2</td>
      <td style="text-align: center">U6</td>
      <td style="text-align: center">L1!</td>
    </tr>
  </tbody>
</table>

<p>※指し手の最後にピッタリなら<code class="language-plaintext highlighter-rouge">*</code>、横取りなら<code class="language-plaintext highlighter-rouge">!</code>を付加しています。
※アプリのバージョン 1.2.4</p>

<div style="width:480px; margin: 0 auto;">
  <p><a href="/images/yabai01.png"><img src="/images/yabai01.png" alt="AI先手" width="480" height="206" title="AI先手" /></a></p>
</div>

<p>※画像はゲーム開始から、U3*（ピッタリ）,U6と２手進んだ局面です。</p>

<p>　<a href="https://play.google.com/store/apps/details?id=mancala.io.github.happyclam">アプリ</a>は評価値が同じ場合、乱数選択させているので上記の手順通りにならないケースもありますが、２１手目ぐらいまでは毎回同じようです。そして、そこまでいけば形勢はかなり後手有利なので、序盤を上の手順通りなぞれば後手でAIに勝つことが出来ます。</p>

<h3 id="負ける原因は評価関数読みの深さ">負ける原因は評価関数？読みの深さ？</h3>
<p>　<a href="https://play.google.com/store/apps/details?id=mancala.io.github.happyclam">アプリ</a>が先手で負ける原因は、序盤の局面評価が単純過ぎる所為と言えますが、勝ち、負けの判定をするには今の評価関数で間違い無いので、読みが浅いのが原因とも言えます。<a href="https://play.google.com/store/apps/details?id=mancala.io.github.happyclam">アプリ</a>の評価関数はアプリの紹介ページにも書いていますが、<br />
　<code class="language-plaintext highlighter-rouge">（先手の貯蔵所に溜まった豆の数 - 後手の貯蔵所に溜まった豆の数）</code><br />
となっていて、単にその局面でどちらの豆が多いかしか評価していません。１１手先を読んでその時点でどちらの豆が多いかを評価値としています。これは先読みの手数以内にゲームが終了すれば正確なものになりますが、ゲーム途中の局面の形勢判断には向いていません。マンカラカラハのルールではゲーム終了時に自陣に残った豆を全て自分の貯蔵所に入れて数えますが、ゲームが終わっていないのに貯蔵所の豆の数で優劣を判定するのはあまり良くありません。ただ１１手も先を読んでいるので、終盤は十分強いので、そういう仕様にしていました。<br />
　将棋で言えば詰み判定の時に使用する評価関数のようなものなので、序盤の形勢判断に使用すると悪手を選ぶケースがあります。</p>

<h3 id="悪手を特定する">悪手を特定する</h3>
<p>　初手からの必勝手順を読み切るのは今までの記事で書いてきたように時間がかかりますが、上で説明したようにある程度指し手を進めた局面から先読み、ダメなら元に戻して他の手を試すっていう方法を繰り返して徐々に序盤に遡れば、どの手が悪手だったかある程度特定出来ます。将棋と違って一局面で選べる手は最大６手しか無いのでそういうやり方が可能です。<br />
　自分なりに調べたところ以下の局面でAIが<code class="language-plaintext highlighter-rouge">U4</code>（上記の棋譜の10手目、豆が７個あるところ）と指す手が悪手のようです。</p>

<div style="width:480px; margin: 0 auto;">
  <p><a href="/images/akusyu01.png"><img src="/images/akusyu01.png" alt="AIの悪手" width="480" height="206" title="AIの悪手" /></a></p>
</div>
<p>※上の局面は二人対戦モードにして上記の表の棋譜を再現した途中の画像です。</p>

<p>　上の局面でAIは11手先を読んで<code class="language-plaintext highlighter-rouge">U4</code>（豆が７つあるところ）が好手だと判断するのですが、パッと見だと<code class="language-plaintext highlighter-rouge">U5</code>や<code class="language-plaintext highlighter-rouge">U1</code>を選べば下段の<code class="language-plaintext highlighter-rouge">L1</code>の場所にある相手の豆を１個横取り出来るのでその手の方が良さそうに思えます。実際その後の変化を調べてみると、この局面では<code class="language-plaintext highlighter-rouge">U5</code>を選んで相手の<code class="language-plaintext highlighter-rouge">L1</code>の豆を一個横取りするのが最善手のようです。<br />
　今の評価関数のまま何手先まで読めばその最善手が選ばれるか調べてみました。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% ./mancala.out                                      
2,5,0,2,7,1,0,6,1,2,8,0,7,7,
=== result = 6, 1, i = 0
=== result = 4, 4, i = 1
=== result = 5, 4, i = 2
=== result = 6, 4, i = 3
=== result = 7, 4, i = 4
=== result = 10, 4, i = 5
=== result = 9, 4, i = 6
=== result = 10, 4, i = 7
=== result = 11, 4, i = 8
=== result = 10, 4, i = 9
=== result = 11, 4, i = 10
=== result = 12, 4, i = 11
=== result = 10, 4, i = 12
=== result = 10, 4, i = 13
=== result = 9, 4, i = 14
=== result = 8, 5, i = 15
=== result = 11, 5, i = 16
=== result = 12, 5, i = 17
=== result = 14, 5, i = 18
=== result = 12, 5, i = 19
=== result = 19, 5, i = 20
</code></pre></div></div>

<p>　<a href="/software/2020-06-07/mancala">以前の記事</a>に書きましたが、AI（先読みメソッド）の戻り値は、<code class="language-plaintext highlighter-rouge">評価値, 指し手</code>となっていて<code class="language-plaintext highlighter-rouge">i</code>は読みの深さを表すループカウンターです（i=0は一手読み）。<br />
　一手読み（i=0）だと当然相手の豆を横取り出来る手（<code class="language-plaintext highlighter-rouge">U1</code>）を選びますが、<code class="language-plaintext highlighter-rouge">U1</code>を選ぶとその直後に相手に<code class="language-plaintext highlighter-rouge">U2</code>を指されて豆３個を横取りされます。そのため２手読み以上ではずっと<code class="language-plaintext highlighter-rouge">U4</code>を最善手と判定しますが、１６手読みの時（i=15）に<code class="language-plaintext highlighter-rouge">U5</code>が最善手と変わります。１６手読んでようやく最善手に辿り着くようです。でもこの辺りの読みの深さは一手読みを深くする毎に消費時間も指数関数的に増大します。２０手先まで読むのにハイスペックPC（Apple M1 Pro搭載のM1 MacBook Pro 14インチ）でも一晩掛かりますし、１６手読みでも２分ぐらいかかりますので、スマホアプリにそのまま適用するわけにはいきません。やはり今より強くするには読みの深さより、評価関数を修正するべきでしょう。<br />
　あるいは時間をかけて全ての手を読んで序盤だけを定石データ化するのがいいと思いますが、今までの記事で書いているように普通のやり方で全ての手を読み切るには何ヶ月あるいは何年も掛かると思います。それか既にどこかにマンカラの定石データがあるのかも知れませんが、どうなんでしょう？</p>

<h3 id="他のアプリにも後手で勝てるか">他のアプリにも後手で勝てるか</h3>
<p>　<a href="/software/2021-01-22/mancala_evaluate02">「マンカラは後手でも勝てるか？」の記事</a>で対戦成績を紹介したように、<a href="https://play.google.com/store/apps/details?id=mancala.io.github.happyclam">マンカラナッツ</a>は後手で他のアプリに何度も勝っていますが、先手で他のアプリには負けていませんでした。その時の棋譜を保存しているわけではないのですが、新しいアプリも増えているので改めて確認してみると、<a href="/software/2021-01-22/mancala_evaluate02">「マンカラは後手でも勝てるか？」の記事</a>で対戦させたアプリは最強レベルにすると初手に<code class="language-plaintext highlighter-rouge">U3</code>か<code class="language-plaintext highlighter-rouge">U6</code>を選ぶものが多く、<a href="https://play.google.com/store/apps/details?id=mancala.io.github.happyclam">マンカラナッツ</a>が後手で勝っていたのは相手のAIが初手に<code class="language-plaintext highlighter-rouge">U6</code>を選んだ場合がほとんどで、初手に<code class="language-plaintext highlighter-rouge">U3</code>（ピッタリ）を選ばれた場合には、後手を持って勝つ手順を見つけることは出来ませんでした。</p>

<h3 id="現状は粘りが効かない">現状は粘りが効かない</h3>
<p>　現状の<a href="https://play.google.com/store/apps/details?id=mancala.io.github.happyclam">マンカラナッツ</a>はもう一つ問題があって、先読みの過程で最善手を続けても負けることが確定すると１個差での負けでも１０個差の負けでも同じ負けと判断して、時間短縮のために先読みを省略していました。その結果もう少し僅差の負けに持ち込める場合でも大差の負けを喫するケースがあります。これは元々マンカラというゲームが先手必勝なのか後手必勝なのかを確認するために作ったアプリだったのでこういう仕様にしていたのですが、この点も改善する必要があると思っていました。<br />
　<a href="https://play.google.com/store/apps/details?id=mancala.io.github.happyclam">アプリ</a>のユーザーの中には、終盤に<a href="https://play.google.com/store/apps/details?id=mancala.io.github.happyclam">アプリ</a>が自分の豆を取られる手を選んできて、「このアプリおかしい」、「バグってる」と思った方もいると思いますが、<a href="https://play.google.com/store/apps/details?id=mancala.io.github.happyclam">アプリ</a>の右上に表示している絵文字による勝ち負けの判定自体は間違っていないはずです。<br />
　でもこのままだと誤解され易いので、探索時に勝ちが確定した時に評価値を最大値（先手勝ち）あるいは最小値（後手勝ち）に置き換えていたのを、評価値と勝ち負け判定の数値は別々に返すように局面の先読みメソッドを修正しました（バージョン1.3.0以降）。これでゲーム終了まで最善を尽くす（最大個数差で勝つ、あるいは最小個数差で負ける）ようになったはずです。</p>

<h3 id="評価関数は今のまま">評価関数は今のまま？</h3>
<p>　評価関数についてピッタリや横取りが出来る局面をプラス評価（＝相手のピッタリや横取りを防ぐマイナス評価）することなど局面評価の材料をちょっと考えてみましたが、なかなか良い案が思いつきません。「連続して着手出来る手（ピッタリ）がなるべく多い形（自分の貯蔵所から１個、２個、３個…と並ぶ形）を理想として、それとのズレを評価値にしてみてはどうか」なんて考えてみましたが、横取りされることも考慮しなければならないので静的評価のやり方がよく分かりません。こういう時こそ機械学習を使ってみたい気もしますが、将棋ほど複雑じゃないので今の評価関数で十分な気もするので、取り敢えず今の評価関数が<br />
　<code class="language-plaintext highlighter-rouge">（先手の貯蔵所に溜まった豆の数 - 後手の貯蔵所に溜まった豆の数）</code>  <br />
となっているところを、<br />
　<code class="language-plaintext highlighter-rouge">（先手の自陣の全ての豆の数 - 後手の自陣の全ての豆の数）</code><br />
に変更して試してみました。<br />
　既に書きましたが、マンカラカラハのルールではゲーム終了時に自陣に残った豆を全て自分の貯蔵所に入れて数えますので、評価関数内で貯蔵所に溜まった豆の数だけを数えるのではなく、ゲーム終了時と同じように自陣の豆全てを数えてその数が勝っている方を有利と考えてみれば何か変化があるかもと思ってやってみました。<br />
　そうすると上で紹介した局面にはなりませんが、すぐに人間が後手で勝てる他の手順を見つけることが出来ました。将棋の駒得だけを考慮する評価関数のように、自陣に豆を溜め込んで中盤で相手に豆を大量に横取りされる感じです。ということでこれはすぐにボツにしましたが、序盤だけこの評価関数を使って終盤は今使用している評価関数を使う方法もアリかもしれません。</p>

<h3 id="読みを一手深くしてみる">読みを一手深くしてみる</h3>
<p>　今度は「やばい」モードの時だけ試しに読みを一手深くしてみました（バージョン1.3.0以降）。古いスマホだとちょっと待たされる感じにはなりましたが、上で説明した悪手を指す局面になる前に着手を変えてきました。しばらくこれで様子を見ようと思います。<br />
　当面はバージョン1.3.0を<a href="https://play.google.com/apps/testing/mancala.io.github.happyclam">ベータ版のまま公開</a>しておきますので違いを試すことも出来ます。スマホからの場合は<a href="https://play.google.com/store/apps/details?id=mancala.io.github.happyclam">アプリのページ</a>からダウンロード可能です。</p>

<div>
    <script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- display01 -->
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9018029357773039" data-ad-slot="3925247388" data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

<hr />


        </article>
      </div>
    </div>
  </div>
</div>


  

<footer class="footer">
  <div class="container">
    <div class="row">
      <div class="col-lg-offset-3 col-lg-6">
        <div class="row">
          <div class="col-xs-12 text-center">
            <small>&copy; rifyll theme, 2014</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</footer>


  <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script> -->
  <!-- <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script> -->
  <script src="/assets/js/bootstrap.min.js"></script>

  <!--<script src="/assets/js/prism.js"></script> -->
  <script src="/assets/js/site.js"></script>
</body>

</html>
